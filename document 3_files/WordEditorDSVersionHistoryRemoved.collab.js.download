'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1506:function(E,K,c){c.r(K);c.d(K,"RtcUtils",function(){return k});E=c(0);var l=c(7),f=c(1536),a=c(35);class k{static x6e(x,y=f.RealtimeChannel.hMf){let n;try{n=a.c(x)}catch(u){throw x=String.format("Failed to JSON-serialize payload : {0}",u),l.ULS.sendTraceTag(18637072,500,10,x),Error.argument("payload",x);}if(n.length>y)throw x=String.format("Payload exceeds maximum length: {0} > {1}.",n.length,y),l.ULS.sendTraceTag(18637074,
500,10,x),Error.argument("payload",x);return n}static deserialize(x,y,n){if(!x)return null;if(Object.getType(x)!==String){var u=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",y,Object.getType(x).getName(),n);l.ULS.sendTraceTag(18637075,500,10,u);return null}u=null;try{u=a.a(x)}catch(z){x=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",y,z,n),l.ULS.sendTraceTag(18637077,
500,10,x)}return u}static iec(x){if(!x)return"";if("string"===typeof x)return x.toString();try{return a.c(x)}catch(y){return x.toString()}}static zyl(x){let y,n,u;y=0;u=n=null;if(!x)return{aoi:y,coi:n,exception:u};try{const z=x.source;z&&Object.getType(z)===String&&(u=z);const w=x.context;w&&(x=w,y=x.status?x.status:0,n=x.statusText?x.statusText:null)}catch(z){}return{aoi:y,coi:n,exception:u}}}Object(E.a)(k,"RtcUtils",null,[])},1526:function(E,K,c){c.r(K);E=c(0);var l=c(7),f=c(55),a=c(82),k;(function(u){u[u.SendNotification=
0]="SendNotification";u[u.SendPersistentState=1]="SendPersistentState";u[u.FindSession=2]="FindSession";u[u.Last=3]="Last"})(k||(k={}));Object(E.b)("ApiType",k);var x;(function(u){u[u.AttemptCount=0]="AttemptCount";u[u.SuccessCount=1]="SuccessCount";u[u.DropCount=2]="DropCount";u[u.FailedCount=3]="FailedCount";u[u.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";u[u.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";u[u.ThrottledCount=6]="ThrottledCount";u[u.Last=7]="Last"})(x||(x=
{}));Object(E.b)("EventCountType",x);var y=c(1624);c.d(K,"FrequentLoggingMetrics",function(){return n});class n{constructor(u){this.XGh=this.WZh=null;this.FMi=this.Q1h=0;this.Qt=null;this.m5g=this.gJe=0;this.Yf=u;this.Jym();this.Uze=this.ZUg=this.QJe=!1;this.Cwc=0}get Rxl(){return this.Uze}cBo(u){this.m5g=u;window.setInterval(Object(f.a)(this,this.vKf,"logMetricsBatchAndReset"),u);this.gJe=(new Date).getTime()}WO(u,z){this.Npo(u)&&!this.ZUg||this.Rxl||!window.navigator.onLine||this.Yf.gQa||(this.Qt[u][z]++,
this.QJe=!0)}Jym(){this.Qt=Array(3);for(let u=0;3>u;u++){this.Qt[u]=Array(7);for(let z=0;7>z;z++)this.Qt[u][z]=0}}mNk(){const u={};for(let z=0;3>z;z++)for(let w=0;7>w;w++)this.YTm(z,w)&&(u[k[z]+x[w]]=this.Qt[z][w]);u.FSDomain=this.WZh;u.ConnectionDomain=this.XGh;u.FSRetryInterval=this.Q1h;u.MaxPayloadSize=this.FMi;u.LogNumber=this.Cwc;1===this.Cwc&&(u.FSLatencies=y.a.instance.TVl(),u.ConLatencies=y.a.instance.yQl());return u}YTm(u,z){return 2===u&&3!==z&&0!==z?!1:!0}Npo(u){return 2===u?!1:!0}vKf(){if(this.QJe){this.Cwc++;
if((new Date).getTime()-this.gJe<5E3+this.m5g){var u=a.a.toJSON(this.mNk());l.ULS.sendTraceTag(50644352,500,15,u)}this.gJe=(new Date).getTime();for(u=0;3>u;u++)for(let z=0;7>z;z++)this.Qt[u][z]=0;this.QJe=!1}}O9m(){this.ZUg=!0}static get instance(){return n._instance}static create(u){n.instance||(n._instance=new n(u));return n.instance}}n._instance=null;Object(E.a)(n,"FrequentLoggingMetrics",null,[1224])},1536:function(E,K,c){c.r(K);E=c(0);var l=c(7),f=c(55),a=c(458),k=c(874),x=c(77),y=c(2);class n{constructor(oa,
za){this.status=oa;this.scc=za}}Object(E.a)(n,"UserStatusInfo",null,[]);var u=c(57),z=c(1624);class w{constructor(oa,za){this.data=oa;this.timeStamp=za}}Object(E.a)(w,"PresenceData",null,[]);class F{constructor(oa){this.HBa=!1;this.cyb=0;this.Rve=!1;this.setTimeout=F.Vcf;this.clearTimeout=F.Ocf;this.g7m=Object(f.a)(this,this.V5m,"logRtcConnectingUsageStatement");this.Fw=oa}Jln(){this.HBa||(this.cyb=this.setTimeout(()=>{this.HBa=!1;this.WJi()},8E3),this.HBa=!0,this.Rve=!1)}Cmn(){this.g_()}Btn(){this.WJi()}WJi(){this.g_();
this.Rve||(this.Rve=!0,this.g7m())}V5m(){l.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.Fw)}g_(){this.HBa&&this.clearTimeout(this.cyb);this.cyb=0;this.HBa=!1}static Vcf(oa,za){return window.setTimeout(oa,za)}static Ocf(oa){window.clearTimeout(oa)}}Object(E.a)(F,"ConnectedUsageKpiLogger",null,[1245]);class G{constructor(){this.O6i=this.Z2f;this.R6i=this.b3f;this.Q6i=this.a3f;this.V6i=this.d3f;this.U6i=this.c3f;this.o3f=this.p3f;this.u3c=this.m3f;this.tMb=
this.k3f;this.uMb=this.l3f;this.P6i=this.$2f;this.kRa=this.lQf;this.xlb=this.mQf}Z2f(){}b3f(){}a3f(){}d3f(){}c3f(){}m3f(){}l3f(){}k3f(){}p3f(){}$2f(){}lQf(){}mQf(){}}Object(E.a)(G,"NoopRealtimeChannelMetrics",null,[1233,139]);class H{}H.Pad="presenceUpdated";H.updateNotification="updateNotification";H.L0i="persistentStateCleared";H.updatePersistentState="persistentStateUpdated";Object(E.a)(H,"RtcClientMethodNames",null,[]);class L{}L.stm="realtimeChannelHub";L.Pad="UpdatePresence";L.aN="SendUpdateNotification";
L.jof="GetCompletePersistentStateWithMetadata";L.updatePersistentState="UpdatePersistentState";L.gqb="UpdateClientInfo";Object(E.a)(L,"RtcHubMethodNames",null,[]);class I{constructor(oa){this.$v=oa}iWn(oa){this.$v.on(H.Pad,oa)}cXn(oa){this.$v.on(H.updateNotification,oa)}hWn(oa){this.$v.on(H.updatePersistentState,oa)}gWn(oa){this.$v.on(H.L0i,oa)}SQo(oa){this.$v.off(H.Pad,oa)}bRo(oa){this.$v.off(H.updateNotification,oa)}RQo(oa){this.$v.off(H.updatePersistentState,oa)}QQo(oa){this.$v.off(H.L0i,oa)}Pad(oa){return this.$v.invoke(L.Pad,
oa)}gqb(oa){return this.$v.invoke(L.gqb,oa)}aN(oa,za){return this.$v.invoke(L.aN,oa,za)}jof(oa){return this.$v.invoke(L.jof,oa)}updatePersistentState(oa,za){return this.$v.invoke(L.updatePersistentState,oa,za)}}Object(E.a)(I,"RealtimeChannelProxy",null,[1242,1243,1244]);class N{constructor(){this.ote=this.aMg=!1;this.mte=0;this.gve=this.IRe=this.HRe=this.ose=!1;this.uAe=0;this.wdh=!1;this.vdh=this.udh=0;this.dQe=!1;this.kQe=this.iQe=this.mQe=this.eQe=0;this.jQe=!1}get uIk(){return this.ote}get tIk(){return this.mte}get QAk(){return this.ose}get qro(){return this.HRe}get rro(){return this.IRe}get JYk(){return this.gve}get YLd(){return this.uAe}get L8n(){return this.wdh}get dfj(){return this.udh}get K8n(){return this.vdh}get G8n(){return this.dQe}get H8n(){return this.eQe}get jfj(){return this.mQe}get efj(){return this.iQe}get gfj(){return this.kQe}get ffj(){return this.jQe}static createInstance(oa){const {RealtimeChannel:za}=
c(1536);return oa?Object.assign(new N,{aMg:oa.$("AwayStatusManagerIsEnabled"),ote:oa.$("AwayStatusOneMinuteTimeoutIsEnabled"),mte:oa.mc("AwayCoauthorThresholdMs",9E5),ose:oa.$("RtcAllowCrossDomainAccessEnabled"),HRe:oa.$("ShouldLogOnContentNotification"),IRe:oa.$("ShouldLogOnHostSubscriptionNotification"),gve:oa.$("RtcClientMetricsEnabled"),uAe:oa.mc("RtcFindSessionRequestTimeoutInMS",6E4),wdh:oa.$("RtcJsClientFrequentlyLogsMetrics"),udh:oa.mc("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),
vdh:oa.mc("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),dQe:oa.$("RtcClientMessageTelemetryEnabled"),eQe:oa.mc("RtcClientMessageTelemetrySampleSize",5),mQe:oa.mc("RtcSendTelemetryMessageIntervalInMS",3E5),iQe:oa.mc("RtcLogClientMessageMetricsTimeOutInMs",2E4),kQe:oa.mc("RtcMaxPayloadSizeInCharactersOverride",za.hMf),jQe:oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new N,{aMg:!1,ote:!1,mte:9E5,ose:!1,HRe:!1,IRe:!0,gve:!1,uAe:9E4,dQe:!1,
eQe:5,mQe:3E5,iQe:2E4,kQe:za.hMf,jQe:!1})}}Object(E.a)(N,"RealtimeChannelSettings",null,[1241]);var P=c(1753),M=c(73),J=c(149);class V{constructor(oa){this.ZBc=null;this.KSa=0;this.OCb=!1;this.Im=oa;this.Im.Fta(Object(f.a)(this,this.Vha,"onConnectionStateChanged"))}Vha(oa,za){this.KSa=za.newState}hun(){l.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.Im.Zbe()}exm(oa){this.ZBc.init(oa)}}Object(E.a)(V,"ARtcMessageHandler",null,[]);var X=c(353);class W{constructor(){this.Presence=
null;this.TimeStamp=0}}Object(E.a)(W,"PresenceDataEntryForClients",null,[]);var U=c(82);class Y{constructor(oa,za=""){this.Thk=oa;this.zsa=za}send(){return this.Thk()}get messageId(){return this.zsa}}Object(E.a)(Y,"MessageHandler",null,[1250]);var ca=c(1654);class aa extends Sys.EventArgs{constructor(oa,za,Fa,kb){super();this.A6f=oa;this.reconnectDelay=za;this.reason=Fa;this.O9f=kb}}Object(E.a)(aa,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var fa=c(1709);class pa{constructor(){this.bTe=this.ii=
null}get ti(){return this.ii?this.bTe?this.bTe.getTime()-this.ii.getTime():(new Date).getTime()-this.ii.getTime():0}start(){this.ii=new Date}stop(){this.bTe=new Date}}Object(E.a)(pa,"SimpleStopwatch",null,[]);var ra=c(1710),la;(function(oa){oa[oa.contentUpdate=0]="contentUpdate";oa[oa.editorsTableUpdate=1]="editorsTableUpdate";oa[oa.fileNameUpdate=2]="fileNameUpdate";oa[oa.wetContentUpdate=3]="wetContentUpdate";oa[oa.persistedContentUpdate=4]="persistedContentUpdate";oa[oa.clientRtcReconnectRequest=
5]="clientRtcReconnectRequest";oa[oa.replicationTelemetry=6]="replicationTelemetry";oa[oa.lockUpdate=7]="lockUpdate";oa[oa.collabServiceContentUpdate=8]="collabServiceContentUpdate";oa[oa.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";oa[oa.saveTargetUpdate=10]="saveTargetUpdate";oa[oa.uploadToOcsUpdate=11]="uploadToOcsUpdate";oa[oa.labelUpdate=12]="labelUpdate";oa[oa.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";oa[oa.subscribeOrExtend=14]="subscribeOrExtend";
oa[oa.elapsedBootTelemetry=15]="elapsedBootTelemetry";oa[oa.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";oa[oa.clientToClientResponseMessage=17]="clientToClientResponseMessage";oa[oa.verifyNotificationPipeline=18]="verifyNotificationPipeline";oa[oa.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";oa[oa.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";oa[oa.last=21]="last"})(la||(la={}));Object(E.b)("UpdateNotificationType",la);var qa=c(752),La=c(595),Pa=c(596);
class Ka extends V{constructor(oa,za,Fa,kb,fb,lb,sb,ab,Ga,Ua){super(sb);this.$v=null;this.c5g=!1;this.zsa=0;this.kNe=new J.a;this.D9j=Ka.$Ql();this.sMe=y.AFrameworkApplication.K.jb("OwningFeatureCrewForRtcNotificationKpis");this.Vf=oa;this.M7g=this.L7g=0;this.ZBc=za;this.ZBc.Czd(Object(f.a)(this,this.hun,"onTooManyUndeliveredMessages"));this._clientId=Fa;this.xfk=fb;this.Im.lyk(Object(f.a)(this,this.Hrn,"onRefreshProxyRequired"));this.Im.jyk(Object(f.a)(this,this.Frn,"onRefreshAllPersistentStateRequest"));
this.Im.tyk(Object(f.a)(this,this.aN,"sendUpdateNotification"));this.Im.kwk(Object(f.a)(this,this.Pon,"onInternalPresenceUpdated"));this.Im.lwk(Object(f.a)(this,this.Qon,"onInternalUpdateNotificationReceived"));this.Im.jwk(Object(f.a)(this,this.Oon,"onInternalPersistentStateUpdated"));this.Im.iwk(Object(f.a)(this,this.Non,"onInternalPersistentStateCleared"));this.Im.ryk(Object(f.a)(this,this.lic,"sendPersistentState"));this.Im.Hyk(Object(f.a)(this,this.gqb,"updateClientInfo"));this.ge=lb;this.Fw=
kb;this.Qt=ab;this.WV=Ga;this.Zwc=Ua;this.tra=Object(M.a)(String,y.AFrameworkApplication.sessionStartInfoSettings.Application)||""}Hrn(oa,za){this.$v=this.xfk(za.hubConnection);this.ZBc.reset();this.$v.iWn(Object(f.a)(this,this.I4,"onPresenceUpdated"));this.$v.hWn(Object(f.a)(this,this.ARa,"onPersistentStateUpdated"));this.$v.gWn(Object(f.a)(this,this.Gec,"onPersistentStateCleared"));this.$v.cXn(Object(f.a)(this,this.x0,"onUpdateNotificationReceived"))}Vha(oa,za){this.KSa=za.newState;2===za.newState&&
this.$co()}$co(){for(let oa of this.kNe)this.aN(null,new fa.a(oa.key,oa.value,!1,new a.a));this.kNe=new J.a}Frn(oa,za){za.b7e();for(oa=0;3>oa;++oa)this.Cco(oa,za)}Cco(oa,za){try{this.$v.jof(oa).done(Fa=>{za.Xmc(za.Z8e,"GetCompletePresenceSuccess")&&(za.m3k.Btn(),l.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}]",this.Fw),this.Im.BNn(),this.Pqn(oa,Fa),this.Im.RMn(Fa),za.BXh.nb(oa)&&this.Im.N5i(oa,za.BXh.J(oa),new a.a))}).fail(Fa=>{const {RtcUtils:kb}=c(1506);
za.Xmc(za.Z8e,"GetCompletePresenceFail")&&(l.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}]",kb.iec(Fa),this.Fw),this.Im.Zbe())}).always(()=>{za.UA&&za.UA.stop()})}catch(Fa){l.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",za.Z8e,Fa.message)}}lic(oa,za){var {RtcUtils:Fa}=c(1506);oa=za.presence;let kb;const fb=
za.m7a;this.WV.WO(1,0);try{kb=Fa.x6e(oa,this.Zwc)}catch(sb){this.WV.WO(1,3);l.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",sb.message);fb.setException(sb);return}Fa=new x.a;Fa.Z(this._clientId,Object.assign(new W,{Presence:oa,TimeStamp:(new Date).getTime()}));this.Im.U5i(za.type,Fa);if(2!==this.KSa)this.Qt.tMb(),this.WV.WO(1,2),fb.zg(null);else{var lb=this.zsa.toString();++this.zsa;oa=new Y(()=>this.bdo(za.type,kb,lb),lb);oa=this.tyj(0,
za.type).add(oa);oa.e7d(sb=>{2===sb&&this.WV.WO(1,6);fb.zg(null)});oa.d7d(()=>{})}}bdo(oa,za,Fa){let kb=null;const fb=new pa,lb=new ca.a;l.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}]",this.Fw);if(2!==this.KSa)return this.Qt.tMb(),this.WV.WO(1,2),l.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this.Fw),lb.ULf(),lb;this.ge&&20>this.L7g&&(kb=this.ge.$f("WebServiceCall","Send Presence Message"),this.L7g++);fb.start();lb.vYc(1);try{this.$v.updatePersistentState(oa,
za).done(()=>{this.Qt.u3c();this.WV.WO(1,1);l.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",Fa,this.Fw);lb.flb(1);fb&&(fb.stop(),fb.ti>this.Vf.dfj?this.WV.WO(1,4):this.WV.WO(1,5))}).fail(sb=>{const {RtcUtils:ab}=c(1506);this.OCb||(this.Qt.tMb(),this.WV.WO(1,3),l.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",Fa,ab.iec(sb),this.Fw));lb.flb(2)}).always(()=>{kb&&kb.stop()})}catch(sb){l.ULS.sendTraceTag(593072906,
500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",sb.message),this.WV.WO(1,3),lb.flb(2)}return lb}gqb(oa,za){({RtcUtils:oa}=c(1506));const Fa=za.IYk,kb=za.m7a;let fb;try{fb=oa.x6e(Fa,this.Zwc)}catch(lb){l.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",lb.message);kb.setException(lb);return}try{this.$v.gqb(fb).done(()=>{l.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(lb=>{const {RtcUtils:sb}=
c(1506);this.OCb||l.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",sb.iec(lb));kb.zg(null)})}catch(lb){l.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",lb.message),kb.zg(null)}}aN(oa,za){({RtcUtils:oa}=c(1506));const Fa=za.type,kb=za.wL,fb=za.Wjl,lb=za.m7a;let sb;this.WV.WO(0,0);try{sb=oa.x6e(kb,this.Zwc)}catch(Ga){this.WV.WO(0,3);l.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",
Ga.message);lb.setException(Ga);return}if(2!==this.KSa)fb?this.kNe.Z(Fa,kb):(this.Qt.tMb(),this.WV.WO(0,2)),lb.zg(null);else{var ab=this.zsa.toString();++this.zsa;za=new Y(()=>this.Sdo(Fa,sb,ab),ab);za=this.tyj(1,Fa).add(za);za.e7d(Ga=>{2===Ga&&this.WV.WO(0,6);lb.zg(null)});za.d7d(()=>{})}}Sdo(oa,za,Fa){let kb=null;const fb=new pa,lb=new ca.a;l.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}]",this.Fw);if(2!==this.KSa)return this.Qt.tMb(),this.WV.WO(0,2),l.ULS.sendTraceTag(7934172,
500,15,"Connection is lost - unable to send the message for [{0}]",this.Fw),lb.ULf(),lb;this.ge&&3===oa&&20>this.M7g&&(kb=this.ge.$f("WebServiceCall","Send WetContent Update"),this.M7g++);fb.start();lb.vYc(1);this.$v.aN(oa,za).done(()=>{this.Qt.u3c();this.WV.WO(0,1);l.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",Fa,this.Fw);lb.flb(1);fb&&(fb.stop(),fb.ti>this.Vf.dfj?this.WV.WO(0,4):this.WV.WO(0,5))}).fail(sb=>{const {RtcUtils:ab}=c(1506);this.OCb||
(this.Qt.tMb(),this.WV.WO(0,3),l.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Fa,ab.iec(sb),this.Fw));lb.flb(2)}).always(()=>{kb&&kb.stop()});return lb}I5(){this.$v.SQo(Object(f.a)(this,this.I4,"onPresenceUpdated"));this.$v.RQo(Object(f.a)(this,this.ARa,"onPersistentStateUpdated"));this.$v.QQo(Object(f.a)(this,this.Gec,"onPersistentStateCleared"));this.$v.bRo(Object(f.a)(this,this.x0,"onUpdateNotificationReceived"))}Pon(oa,za){this.I4(za.Xqa,
za.EId)}I4(oa){this.Qt.uMb();this.ARa(0,oa)}Oon(oa,za){this.ARa(za.type,za.Xqa)}Pqn(oa,za){const Fa={};for(let kb in za)Fa[kb]=za[kb].Presence;this.HVi(oa,Fa,za)}ARa(oa,za){this.Qt.uMb();this.HVi(oa,za)}HVi(oa,za,Fa=null){var {RtcUtils:kb}=c(1506);if(l.ULS.W9(500,100))for(var fb in za);delete za[this._clientId];if(!U.a.isEmpty(za)){for(var lb in za)fb=lb,za[fb]=kb.deserialize(za[lb],"Presence",fb,!1,this.Zwc);kb=new x.a;lb=(new Date).getTime();for(let sb in za){fb=za[sb];let ab=sb,Ga;Fa?(Ga=Fa[ab],
Ga.Presence=fb):Ga=Object.assign(new W,{Presence:fb,TimeStamp:lb});kb.Z(ab,Ga)}this.Im.U5i(oa,kb);switch(oa){case 0:this.c5g||(l.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.Fw),this.c5g=!0,y.AFrameworkApplication.Kg&&y.AFrameworkApplication.Kg.H9m());this.Im.G5i(za,[]);break;default:this.Im.sNn(oa,za)}}}Non(oa,za){this.Gec(za.LDd)}Gec(oa){this.Qt.uMb();if(l.ULS.W9(500,100))for(let za=0;za<oa.length;++za);oa.length&&(this.Im.RNn(oa),this.Im.rNn(oa),this.Im.G5i({},
oa))}Qon(oa,za){this.x0(za.type,za.wL)}x0(oa,za=null){this.Vf.qro&&0===oa&&l.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===oa&&this.sMe&&0<this.sMe.length){var Fa=Object.assign(new qa.a,{topLevelKpiName:"ContentUpdateNotificationReceived",featureName:"RtcNotification",crewAlias:this.sMe,vetoPillar:"RealTimeCoauth"});(Fa=X.a.getInstance(Fa))&&Fa.logKpiUsage(this.D9j)}this.Vf.rro&&13===oa&&l.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",
za||"<none>"));this.Qt.uMb();5===oa?(za=(oa=this.Wzn(za))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",oa.reason,oa.reconnectDelay):"Received client reconnection request from the server without params.",l.ULS.sendTraceTag(18637071,500,50,za),this.Im.Zbe(oa)):(za=c(1506).RtcUtils.deserialize(za,String.format("UpdateNotification-{0}",la[oa]),null,!1,this.Zwc),this.Im.QNn(oa,za))}Wzn(oa){try{if(!oa||""===oa)return null;const za=JSON.parse(oa);
return new aa(za[ra.a.A8f],za[ra.a.F8n],za[ra.a.J8n],za[ra.a.O9f])}catch(za){return l.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",za.message),null}}tyj(oa,za){return this.ZBc.mfm(this.nfm(oa,za))}nfm(oa,za){return oa+","+za}static $Ql(){var oa=new Map;oa.set("SkipAria","True");oa=Object.assign(new La.a,{extendedProperties:oa});return Object.assign(new Pa.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:oa,blockFutureEmissionDurationInMs:3E5})}}
Object(E.a)(Ka,"RtcMessageHandler",V,[]);class Na{xLh(oa,za=""){const {MaxOutstandingThrottler:Fa}=c(1706);return Fa.createInstance(oa,za)}Nal(oa,za=""){const {MaxRateThrottler:Fa}=c(1708);return Fa.createInstance(oa,za)}}Object(E.a)(Na,"ThrottlerFactory",null,[1236]);var sa=c(80),wa=c(1711);class ja{constructor(oa){this.Vf=null;this.Ah=!1;this.ra=new sa.a;this.BJe=new x.a;this.zJe=new x.a;this.CUe=oa;this.hVb=this.CUe.xLh(za=>za.send(),"GlobalMaxOustandingThrottler");this.hVb.Czd(()=>{this.ra.raiseEvent("TMUDM")})}init(oa){this.Ah||
(this.Vf=oa,this.hVb.init(this.Vf.Kpb,this.Vf.Kjm),this.Ah=!0)}mfm(oa){var {MaxRateThrottler:za}=c(1708),{MaxOutstandingThrottler:Fa}=c(1706);this.Ah||this.init(new wa.a(za.OOh,Fa.oPh,Fa.ZOh,ja.nan));({value:za}=this.BJe.Dc(oa)).returnValue||(({value:za}=this.zJe.Dc(oa)).returnValue||(za="MaxOutstandingThrottler-"+oa,za=this.CUe.xLh(Object(f.a)(this.hVb,this.hVb.add,"add"),za),za.init(this.Vf.Kpb,this.Vf.man),za.Czd(()=>{this.ra.raiseEvent("TMUDM")}),this.zJe.add(oa,za)),Fa="MaxRateThrottler-"+oa,
za=this.CUe.Nal(Object(f.a)(za,za.add,"add"),Fa),za.init(this.Vf.qcn),this.BJe.add(oa,za));return za}reset(){for(let oa of this.BJe)oa.value.n3f();for(let oa of this.zJe)oa.value.n3f(),oa.value.reset();this.hVb.n3f();this.hVb.reset()}Czd(oa){this.ra.addHandler("TMUDM",oa)}}ja.nan=1E3;Object(E.a)(ja,"ThrottlerManager",null,[1235]);var ha;(function(oa){oa[oa.unspecified=0]="unspecified";oa[oa.word=1]="word";oa[oa.excel=2]="excel";oa[oa.powerPoint=3]="powerPoint";oa[oa.test=4]="test";oa[oa.wacFrontEnd=
5]="wacFrontEnd";oa[oa.oneNote=6]="oneNote";oa[oa.visio=7]="visio";oa[oa.officeMobile=8]="officeMobile";oa[oa.cosmosDBChangefeed=9]="cosmosDBChangefeed";oa[oa.last=10]="last"})(ha||(ha={}));Object(E.b)("RtcClientAppName",ha);const va=(oa,za,Fa,kb,fb,lb,sb,ab,Ga=null,Ua=null,wb=null,cc=null)=>{const zb=N.createInstance(y.AFrameworkApplication.K),nb=y.AFrameworkApplication.buildVersion?y.AFrameworkApplication.buildVersion:"1.0",eb=xa(oa,za,sb,nb),Ib=zb.JYk?c(1866).RealtimeChannelMetrics.createInstance(eb):
new G;var Xa=c(1526).FrequentLoggingMetrics.create(fb);zb.L8n&&Xa.cBo(zb.K8n);var Ra="";Ra=Ga&&""!==Ga?Ga:"/rtc2/";Xa.WZh=u.a.z_(Ra);const gb=Ra+"signalr";Ga=Ra+"findsession";const Bb=L.stm;Ra=new Na;wb=wb||P.a.getInstance();l.ULS.shipAssertTag(556867617,500,zb.gfj<=c(1536).RealtimeChannel.GMi,"Client attempting to override max payload size beyond absolute limit");const $b=Math.min(zb.gfj,c(1536).RealtimeChannel.GMi);Xa.FMi=$b;Xa=new Ka(zb,new ja(Ra),oa,eb,Qb=>new I(Qb.createHubProxy(Bb)),ab,wb,Ib,
Xa,$b);Ua||(Ua=c(1757).FindSessionStrategy.createInstance(za,fb,Ga,ab,nb,sb,oa,eb,wb,lb,kb,cc));Ua.YLd=zb.YLd;za=new F(eb);Fa=Fa?Fa.split(","):null;oa=new (c(1536).RealtimeChannel)(oa,Fa,eb,ab,()=>$.hubConnection(gb),Ua,Xa,za,wb,Ib,zb,fb);oa.init();return oa},xa=(oa,za,Fa)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",oa,ma(ha[Fa]),ma("browser"),za),ma=oa=>oa?oa.charAt(0).toLocaleUpperCase()+oa.substring(1,oa.length):oa;c.d(K,"RealtimeChannel",function(){return Ja});class Ja{constructor(oa,
za,Fa,kb,fb,lb,sb,ab,Ga,Ua,wb,cc){this.$Se=!1;this.d6=null;this.C2=new x.a;this.pqc=1;this.Wda=null;this.$l=!1;this.DHe=(new Date(0)).getTime();this.Zfh=0;this._clientId=oa;this.Lwd=za;this.y$=0;this.ge=kb;this.Qve=ab;this.thk=sb;this.eUj=Ga;this.tZj=fb;this.b9a=lb;this.Fw=Fa;this.Qt=Ua;this.Vf=wb;this.Yf=cc;this.vjk=1>100*Math.random()}get VQa(){return this.b9a.VQa}set VQa(oa){this.b9a.VQa=oa}get Jnb(){return this.thk}get Im(){return this.eUj}init(){this.Im.kyk(Object(f.a)(this,this.DId,"disconnectAndCreateNewConnection"));
this.Im.Kyk(Object(f.a)(this,this.Eun,"onUpdatePersistentStateRequestReceivedInternal"));this.Im.Jyk(Object(f.a)(this,this.Dun,"onUpdatePersistentStateClearedRequestReceived"));this.Yf.g0b(this.Qt);y.AFrameworkApplication.dI(()=>{const {FrequentLoggingMetrics:oa}=c(1526);this.Qt.o3f();oa.instance&&oa.instance.vKf()});this.PLh();this.dnl();this.Im.vyk(Object(f.a)(this,this.aTo,"updateConnectionQueryString"))}dnl(){try{const Fa=$.signalR;if(!Fa)throw Error.invalidOperation("Failed to retrieve Signalr object");
const kb=Fa.version;if(!kb)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===kb){var oa=Fa.transports;if(!oa)throw Error.invalidOperation("Failed to retrieve transports object");var za=oa.longPolling;if(!za)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!za.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");za.supportsKeepAlive=this.jdl()}}catch(Fa){l.ULS.sendTraceTag(6432339,
500,15,"Failed to disable longPolling KeepAlives: {0}",Fa.message)}}jdl(){return()=>!1}PLh(){const oa=++this.pqc;this.DHe=(new Date(0)).getTime();this.Wda=this.tZj();this.Im.yNn(this.Wda);this.Wda.stateChanged(za=>{this.Nln(za,oa)});this.Wda.connectionSlow(Object(f.a)(this,this.ttn,"onSlowConnection"));this.Wda.error(Object(f.a)(this,this.ktn,"onSignalRError"));this.Wda.log=Object(f.a)(this,this.ltn,"onSignalRLog")}Xmc(oa,za){return oa!==this.pqc?(l.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",
za),!1):!0}connect(){2!==this.y$&&1!==this.y$&&(l.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.Fw),this.Qve.Jln(),z.a.instance.dBo(),this.Vha(1,this.y$),this.quj())}quj(){const oa=this.pqc;this.$Se=!1;this.Qt.O6i();this.b9a.X$l(Object(f.a)(this,this.k3k,"connectSignalrConnection"),Object(f.a)(this,this.NTi,"onFailureToConnect"),Object(f.a)(this.Jnb,this.Jnb.exm,"initThrottlerManager"),Object(f.a)(this,this.Xmc,"verifyConnectionToken"),oa)}NTi(oa=null){this.Qt.Q6i();
let za=null;!oa||"documentsessiondeleted"!==(za=oa.toLowerCase())&&"documentsessionexpired"!==za?this.DId():(l.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.Fw,oa),this.disconnect())}DId(oa,za=null){l.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.d6);oa=(oa=2===this.y$||1===this.y$)&&!this.Jnb.OCb;let Fa=!0,kb=0;za&&Object.getType(za)!==Object.getType(Sys.EventArgs.Empty)&&
za.A6f&&""!==za.A6f&&(oa=!0,this.b9a.Elo(za.A6f),Fa=za.O9f,kb=za.reconnectDelay);oa&&this.Vha(1,this.y$);++this.pqc;this.Jnb.I5();this.pCo(Fa);this.b9a.Fol();this.PLh();oa&&window.setTimeout(Object(f.a)(this,this.quj,"startConnecting"),Math.min(kb,3E4))}aTo(){let oa=null;const za=({correlationId:oa}=this.b9a.o8h()).returnValue;this.Wda.qs=za;l.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.Fw,oa)}k3k(oa){const {FrequentLoggingMetrics:za}=
c(1526);this.DHe=(new Date).getTime();let Fa=null;this.Wda.qs=({correlationId:Fa}=this.b9a.o8h()).returnValue;this.Vf.QAk&&(this.Wda.url=oa,za.instance&&(za.instance.XGh=u.a.z_(oa)));let kb=null;this.ge&&(kb=this.ge.$f("WebServiceCall","ConnectToServer"));l.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.Fw);oa={};this.Lwd&&(oa.transport=1===this.Lwd.length?this.Lwd[0]:this.Lwd);oa.pingInterval=null;z.a.instance.t3c(1,0);oa.waitForPageLoad=!1;this.Wda.start(oa,null).done(fb=>
{this.Qt.R6i();z.a.instance.t3c(1,1,!0);l.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",fb.id,Fa)}).fail(fb=>{l.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",this.b9a.eX,Fa,this.Fw);this.NTi();this.Qt.P6i(fb);z.a.instance.t3c(1,1,!1);this.Im.K5i(0,{["CorrelationId"]:Fa,["ErrorDetails"]:fb,["ConnectionState"]:k.a[this.y$]})}).always(()=>{const {FrequentLoggingMetrics:fb}=
c(1526);kb&&kb.stop();fb.instance&&(fb.instance.Uze=!1)})}disconnect(){const {FrequentLoggingMetrics:oa}=c(1526);0===this.y$?l.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.Fw):(this.Qt.U6i(),oa.instance&&(oa.instance.Uze=!0),l.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.Fw),this.Jnb.OCb=!0,this.Qve.Cmn(),this.Vha(0,this.y$),this.DId(),this.Jnb.OCb=!1)}pCo(oa){const za=this.bRk(),Fa=this.Wda,kb=this.d6,
fb=()=>{if(this.$Se)l.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.$Se=!0,Fa.stop(!0,oa)}catch(lb){l.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",lb.message)}};0<za?(l.ULS.sendTraceTag(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",kb,za),window.setTimeout(fb,za)):(l.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",kb),fb())}bRk(){let oa=0;0===this.Wda.state&&(oa=this.DHe+Ja.O1o-
(new Date).getTime(),0>oa&&(oa=0));return oa}get connectionState(){return this.y$}Fta(oa){this.Im.Fta(oa)}$gc(oa){this.Im.$gc(oa)}vij(oa){this.lic(0,oa)}lic(oa,za){const Fa=new a.a;this.Im.N5i(oa,za,Fa);return Fa.task}aZa(oa){this.Im.aZa(oa)}SMb(oa){this.Im.SMb(oa)}MDc(oa){this.Im.MDc(oa)}r4c(oa){this.Im.r4c(oa)}zzd(oa){this.Im.zzd(oa)}gde(oa){this.Im.gde(oa)}KPc(oa){return this.mhm(oa)}BDb(){return this.P6b(0)}P6b(oa){const za={};for(let Fa of this.C2)Fa.value.nb(oa)&&(za[Fa.key]=Fa.value.J(oa).data);
return za}mhm(oa){return this.C2.nb(oa)&&this.C2.J(oa).nb(0)?this.C2.J(oa).J(0).data:null}Eun(oa,za){for(let Fa of za.MYo)this.C2.nb(Fa.key)||this.C2.Z(Fa.key,new J.a),oa=Fa.value,this.C2.J(Fa.key).Z(za.type,new w(oa.Presence,new Date(oa.TimeStamp))),Fa.key===this._clientId&&0===za.type&&this.Im.dNn(oa.Presence)}Dun(oa,za){for(const Fa of za.LDd)this.C2.remove(Fa)}gLl(){const oa=new J.a;if(!this.C2.nb(this._clientId))return oa;for(let za of this.C2.J(this._clientId))oa.Z(za.key,za.value.data);return oa}aN(oa,
za=null,Fa=!1){const kb=new a.a;this.Im.w2f(oa,za,Fa,kb);return kb.task}c3(oa){this.Im.c3(oa)}TMb(oa){this.Im.TMb(oa)}Vhb(oa){let za,Fa;return({value:za}=this.C2.Dc(oa)).returnValue&&({value:Fa}=za.Dc(0)).returnValue?new n(this.rhm(Fa),Fa.timeStamp):null}$Mc(){const oa={};for(let za of this.C2)za.value.Dc(0).returnValue&&(oa[za.key]=this.Vhb(za.key));return oa}gqb(oa){const za=new a.a;this.Im.T5i(oa,za);return za.task}get clientId(){return this._clientId}get sxo(){return this.vjk}dispose(){const {FrequentLoggingMetrics:oa}=
c(1526);this.$l||(this.Jnb.I5(),this.Yf.Xce(this.Qt),this.Qt.o3f(),oa.instance&&oa.instance.vKf(),this.$l=!0)}Nln(oa,za){this.Xmc(za,"StateChangedSignalR")&&this.Vha(this.IIh(oa.newState),this.IIh(oa.oldState))}Vha(oa,za){var {FrequentLoggingMetrics:Fa}=c(1526),{ClientToClientMessageTelemetry:kb}=c(1770);if((1!==this.y$||0!==za||1!==oa)&&this.y$!==za){const fb=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.y$,
za,oa]));l.ULS.sendTraceTag(3290053,500,10,fb)}if(this.y$!==oa){switch(oa){case 2:Fa.instance&&Fa.instance.O9m();this.d6=this.Wda.id;l.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.d6,this.Fw);this.K6m(this.Wda);l.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");Fa=null;this.ge&&(Fa=this.ge.$f("WebServiceCall","Receive First Presence"));kb=this.pqc;this.Im.xNn(Object(f.a)(this,this.Xmc,"verifyConnectionToken"),kb,this.Qve,Object(f.a)(this,
this.b7e,"clearExistingPersistentState"),this.gLl(),Fa);this.Vf.G8n&&(Fa=100*Math.random()<=this.Vf.H8n,c(1770).ClientToClientMessageTelemetry.X7b(this.Im,this.Vf,Fa).start());break;case 1:2===za&&l.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.d6);break;case 0:if(kb.instance&&kb.instance.stop(),this.Jnb.OCb)l.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.d6);else{1===za&&(l.ULS.sendTraceTag(7672737,500,
50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.d6),this.Qt.V6i());2===za&&l.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.d6);this.DId();return}}this.y$=oa;this.Im.CMn(oa,za)}}K6m(oa){if(oa&&oa.transport&&oa.transport.name){oa=oa.transport.name;var za=oa.toLowerCase();
"websockets"===za?l.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",oa,this.Fw):"serversentevents"===za?l.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",oa,this.Fw):"foreverframe"===za?l.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",oa,this.Fw):"longpolling"===za?l.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",oa,this.Fw):"mocktransport"!==za&&l.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",
oa)}else l.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}ttn(){if(this.Vf.ffj){const oa=u.a.dU(this.VQa,"mid");l.ULS.sendTraceTag(3249544,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.d6,oa)}else l.ULS.sendTraceTag(522716053,500,50,"Detected that the connection [{0}] is slow",this.d6)}ktn(){l.ULS.sendTraceTag(3249545,600,15,"SignalR ERROR for connection [{0}];",this.d6)}ltn(oa){oa=c(1506).RtcUtils.iec(oa);if(this.Vf.ffj&&oa.startsWith("Keep alive timed out.")){const za=
u.a.dU(this.VQa,"mid");l.ULS.sendTraceTag(522716054,500,15,"SignalR lib: {0}. Target Machine: {1}",oa,za)}else this.sxo&&2E3>this.Zfh&&!oa.startsWith("Invok")&&!oa.startsWith("Trigger")&&(l.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",oa),this.Zfh++)}b7e(){let oa;const za=[];({value:oa}=this.C2.Dc(this._clientId)).returnValue&&this.C2.remove(this._clientId);for(let Fa of this.C2.keys)Array.add(za,Fa);for(const Fa of za)this.C2.remove(Fa);oa&&this.C2.Z(this._clientId,oa);this.Im.YMn(za)}IIh(oa){switch(oa){case 0:return 1;
case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",oa,"Unknown SignalR state");}}rhm(oa){return oa&&oa.timeStamp?(new Date).getTime()-oa.timeStamp.getTime()>(this.Vf.uIk?6E4:this.Vf.tIk)?2:1:1}static createInstance(oa,za,Fa,kb,fb,lb,sb,ab=null,Ga=null,Ua=null,wb=null,cc=null,zb=null){return va(oa,za,Fa,zb,kb,fb,lb,sb,ab,Ga,Ua,cc,wb)}}Ja.GMi=31E3;Ja.hMf=8E3;Ja.O1o=15E3;Object(E.a)(Ja,"RealtimeChannel",null,[1211,1212])},1624:function(E,K,c){c.d(K,"a",function(){return l});
E=c(0);class l{constructor(){this.ahh=!1;this.Bwb=null;this.nQg=0;this.sAe=this.fNh();this.Gfd=this.fNh();this.Urb=this.cVb=0;this.fq=()=>new Date}get yDo(){return this.ahh}fNh(){const f=Array(6);for(let a=0;a<f.length;a++)f[a]=0;return f}TVl(){return this.sAe.toString()}yQl(){return this.Gfd.toString()}dBo(){this.Bwb=this.fq()}t3c(f,a,k=!1){this.yDo||(k&&(this.ahh=!0),k=this.fq(),0===f&&5<this.cVb||1===f&&5<this.Urb||(this.nQg<f?(1===this.cVb%2&&(this.sAe[this.cVb]=-1,this.cVb++),this.nQg=f,1===
a&&(this.Gfd[this.Urb]=-1,this.Urb++),this.Gfd[this.Urb]=this.jgg(k),this.Urb++):0===f?(this.sAe[this.cVb]=this.jgg(k),this.cVb++):(this.Gfd[this.Urb]=this.jgg(k),this.Urb++)))}jgg(f){const a=f.getTime()-this.Bwb.getTime();this.Bwb=f;return a}static get instance(){l._instance||(l._instance=new l);return l._instance}static set instance(f){l._instance=f}}l._instance=null;Object(E.a)(l,"LatencyMetrics",null,[])},1654:function(E,K,c){E=c(0);class l{constructor(){this.kNg=this.Kve=!1;this.callback=null}p_c(a){this.callback=
a;this.EAj()}YLi(a){this.Kve||(this.Kve=!0,this.lZj=a,this.EAj())}EAj(){this.Kve&&this.callback&&!this.kNg&&(this.kNg=!0,this.callback(this.lZj))}}Object(E.a)(l,"CompletionTask",null,[]);c.d(K,"a",function(){return f});class f{constructor(){this.n6g=new l;this.l6g=new l}e7d(a){this.n6g.p_c(a)}d7d(a){this.l6g.p_c(a)}vYc(a){this.n6g.YLi(a)}flb(a){this.l6g.YLi(a)}ULf(){this.vYc(2);this.flb(2)}}Object(E.a)(f,"MessageStatus",null,[1249])},1706:function(E,K,c){c.r(K);c.d(K,"MaxOutstandingThrottler",function(){return k});
E=c(0);var l=c(55),f=c(80);K=c(1707);var a=c(1654);class k extends K.a{constructor(x,y=""){super(x,y);this.rdc=this.Kpb=0;this.ra=new f.a;this.jWb=!1;this.tpd=this.jgd=this.Hfd=this.BUe=0;this.T2=[];this.clearTimeout=k.Ocf}add(x){this.kWb||this.init(k.oPh,k.ZOh);this.gyb++;const y=new a.a;this.Pac?this.hhe(x,y):this.tpd<this.rdc?this.o6c(x,y):(this.hhe(x,y),this.jWb=!1);return y}o6c(x,y){x=this.teh(x);const n=this.setTimeout(Object(l.a)(this,this.Jpn,"onMessageWaitTimeExpired"),this.Kpb);++this.tpd;
Array.add(this.T2,n);const u=this.Hfd;x.e7d(z=>{y.vYc(z)});x.d7d(z=>{this.Hfd===u&&(this.Ipn(u,n),y.flb(z))})}Ipn(x,y){this.Hfd===x&&(--this.tpd,this.clearTimeout(y),Array.remove(this.T2,y),this.Pac&&this.Fdo())}Fdo(){this.Pac&&!this.jWb&&(this.BUe=this.setTimeout(Object(l.a)(this,this.Gdo,"sendThrottledMessageFromTimer"),0),this.jWb=!0)}Gdo(){this.jWb=!1;if(this.Pac){const x=this.hwd,y=this.RZb;this.qGc(!1);this.o6c(x,y)}}Jpn(){++this.jgd;this.jgd>Math.floor(this.rdc/2)&&(this.jgd=-1E9,this.ra.raiseEvent("TMUDM"))}Czd(x){this.ra.addHandler("TMUDM",
x)}reset(){this.gyb=this.YBc=this.csc=this.jgd=0;++this.Hfd;for(const x of this.T2)this.clearTimeout(x);this.tpd=0;this.T2=[];this.qGc(!0);this.jWb&&(this.clearTimeout(this.BUe),this.BUe=0,this.jWb=!1)}init(x,y){this.kWb||(this.Kpb=x,this.rdc=y,this.kWb=!0)}static createInstance(x,y=""){return new k(x,y)}static Ocf(x){window.clearTimeout(x)}}k.oPh=15E3;k.ZOh=5;Object(E.a)(k,"MaxOutstandingThrottler",K.a,[1246,1247])},1707:function(E,K,c){c.d(K,"a",function(){return f});E=c(0);var l=c(7);class f{constructor(a,
k=""){this.csc=this.YBc=0;this.CFe=!1;this.RZb=this.hwd=null;this.kWb=!1;this.teh=a;this.uyj=k;this.setTimeout=f.Vcf;this.gyb=this.YBc=this.csc=0}n3f(){0<this.gyb&&0<this.csc&&l.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.uyj,this.csc,this.gyb);0<this.gyb&&0<this.YBc&&l.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.uyj,this.YBc,this.gyb)}get Pac(){return this.CFe}hhe(a,k){this.YBc++;this.qGc(!0);this.CFe=
!0;this.hwd=a;this.RZb=k}qGc(a){this.CFe=!1;this.RZb&&a&&(this.csc++,this.RZb.ULf());this.RZb=this.hwd=null}static Vcf(a,k){return window.setTimeout(a,k)}}Object(E.a)(f,"ThrottlerBase",null,[])},1708:function(E,K,c){c.r(K);c.d(K,"MaxRateThrottler",function(){return a});E=c(0);var l=c(55);K=c(1707);var f=c(1654);class a extends K.a{constructor(k,x=""){super(k,x);this.Adc=0;this.dwc=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(k){this.kWb||(this.Adc=k,this.kWb=!0)}add(k){this.kWb||
this.init(a.OOh);this.gyb++;const x=this.currentTime(),y=new f.a;this.dwc>x&&(this.dwc=x);this.Pac?(this.qGc(!0),this.hhe(k,y)):this.dwc+this.Adc<=x?this.o6c(k,y):(this.hhe(k,y),this.setTimeout(Object(l.a)(this,this.Edo,"sendThrottledMessage"),this.dwc+this.Adc-x));return y}Edo(){if(this.Pac){const k=this.hwd,x=this.RZb;this.qGc(!1);this.o6c(k,x)}}o6c(k,x){this.dwc=this.currentTime();k=this.teh(k);k.e7d(y=>{x.vYc(y)});k.d7d(y=>{x.flb(y)})}static createInstance(k,x=""){return new a(k,x)}}a.OOh=200;
Object(E.a)(a,"MaxRateThrottler",K.a,[1248,1247])},1709:function(E,K,c){c.d(K,"a",function(){return l});E=c(0);class l extends Sys.EventArgs{constructor(f,a,k,x){super();this.type=f;this.wL=a;this.Wjl=k;this.m7a=x}}Object(E.a)(l,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1710:function(E,K,c){c.d(K,"a",function(){return l});E=c(0);class l{}l.A8f="rr";l.J8n="rd";l.F8n="rbp";l.O9f="sa";Object(E.a)(l,"RtcReconnectParams",null,[])},1711:function(E,K,c){c.d(K,"a",function(){return l});E=c(0);
class l{constructor(f,a,k,x){this.qcn=f;this.Kpb=a;this.man=k;this.Kjm=x}}Object(E.a)(l,"ThrottlerManagerSettings",null,[])},1753:function(E,K,c){E=c(0);class l extends Sys.EventArgs{constructor(J,V){super();this.newState=J;this.oldState=V}}Object(E.a)(l,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class f extends Sys.EventArgs{constructor(J,V){super();this.IYk=J;this.m7a=V}}Object(E.a)(f,"ClientInfoEventArgs",Sys.EventArgs,[]);class a extends Sys.EventArgs{constructor(J){super();this.presence=
J}}Object(E.a)(a,"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);var k=c(1868),x=c(1867),y=c(1865);class n extends Sys.EventArgs{constructor(J,V=null){super();this.Ck=J;this.$mk=V}get type(){return this.Ck}get wL(){return this.$mk}}Object(E.a)(n,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class u extends Sys.EventArgs{constructor(){super()}}Object(E.a)(u,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class z extends Sys.EventArgs{constructor(J,V,X,W,U,Y){super();this.Xmc=J;
this.Z8e=V;this.m3k=X;this.BXh=U;this.b7e=W;this.UA=Y}}Object(E.a)(z,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class w extends Sys.EventArgs{constructor(J){super();this.hubConnection=J}}Object(E.a)(w,"RefreshProxyEventArgs",Sys.EventArgs,[]);class F extends Sys.EventArgs{constructor(J,V){super();this.lga=J;this.errorMessage=V}}Object(E.a)(F,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class G extends Sys.EventArgs{constructor(J,V,X){super();this.type=J;this.presence=V;this.m7a=X}}Object(E.a)(G,
"SendPersistentStateEventArgs",Sys.EventArgs,[]);var H=c(1709);class L extends Sys.EventArgs{constructor(){super()}}Object(E.a)(L,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class I extends Sys.EventArgs{constructor(J){super();this.LDd=J}}Object(E.a)(I,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class N extends Sys.EventArgs{constructor(J,V){super();this.type=J;this.MYo=V}}Object(E.a)(N,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var P=c(80);c.d(K,"a",
function(){return M});class M{constructor(){this.ra=new P.a}CMn(J,V){this.ra.raiseEvent("CSC",new l(J,V))}yNn(J){this.ra.raiseEvent("RP",new w(J))}Zbe(J){this.ra.raiseEvent("RC",J)}BNn(){this.ra.raiseEvent("RMID")}xNn(J,V,X,W,U,Y){this.ra.raiseEvent("RPS",new z(J,V,X,W,U,Y))}U5i(J,V){this.ra.raiseEvent("UPSR",new N(J,V))}G5i(J,V){this.ra.raiseEvent("PU",new y.a(J,V))}dNn(J){this.ra.raiseEvent("MPU",new a(J))}w2f(J,V,X,W){this.ra.raiseEvent("SUN",new H.a(J,V,X,W))}QNn(J,V){this.ra.raiseEvent("UNR",
new n(J,V))}N5i(J,V,X){this.ra.raiseEvent("SP",new G(J,V,X))}sNn(J,V){this.ra.raiseEvent("PSU",new x.a(J,V))}rNn(J){this.ra.raiseEvent("PSC",new k.a(J))}YMn(J){this.ra.raiseEvent("IPSC",new k.a(J))}RNn(J){this.ra.raiseEvent("UPSC",new I(J))}DNn(J,V){this.ra.raiseEvent("SPC",new L(J,V))}K5i(J,V){this.ra.raiseEvent("RCF",new F(J,V))}RMn(J){this.ra.raiseEvent("CPSWM",new u(J))}T5i(J,V){this.ra.raiseEvent("UCI",new f(J,V))}Fta(J){this.ra.addHandler("CSC",J)}$gc(J){this.ra.removeHandler("CSC",J)}lyk(J){this.ra.addHandler("RP",
J)}kyk(J){this.ra.addHandler("RC",J)}oyk(J){this.ra.addHandler("RMID",J)}jyk(J){this.ra.addHandler("RPS",J)}Kyk(J){this.ra.addHandler("UPSR",J)}aZa(J){this.ra.addHandler("PU",J)}SMb(J){this.ra.removeHandler("PU",J)}kwk(J){this.ra.addHandler("IPU",J)}Hyk(J){this.ra.addHandler("UCI",J)}tyk(J){this.ra.addHandler("SUN",J)}lwk(J){this.ra.addHandler("IUNR",J)}c3(J){this.ra.addHandler("UNR",J)}TMb(J){this.ra.removeHandler("UNR",J)}MDc(J){this.ra.addHandler("PSU",J)}r4c(J){this.ra.removeHandler("PSU",J)}jwk(J){this.ra.addHandler("IPSU",
J)}zzd(J){this.ra.addHandler("PSC",J)}gde(J){this.ra.removeHandler("PSC",J)}iwk(J){this.ra.addHandler("IPSC",J)}Jyk(J){this.ra.addHandler("UPSC",J)}ryk(J){this.ra.addHandler("SP",J)}vyk(J){this.ra.addHandler("SPC",J)}static getInstance(){return M._instance||(M._instance=new M)}}M._instance=null;Object(E.a)(M,"RtcEventHub",null,[1237])},1757:function(E,K,c){c.r(K);E=c(0);var l=c(7),f=c(55),a=c(74),k=c(874);class x{}x.Adc="throttling_messageDelay";x.jVc="enabled";x.Kpb="throttling_timeToWaitForResponse";
x.rdc="throttling_maxNumberOfOutstandingMessages";x.Gji="throttling_globalMaxNumberOfOutstandingMessages";x.errorMessage="errorMessage";x.Bsj="url";x.MGa="queryString";x.eX="connectionString";Object(E.a)(x,"RtcFindSessionOutputFieldNameConstants",null,[]);var y=c(2),n=c(57),u=c(39),z=c(311),w=c(1379),F=c(82),G=c(19),H=c(135);class L{constructor(){this.Hji=this.DMi=this.EMi=this.JMi=0;this.UZd=!1;this.correlationId=this.eX=this.MGa=this.$8e=this.errorMessage=null}get g2k(){return this.$8e+"?"+this.MGa}}
Object(E.a)(L,"FindSessionResponse",null,[]);var I=c(584);class N{constructor(aa,fa,pa,ra,la,qa){this.yXa=null;const {FindSessionStrategy:La}=c(1757);this.Gfk=aa;aa=String.format("{0}={1}",I.a.clientId,G.a.Nj(ra));aa=String.format("{0}&{1}={2}",aa,I.a.userSessionId,G.a.Nj(la));aa=String.format("{0}&{1}={2}",aa,I.a.dIj,G.a.Nj(pa.toString()));aa=String.format("{0}&{1}={2}",aa,I.a.userType,G.a.Nj("1"));aa=String.format("{0}&{1}={2}",aa,I.a.pIj,G.a.Nj(fa));aa=String.format("{0}&{1}={2}",aa,I.a.gEh,G.a.Nj(La.KYk));
(fa=N.mnf(pa,qa))&&(aa=String.format("{0}&{1}",aa,fa));this.vZj=aa}W7i(){this.yXa=this.Gfk()}generate(){this.yXa&&""!==this.yXa||(this.W7i(),l.ULS.sendTraceTag(575784194,500,this.yXa&&""!==this.yXa?50:15,"Query signature delegate called for refresh returned: {0} ",this.yXa));const aa=String.format("{0}={1}",I.a.iMb,G.a.Nj(this.yXa));return String.format("{0}&{1}",aa,this.vZj)}static mnf(aa,fa){return 4===aa?String.format("{0}={1}",I.a.iQi,"1"):fa?fa.Dii():null}}Object(E.a)(N,"FindSessionQueryStringGenerator",
null,[]);var P=c(1526),M=c(1624),J=c(1506),V=c(1711);class X{}X.VCl="FSType";Object(E.a)(X,"RtcFindSessionRequestHeaders",null,[]);class W{}W.OOn="polling";Object(E.a)(W,"RtcFindSessionTypes",null,[]);var U=c(1710);class Y{}Y.C0o="RTC-TokenProofkey";Y.rUm="RTC-IsWacJsBootFsRequest";Object(E.a)(Y,"RtcRequestHeaders",null,[]);c.d(K,"FindSessionStrategy",function(){return ca});class ca{constructor(aa,fa,pa,ra,la,qa,La,Pa,Ka,Na,sa,wa,ja=null){this.i3g=(new Date(0)).getTime();this.u5g=0;this.iod=!1;this.Geh=
null;this.D3f=36E5;this.vTb=ca.cqi;this.Isc=0;this.eNb=null;this.KSa=0;this.Lhc=this.ZGh=null;this.Jgk=[x.jVc,x.errorMessage,x.Bsj,x.eX,x.MGa,x.Gji,x.rdc,x.Kpb,x.Adc];this.Igk=[x.jVc,x.errorMessage];this.eX=this.VQa=null;this.RUg=new N(sa?sa:()=>y.AFrameworkApplication.hm,la,qa,La,aa,fa);this.Ipc=wa;this.ge=ra;this.Yf=fa;this.wAe=pa;this.Fw=Pa;this.Im=Ka;this.btc=ja;this.SUg=!1;this.YLd=9E4;Na&&Na.execute(ha=>{ha.YYa(()=>{l.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",
this.Fw);this.RUg.W7i()})});2>=100*Math.random()&&(this.D3f=3E5);P.FrequentLoggingMetrics.instance&&(P.FrequentLoggingMetrics.instance.Q1h=this.D3f)}Elo(aa){this.Lhc=aa}init(){this.Im.oyk(Object(f.a)(this,this.K4n,"resetGetMachineIdDelay"));this.Im.Fta(Object(f.a)(this,this.Vha,"onConnectionStateChanged"))}Vha(aa,fa){this.KSa=fa.newState;2===fa.newState&&(this.Isc=0)}o8h(){let aa;aa=this.eNb.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.eNb.MGa,ca.tJh,G.a.Nj(aa)),correlationId:aa}}X$l(aa,
fa,pa,ra,la){this.Aco(()=>{ra(la,"GetMachineIdSuccess")&&(l.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.eX,this.Fw),aa(this.Geh),pa(this.ofm()))},qa=>{ra(la,"GetMachineIdFailure")&&(l.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.Fw),fa(qa))},ra,la)}Fol(){this.NDh();this.Avm()}Aco(aa,fa,pa,ra){l.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",
this.eX);if(this.eX)aa();else{var la=this.jQk();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(aa,fa,pa,ra)},la)}}sendFindSessionRequestToServerInternal(aa,fa,pa,ra){pa(ra,"RequestMachineId")&&(this.i3g=(new Date).getTime(),pa=u.a.Ze(),this.bPd(la=>{const qa=u.a.Ze();this.B_i(la);this.Nag();aa();la=u.a.Ze()-qa;l.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",la)},la=>{const qa=u.a.Ze();this.NDh();P.FrequentLoggingMetrics.instance&&P.FrequentLoggingMetrics.instance.WO(2,
3);fa(la);la=u.a.Ze()-qa;l.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",la)},!1),pa=u.a.Ze()-pa,l.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",pa))}Avm(){this.vTb+=ca.O1l;this.vTb=Math.min(this.vTb,ca.X$m)}jQk(){var aa=(new Date).getTime();aa=this.i3g+this.vTb-aa;0>aa&&(aa=0);return aa}B_i(aa){try{this.eNb=aa,this.VQa=aa.g2k,this.eX=aa.eX,this.ZGh=aa.MGa,this.Geh=aa.$8e}catch(fa){l.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",
fa.toString())}}NDh(){this.eX=null;this.ODh()}Nag(){this.ODh();this.iod=!0;this.u5g=window.setTimeout(Object(f.a)(this,this.USn,"refreshMachineId"),this.D3f)}ODh(){this.iod&&(window.clearTimeout(this.u5g),this.iod=!1)}USn(){this.iod=!1;this.bPd(aa=>{const fa=this.ZGh!==aa.MGa,pa=this.eX!==aa.eX,ra=this.eX;this.B_i(aa);0!==this.KSa&&(pa?(l.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",ra||"null",aa.eX),this.Im.Zbe()):(this.Im.DNn(fa,pa),
this.Nag()))},()=>{P.FrequentLoggingMetrics.instance&&P.FrequentLoggingMetrics.instance.WO(2,3);this.Nag()},!0)}K4n(){this.vTb=ca.cqi}ofm(){return new V.a(this.eNb.JMi,this.eNb.EMi,this.eNb.DMi,this.eNb.Hji)}JLo(aa){if(Object.getType(aa)!==Object)return null;for(let fa in aa);return this.a$k(aa)}a$k(aa){if(!(x.jVc in aa))return null;const fa=aa[x.jVc];var pa=fa?this.Jgk:this.Igk;for(const ra of pa)if(!(ra in aa))return null;pa=Object.assign(new L,{UZd:aa[x.jVc],errorMessage:aa[x.errorMessage],correlationId:H.a.create().toString()});
fa&&(pa.$8e=aa[x.Bsj],pa.MGa=aa[x.MGa],pa.eX=aa[x.eX],pa.Hji=aa[x.Gji],pa.DMi=aa[x.rdc],pa.EMi=aa[x.Kpb],pa.JMi=aa[x.Adc]);return pa}UVl(aa,fa){l.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.btc.XZh.continueWith(()=>{this.btc.XZh.result?(l.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),aa(this.btc.YZh)):(l.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),fa(this.btc.YZh))})}Jcj(aa,fa,
pa,ra,la=!1){return qa=>{M.a.instance.t3c(0,1);aa&&aa.stop();this.Ipc=this.Lhc=null;this.TJi(qa.data,!0,fa);var La=J.RtcUtils.deserialize(qa.data.we,"FindSession",null);if(La)if(La=this.JLo(La)){if(La.UZd&&La.MGa&&La.eX){l.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.Fw);this.y1m(qa.data);pa(La);return}fa.FindSessionFailureReason="FindSessionInvalidResponse";fa.IsRtcEnabled=La.UZd;fa.IsQueryStringEmpty=!La.MGa;fa.IsConnectionStringEmpty=!La.eX;l.ULS.sendTraceTag(4290720,
500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.Fw,La.UZd,!La.MGa,!La.eX)}else fa.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",l.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.Fw);else fa.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",l.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",
this.Fw);this.L5i(fa,la);ra(null)}}Dcj(aa,fa,pa,ra=!1){return la=>{M.a.instance.t3c(0,1);aa&&aa.stop();this.Ipc=this.Lhc=null;this.TJi(la.data,!1,fa);let qa=null;var La="unknown";let Pa="unknown";la.data&&((La=la.data.wj)&&ca.G5c in La&&(qa=La[ca.G5c].toString()),La=w.a[la.data.status],Pa=la.data.Qe.toString());fa.FindSessionFailureReason="FindSessionRequestFailed";fa.HttpErrorCode=Pa;fa.HttpErrorStatus=La;fa[ca.G5c]=qa;l.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",
La,Pa,this.Fw,qa,ra);this.L5i(fa,ra);pa(Pa)}}bPd(aa,fa,pa=!1){let ra=null;l.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.Fw);const la={};var qa=this.RUg.generate();la[z.a.L7]=H.a.create().toString();this.Lhc&&""!==this.Lhc?qa=String.format("{0}&{1}={2}",qa,U.a.A8f,this.Lhc):this.Ipc&&""!==this.Ipc&&(qa=String.format("{0}&{1}={2}",qa,U.a.A8f,this.Ipc),la[Y.C0o]="True",la[Y.rUm]="True");qa=this.wAe+"?"+qa;pa&&(la[X.VCl]=W.OOn);const La={};La.IsNetworkOfflineBeforeSendRequest=
this.Yf.gQa;La.HasAvailableConnectionsBeforeSendRequest=this.Yf.yUd;La.MaxConnectionsAllowed=this.Yf.odc;La.IsRefreshMachineId=pa;this.btc&&!this.SUg?(this.UVl(this.Jcj(null,La,aa,fa,pa),this.Dcj(null,La,fa,pa)),this.SUg=!0):(this.ge&&(ra=this.ge.$f("WebServiceCall","GetMachineIdFromTheServer")),P.FrequentLoggingMetrics.instance&&P.FrequentLoggingMetrics.instance.WO(2,0),0>this.Yf.$yb(qa,1,null,la,[ca.ZFd,ca.G5c,ca.VZc,ca.z8f,ca.ePi,ca.IRi,ca.HRi],1,this.Jcj(ra,La,aa,fa,pa),this.Dcj(ra,La,fa,pa),
null,!1,null,this.YLd,"3",null,!0)&&(5<this.Isc&&200>this.Isc&&l.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.Isc),window.setTimeout(()=>{this.Isc++;fa("-1")},1E3)))}TJi(aa,fa,pa){pa||(pa={});pa.IsNetworkOfflineAfterRequestComplete=this.Yf.gQa;pa.IsRequestSucceeded=fa;aa&&(pa.EnqueueTime=aa.cOa,pa.InvokedTime=aa.MH,pa.CompletedTime=aa.rT,aa.wj&&(ca.ZFd in aa.wj&&(pa.CorrelationId=aa.wj[ca.ZFd]),ca.VZc in
aa.wj&&(pa[ca.VZc]=aa.wj[ca.VZc])));l.ULS.sendTraceTag(38633565,500,fa?50:15,J.RtcUtils.iec(pa))}L5i(aa,fa){aa||(aa={});aa.ConnectionState=k.a[this.KSa];fa||this.Im.K5i(1,aa)}y1m(aa){try{var fa=!1,pa=!1,ra=aa.wj,la=n.a.z_(aa.request.get_url());if(ra&&ca.z8f in ra){const Na=ra[ca.z8f].toString().toLocaleLowerCase();pa="true"===Na;fa="false"===Na}ra=!1;const Ka=0<=la.toLocaleLowerCase().indexOf("collab");pa&&!Ka?ra=!0:fa&&Ka&&(ra=!0);if(ra){fa={};fa.HostName=la;fa.Status=w.a[aa.status];fa.HttpStatus=
aa.Qe.toString();var qa=aa.request.get_headers();for(let Na in qa){var La=qa[Na];(la=Na)&&0<la.length&&(pa=0,La&&(pa=La.toString().length),fa["r_"+la]=pa)}if(aa.wj){const Na=new a.a;Na.add(ca.ZFd);Na.add(ca.VZc);Na.add(ca.G5c);Na.add(ca.IRi);Na.add(ca.HRi);Na.add(ca.ePi);ca.Utk(fa,aa.wj,Na)}ca.Ftk(aa.request.get_url(),fa);var Pa=F.a.toJSON(fa);l.ULS.sendTraceTag(559437006,500,15,Pa)}}catch(Ka){l.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",Ka.toString())}}static createInstance(aa,
fa,pa,ra,la,qa,La,Pa,Ka,Na,sa,wa=null){return ca.aal(aa,fa,pa,ra,la,qa,La,Pa,Ka,Na,sa,wa)}static aal(aa,fa,pa,ra,la,qa,La,Pa,Ka,Na,sa,wa=null){aa=aa||H.a.create().toString();aa=new ca(aa,fa,pa,ra,la,qa,La,Pa,Ka,Na,null,sa,wa);aa.init();return aa}static Utk(aa,fa,pa){for(let ra of pa)ra in fa&&(aa[ra]=fa[ra])}static Ftk(aa,fa){if(aa){var pa=aa.indexOf("?");if(-1!==pa)for(aa=aa.substr(pa+1).split("&"),pa=0;pa<aa.length;++pa){var ra=aa[pa].split("=");if(2===ra.length){const la=ra[0];if(la&&0<la.length){let qa=
0;if(ra=ra[1])qa=ra.length;fa["q_"+la]=qa}}}}}}ca.O1l=3E3;ca.X$m=3E5;ca.KYk="1.0";ca.cqi=1E3;ca.ZFd="X-CorrelationId";ca.tJh="corrid";ca.G5c="RtcErrorCode";ca.VZc="X-OfficeCluster";ca.z8f="X-NewEnv";ca.ePi="X-MSEdge-Ref";ca.HRi="X-OFFICEFD";ca.IRi="X-OfficeFE";Object(E.a)(ca,"FindSessionStrategy",null,[1234])},1770:function(E,K,c){c.r(K);E=c(0);var l=c(7),f=c(55),a=c(458),k=c(58),x=c(74);class y{constructor(u){this.messageId=u;this.Ido=(new Date).getTime();this.mIf=new x.a}}Object(E.a)(y,"MessageLatencyDetails",
null,[]);c.d(K,"ClientToClientMessageTelemetry",function(){return n});class n{constructor(u,z,w){this.fLa=null;this.hJe=this.eRe=0;this.Vf=z;this.o6g=w;this.MAc=!1;this.Im=u;this.Im.c3(Object(f.a)(this,this.mPn,"receiveMessage"))}start(){if(this.o6g&&!this.MAc){const u=this.Vf.jfj;this.hJe=this.Vf.efj;u<=this.hJe?(l.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",
this.Vf.jfj,this.Vf.efj),this.o6g=!1):(this.MAc=!0,this.eRe=window.setInterval(Object(f.a)(this,this.sendMessage,"sendMessage"),u))}}sendMessage(){if(this.MAc){const u=k.a.create().toString();this.fLa=new y(u);this.Im.w2f(16,u,!1,new a.a);window.setTimeout(()=>{this.W3m(u)},this.hJe)}}W3m(u){this.fLa&&this.fLa.messageId===u&&(0<this.fLa.mIf.count?(u=this.fLa.mIf.toArray().join(","),l.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",u)):l.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),
this.fLa=null)}stop(){this.eRe&&(window.clearInterval(this.eRe),this.MAc=!1)}mPn(u,z){16===z.type?this.Im.w2f(17,z.wL,!1,new a.a):17===z.type&&this.MAc&&z.wL&&this.processMessage(z.wL)}processMessage(u){u&&this.fLa&&u.toString()===this.fLa.messageId&&(u=(new Date).getTime()-this.fLa.Ido,this.fLa.mIf.add(u))}static get instance(){return n._instance}static X7b(u,z,w){return n.instance||(n._instance=new n(u,z,w))}}n._instance=null;Object(E.a)(n,"ClientToClientMessageTelemetry",null,[])},1865:function(E,
K,c){c.d(K,"a",function(){return l});E=c(0);class l extends Sys.EventArgs{constructor(f,a){super();this.Xqa=f;this.EId=a}}Object(E.a)(l,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1866:function(E,K,c){c.r(K);c.d(K,"RealtimeChannelMetrics",function(){return x});E=c(0);var l=c(7),f=c(197),a=c(82),k=c(1506);class x{constructor(){this.W7g=this.X7g=this.Y7g=this.S7g=this.R7g=this.T7g=this.Ixc=this.VKe=0;this.lKa=this.cIe=this.fwc=this.PHe=this.CWa=this.CHe=this.Mab=this.Rvc=this.tWb=this.BHe=this.Pid=
this.QUb=null;this.tJe=this.Ywc=this.Eeh=this.pOg=0;this.p6g=!1;this.O6i=this.Z2f;this.R6i=this.b3f;this.Q6i=this.a3f;this.V6i=this.d3f;this.U6i=this.c3f;this.o3f=this.p3f;this.u3c=this.m3f;this.tMb=this.k3f;this.uMb=this.l3f;this.P6i=this.$2f;this.kRa=this.lQf;this.xlb=this.mQf}Z2f(){this.VKe++;this.BHe=new Date;this.QUb||(this.QUb=new Date)}b3f(){this.Ixc++;this.Mab=new Date;this.Pid||(this.Pid=this.Mab);this.fwc=this.Mab;this.A2k()}a3f(){this.T7g++;this.CHe=new Date}d3f(){this.R7g++;this.tWb=new Date}c3f(){this.S7g++;
this.Rvc=new Date}m3f(){this.CWa=new Date;this.Y7g++}l3f(){this.lKa||(this.lKa=new Date);this.X7g++}k3f(){this.PHe=new Date;this.W7g++}p3f(){!this.p6g&&this.VKe&&(l.ULS.sendTraceTag(39321871,500,15,a.a.toJSON(this.u_k())),this.p6g=!0)}$2f(y){let n,u;({aoi:y,coi:n,exception:u}=k.RtcUtils.zyl(y));y&&y!==f.a.Jy&&(l.ULS.sendTraceTag(40157596,500,15,a.a.toJSON({["HttpErrorCode"]:y,["HttpErrorStatus"]:n,["Exception"]:u})),f.a.PBf(y)&&this.pOg++,f.a.OFf(y)&&this.Eeh++)}lQf(){this.cIe=new Date}mQf(){this.tWb=
this.fwc=new Date}u_k(){return{["numberOfConnectionAttempts"]:this.VKe,["numberOfSuccessfulConnections"]:this.Ixc,["numberOfFailedConnections"]:this.T7g,["numberOfDisconnectedConnections"]:this.R7g,["numberOfExplicitDisconnectedConnections"]:this.S7g,["numberOfSentMessages"]:this.Y7g,["numberOfReceivedMessages"]:this.X7g,["numberOfLostMessages"]:this.W7g,["firstConnectionAttempt"]:this.QUb?this.QUb:null,["firstMessageReceived"]:this.lKa?this.lKa:null,["firstConnectionSuccess"]:this.Pid?this.Pid:null,
["lastConnectionAttempt"]:this.BHe?this.BHe:null,["lastConnectionSuccess"]:this.Mab?this.Mab:null,["lastConnectionFailure"]:this.CHe?this.CHe:null,["lastMessageSent"]:this.CWa?this.CWa:null,["lastMessageLost"]:this.PHe?this.PHe:null,["lastDisconnect"]:this.tWb?this.tWb:null,["lastExplicitDisconnect"]:this.Rvc?this.Rvc:null,["lastTimeOnline"]:this.fwc?this.fwc:null,["lastTimeOffline"]:this.cIe?this.cIe:null,["maxDisconnectedTimeMs"]:this.Ywc,["maxExplicitDisconnectedTimeMs"]:this.tJe,["clientConnectionErrors"]:this.pOg,
["serverConnectionErrors"]:this.Eeh}}A2k(){this.QUb&&1===this.Ixc&&(this.Ywc=Math.max(this.Ywc,this.Mab.getTime()-this.QUb.getTime()));this.tWb&&1<this.Ixc&&(this.Ywc=Math.max(this.Ywc,this.Mab.getTime()-this.tWb.getTime()));this.Rvc&&1<this.Ixc&&(this.tJe=Math.max(this.tJe,this.Mab.getTime()-this.Rvc.getTime()))}static createInstance(y){x._instance||(x._instance=new x,l.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",y));return x._instance}}x._instance=null;Object(E.a)(x,
"RealtimeChannelMetrics",null,[1233,139])},1867:function(E,K,c){c.d(K,"a",function(){return l});E=c(0);class l extends Sys.EventArgs{constructor(f,a){super();this.type=f;this.Xqa=a}}Object(E.a)(l,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1868:function(E,K,c){c.d(K,"a",function(){return l});E=c(0);class l extends Sys.EventArgs{constructor(f){super();this.LDd=f}}Object(E.a)(l,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},2056:function(E,K,c){c.r(K);var l=c(0),f=c(55);class a{constructor(Da,
pb){this.Iea=null;this.Ryc=Da;this.Fek=pb}init(){this.Ryc.continueWith(()=>{this.Iea=this.Ryc.result;this.Iea.z0b(Object(f.a)(this,this.Fca,"onUsersUpdated"))})}Fca(){a.M1e(this.Iea.G0a())&&(this.Iea.P5f(Object(f.a)(this,this.Fca,"onUsersUpdated")),this.Fek.IsRealCoauthSession=!0)}get TPm(){return this.Iea?a.M1e(this.Iea.G0a()):!1}static M1e(Da){let pb=null;for(const oc of Da)if(oc)if(Da=oc.isAnonymous||!oc.email?oc.clientId:oc.email.toUpperCase(),!pb)pb=Da;else if(pb!==Da)return!0;return!1}}Object(l.a)(a,
"CoauthTelemetry",null,[237]);var k=c(7),x=c(458),y=c(73),n=c(2),u;(function(Da){Da[Da.badStatePreventedTelemetry=0]="badStatePreventedTelemetry";Da[Da.notImplemented=1]="notImplemented";Da[Da.renderHandled=2]="renderHandled";Da[Da.renderHandledWithVeto=3]="renderHandledWithVeto"})(u||(u={}));Object(l.b)("CoauthorGalleryTelemetryEndResult",u);var z=c(83),w=c(82),F=c(128);class G{constructor(Da,pb,oc,Mc,$c,$d,jc,$e,Wc){this.U$g=this.JOg=this.vD=null;this.P5=Da;this.Uud=new x.a;this.Ma=oc;this.uve=
pb;this.WY=Mc;this.Uf=$c;this.oNe=$d;this.Gbb=jc;this.RVj=$e;this.HXg=this.AXg=!1;this.owd=0;this.HOg=1;this.Brb=Wc;this.KCc=this.Ma.$("PeoplesWellExtraButtonInfoIsEnabled");this.tra=Object(y.a)(String,n.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get Uuj(){return this.Uud.task}init(){F.Task.WAA.call(null,this.Gbb,this.uve,this.oNe).continueWith(()=>{this.vD=this.Gbb.result;this.JOg=this.uve.result;this.U$g=this.oNe.result;F.Task.WAA.call(null,this.uve.result.J2b,this.oNe.result.Dyj).continueWith(()=>
{this.HOg=this.JOg.J2b.result;this.owd=this.U$g.Dyj.result;this.vD.z0b(Object(f.a)(this,this.m8d,"onUsersUpdatedEventListener"));this.vD.G0a().length&&this.Fca()})})}m8d(){this.Fca()}Fca(){this.RVj(this.vD.G0a())?(this.vD.P5f(Object(f.a)(this,this.m8d,"onUsersUpdatedEventListener")),this.nnn(this.AXg)):this.Uud.ZR(1);this.AXg=!0}nnn(Da){this.HXg?this.Uuj.continueWith(()=>{k.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",u[this.Uuj.result])}):(this.HXg=
!0,this.AIn(0===this.HOg&&!Da))}AIn(Da){Da?this.WY.xk(4,Object(f.a)(this,this.fUf,"onInteractiveReady")):this.Uud.ZR(1)}fUf(){const Da=this.Uf.eF("AppInitStatus_interactivityReady");k.ULS.shipAssertTag(42259235,325,!!this.owd);const pb=this.owd-Da,oc={};oc.InteractiveTime=Da;oc.ReactRenderComplete=this.owd;oc.HadTabSwitch=this.Brb();oc.IsModernGallery=this.KCc;k.ULS.sendTraceTag(594883104,325,50,w.a.toJSON(oc));this.KCc?(k.ULS.sendTraceTag(42062997,325,15,pb.toString()),this.Uud.ZR(this.Y0o(pb)?3:
2)):k.ULS.sendTraceTag(594883103,325,15,pb.toString())}Y0o(Da){const pb=Da>this.Ma.mc("CoauthorGalleryTimeToRenderDurationMs",1E4),oc="Word"===this.tra;if(this.Brb())return k.ULS.sendTraceTag(50455714,325,50,pb.toString()),!1;oc&&z.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);pb&&(oc&&z.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),k.ULS.sendTraceTag(42062998,325,15,Da.toString()));
return pb}}Object(l.a)(G,"CoauthorGalleryTelemetry",null,[236]);class H{constructor(Da){this.vD=null;this.ofd={};this.Zqd={};this.Buc=null;this.Gbb=Da}jRd(Da){const pb=new x.a;this.init().continueWith(()=>{Da in this.ofd?pb.ZR(this.ofd[Da]):this.Zqd[Da]=pb});return pb.task}init(){if(this.Buc)return this.Buc.task;this.Buc=new x.a;this.Gbb.continueWith(()=>{this.vD=this.Gbb.result;this.vD.z0b(Object(f.a)(this,this.Fca,"onUsersUpdated"));this.zGj();this.Buc.zg(null)});return this.Buc.task}zGj(){const Da=
this.vD.G0a();Da.sort(Object(f.a)(this,this.Z1k,"comparePresenceUsers"));this.ofd={};for(let pb=0;pb<Da.length&&Da[pb]&&Da[pb].AQa;pb++)this.xtk(this.ofd,Da[pb].clientId,pb)}xtk(Da,pb,oc){Da[pb]=oc;pb in this.Zqd&&(this.Zqd[pb].ZR(oc),delete this.Zqd[pb])}Fca(){this.zGj()}Z1k(Da,pb){return Da.AQa>pb.AQa?1:Da.AQa<pb.AQa?-1:0}}Object(l.a)(H,"CoauthorPositionFinder",null,[238]);var L=c(585),I=c(355),N=c(498),P=c(74),M=c(135);class J{constructor(){this.OBa=null;this.rpc=Array(32)}xor(Da){if(!Da)throw Error.argumentNull("Guid argument cannot be null");
const pb=new J,oc=new Sys.StringBuilder;for(let Mc=0;Mc<Da.rpc.length;Mc++){const $c=this.rpc[Mc]^Da.rpc[Mc];pb.rpc[Mc]=$c;oc.append($c.toString(16));7!==Mc&&11!==Mc&&15!==Mc&&19!==Mc||oc.append("-")}pb.OBa=M.a.Ff(oc.toString());return pb}toString(){return this.OBa.toString()}equals(Da){if(!Da)throw Error.argumentNull("Guid argument cannot be null");return this.OBa.equals(Da.OBa)}static G6b(Da){if(!Da)throw Error.argumentNull("String input cannot be null");const pb=new J;pb.OBa=M.a.Ff(Da);const oc=
pb.OBa.toString();let Mc=0;for(let $d=0;$d<oc.length;$d++){var $c=Da.charAt($d);if(J.RKm($c))$c=J.xrm($c,Da.charCodeAt($d)),pb.rpc[Mc++]=$c;else if(!J.oKm($c))throw Error.argument("String contains characters not valid in Guids");}return pb}static RKm(Da){return"0"<=Da&&"9">=Da||"A"<=Da&&"F">=Da||"a"<=Da&&"f">=Da}static oKm(Da){return"{"===Da||"}"===Da||"-"===Da}static xrm(Da,pb){if("0"<=Da&&"9">=Da)return pb-48;if("A"<=Da&&"F">=Da)return pb-65+10;if("a"<=Da&&"f">=Da)return pb-97+10;throw Error.argument("Char is not valid hex digit");
}}Object(l.a)(J,"Guid",null,[]);class V{constructor(Da,pb,oc,Mc){this.Iea=null;this.YQg=this.W6g=!1;this.Y3g=0;this.Ryc=Da;this.KTe=pb;this.Ma=oc;this.cXb=Mc;this.lVj=n.AFrameworkApplication.$Qb||n.AFrameworkApplication.Woa;this.e5g=new L.a(I.a.ai())}get fcf(){return this.Ma.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}init(){this.Ryc.continueWith(()=>{this.Iea=this.Ryc.result;this.Iea.z0b(Object(f.a)(this,this.Fca,"onUsersUpdated"))})}Fca(){this.r_k(this.Iea.G0a())}r_k(Da){var pb=
0;const oc=new N.a(I.a.ai());for(const Mc of Da)if(Mc&&Mc.isAnonymous){n.AFrameworkApplication.te("70eb6120;2gfeb930");if(oc.nb(Mc.userName))oc.J(Mc.userName).add(Mc.clientId);else{let $c;oc.add(Mc.userName,($c=new P.a,$c.add(Mc.clientId),$c))}Mc.clientId!==this.cXb?(pb++,2<=pb&&!this.W6g&&this.e4m()):!this.YQg&&this.fcf&&"Guest"===Mc.userName&&(k.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),this.YQg=!0)}if(this.fcf&&this.Y3g!==pb){k.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",
pb+(this.lVj?1:0));this.Y3g=pb;for(let Mc of oc.keys)2<=oc.J(Mc).count&&(Da=this.kUl(oc.J(Mc)),this.e5g.contains(Da)||(pb={},pb.guestsWithSameName=oc.J(Mc).count,pb.identifier=Da,k.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",pb),this.e5g.add(Da)))}}e4m(){k.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.W6g=!0;this.fcf&&this.KTe&&this.KTe.continueWith(()=>{window.setTimeout(()=>{this.KTe.result.logActivity("MultipleGuestsCoauthoring",
null)},15E3)})}kUl(Da){if(!Da||1>=Da.count)return"";let pb=J.G6b(Da.J(0));for(let oc=1;oc<Da.count;oc++)pb=pb.xor(J.G6b(Da.J(oc)));return pb.toString()}}Object(l.a)(V,"GuestCoauthTelemetry",null,[]);var X=c(243);class W{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(l.a)(W,"PL",null,[]);var U=c(35);class Y{constructor(){this.ct=this.vt=this.d=0}static Mij(Da,pb,oc){const Mc=new Y;Mc.d=Da;Mc.vt=pb;Mc.ct=oc;return U.c(Mc)}}Object(l.a)(Y,"VD",null,
[]);var ca=c(119);class aa{constructor(Da,pb,oc,Mc,$c,$d,jc,$e,Wc,Ng,Re){this.Neh=!1;this._id=Da;this.ii=pb;this.Agh=oc;this.Yr=Mc;this.nKe=$c;this.yUe=$d;this.zyb=jc;this.ssb=$e;this.xYj=Wc;this.Brb=Ng;this.Ujh=Re;this.tra=Object(y.a)(String,n.AFrameworkApplication.sessionStartInfoSettings.Application)||""}xoe(Da){const pb=[this.nKe,this.yUe];this.Ujh&&pb.push(this.Agh);F.Task.WAA.apply(null,pb).continueWith(()=>{if(this.nKe.result<=this.yUe.result)Da.ZR(!1);else{this.Ujh&&(this.ii=this.Agh.result);
var oc=this.Yr-this.ii,Mc=new W;Mc.id=this._id;Mc.et=this.Yr;Mc.st=this.ii;Mc.d=this.Yr-this.ii;Mc.mp=this.nKe.result;Mc.tp=this.yUe.result;Mc.ct=this.qPl(this.xYj);Mc.vc=this.Brb();var $c=U.c(Mc),$d="Word"===this.tra;k.ULS.sendTraceTag(42078597,302,15,$c);if($d){const jc=new Map;jc.set("data",$c);z.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",jc)}oc>this.zyb.value&&!this.Neh&&!Mc.vc&&(this.Neh=!0,Da.ZR(!0),Mc=Object.assign(new ca.a,{inStaging:!0,extendedProperties:new Map}),
Mc.extendedProperties.set("data",$c),$d&&z.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,Mc),oc<this.ssb.value&&k.ULS.sendTraceTag(42078598,302,15,Y.Mij(oc,this.zyb.value,this.ssb.value)));Da.task.isCompleted||Da.ZR(!1)}})}qPl(Da){switch(Da){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(l.a)(aa,"PresenceLatencyActivityLogger",null,[]);class fa{constructor(Da,pb,oc){this.ANg=this.FOg=this.Wed=
this.nfd=this.hSb=0;this._id=Da;this.zyb=pb;this.ssb=oc;this.tra=Object(y.a)(String,n.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get $qh(){return this.hSb}set $qh(Da){this.hSb=Da;this.w6e()}get LEh(){return this.nfd}set LEh(Da){this.nfd=Da;this.w6e()}get RAh(){return this.Wed}set RAh(Da){this.Wed=Da;this.w6e()}get MEh(){return 0!==this.FOg}get SAh(){return 0!==this.ANg}w6e(){!this.MEh&&this.hSb&&this.nfd&&(this.FOg=this.xoe(this.nfd,"CoauthGalleryLightupDurationTooLong"));!this.SAh&&
this.hSb&&this.Wed&&(this.ANg=this.xoe(this.Wed,"CanvasPresenceLightupDurationTooLong"))}xoe(Da,pb){const oc=Da-this.hSb;var Mc=new W;Mc.id=this._id;Mc.et=Da;Mc.st=this.hSb;Mc.d=oc;var $c=U.c(Mc);Da="Word"===this.tra;Mc="CanvasPresenceLightupDurationTooLong"===pb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===pb?k.ULS.sendTraceTag(572289499,302,15,$c):k.ULS.sendTraceTag(571524118,302,15,$c);if(Da){var $d=new Map;$d.set("data",$c);z.Health.instance.recordKpiUsage(Mc,
0,"wordcollabrel",$d)}return oc>this.zyb.value?($d=Object.assign(new ca.a,{inStaging:!0,extendedProperties:new Map}),$d.extendedProperties.set("data",$c),$c=oc<this.ssb.value,$d.extendedProperties.set("cash",$c?"true":"false"),Da&&z.Health.instance.recordKpiFailure(Mc,pb,!1,!0,$d),k.ULS.sendTraceTag(572289500,302,15,Y.Mij(oc,this.zyb.value,this.ssb.value)),$c?2:1):3}}Object(l.a)(fa,"PresenceLightupLatencyLogger",null,[]);var pa=c(47),ra=c(167);class la{constructor(Da,pb,oc,Mc,$c,$d,jc,$e=null,Wc=
null,Ng=null){this.$ah={};this.tve={};this.B2g=new P.a;this.Eed=this.Cuc=this.vD=this.fj=null;this.QSe=this.NSe=0;this.zyb=new X.a(()=>$e.JO("PresenceBootLatencyThreshold",1E4));this.ssb=new X.a(()=>$e.JO("PresenceBootLatencyCutoffThreshold",6E4));this.Tnk=new X.a(()=>$e.JO("PresenceLightupLatencyThreshold",2E3));this.A_j=new X.a(()=>$e.JO("PresenceLightupLatencyCutoffThreshold",1E4));this.WY=Mc;this.Ma=$e;this.Mek=$c;this.IOg=Da;this.zdh=pb;this.Gbb=oc;this.Uf=$d;this.cXb=Wc;this.Brb=jc;this.NXg=
Ng;this.Hte=!1;this.init()}IKc(Da,pb,oc=null,Mc=0){oc&&(k.ULS.shipAssertTag(42274970,302,!this.cXb||this.cXb===oc,"_myClientId is already set and you are trying to update it to something different"),this.cXb=oc);const $c=new x.a;this.init().continueWith(()=>{this.frn(Da);this.Wtl($c,Da,pb,Mc)})}get WPf(){return this.cXb||"{"+n.AFrameworkApplication.userSessionId+"}"}init(){if(this.Cuc)return this.Cuc.task;this.Cuc=new x.a;this.Brb()&&k.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.IOg.continueWith(()=>
{const Da=this.IOg.result,pb=Da.J2b,oc=Da.Fdn;oc.continueWith(()=>{pb.continueWith(()=>{this.NXg&&this.NXg.addQosPillar("RealTimeCoauth");this.Wfg(pb.result,oc.result);this.Cuc.zg(null)})})});this.zdh.continueWith(()=>{this.fj=this.zdh.result;this.fj.Fta(Object(f.a)(this,this.ssn,"onRtcConnection"));this.fj.c3(Object(f.a)(this,this.mln,"onCoauthorBootReceived"))});this.Gbb.continueWith(()=>{this.vD=this.Gbb.result;this.vD.z0b(Object(f.a)(this,this.m8d,"onUsersUpdatedEventListener"));0<this.vD.G0a().length&&
this.Fca()});return this.Cuc.task}o5h(){return this.Uf.Jfa(pa.a.$7a)?this.Uf.eF(pa.a.$7a):ra.a.aeb?window.performance.timing.fetchStart:-1}A$h(){this.Eed||(this.Eed=new x.a,this.WY.xk(4,()=>{this.Eed.ZR(this.Uf.eF("AppInitStatus_interactivityReady"))}));return this.Eed.task}ssn(Da,pb){if(!this.Hte&&2===pb.newState)if(this.Vne){const oc=this.A$h();oc.continueWith(()=>{var Mc=oc.result;Mc=Date.now()-Mc;const $c={};$c.clientId=this.WPf;$c.bootTime=Mc;this.Hte=!0;this.fj.aN(15,$c)})}else Da=this.o5h(),
Da=Date.now()-Da,pb={},pb.clientId=this.WPf,pb.bootTime=Da,this.Hte=!0,this.fj.aN(15,pb)}mln(Da,pb){if(15===pb.type){Da=Date.now();pb=pb.wL;var oc=pb.bootTime;this.frf(pb.clientId).$qh=Da-oc}}m8d(){this.Fca()}Fca(){const Da=Date.now();var pb=this.vD.G0a();const oc=new P.a;for(const Mc of pb)this.B2g.contains(Mc.clientId)||(this.B2g.add(Mc.clientId),oc.add(Mc.clientId));if(0<oc.count)for(let Mc of oc)pb=this.frf(Mc),pb.MEh||(pb.LEh=Da)}frn(Da){Da=this.frf(Da);Da.SAh||(Da.RAh=Date.now())}frf(Da){return Da in
this.tve?this.tve[Da]:this.tve[Da]=new fa(Da,this.Tnk,this.A_j)}Wfg(Da,pb=0){this.NSe=Da;this.QSe=pb?pb:(new Date).getTime()}Wtl(Da,pb,oc,Mc){oc=oc?oc.getTime():(new Date).getTime();if(pb in this.$ah)Da.uja();else{const $c=this.Vne?0:this.Ccm(),$d=this.Vne?this.Dcm():null;Mc=new aa(pb,$c,$d,oc,this.jRd(this.WPf),this.jRd(pb),this.zyb,this.ssb,Mc,this.Brb,this.Vne);this.$ah[pb]=Mc;Mc.xoe(Da)}}Ccm(){return 1===this.NSe?this.QSe:this.o5h()}Dcm(){return 1===this.NSe?F.Task.M3(this.QSe):this.A$h()}jRd(Da){return this.Mek.jRd(Da)}get Vne(){return this.Ma.$("UseAppInteractiveBootTimeForPresenceTelemetry")}}
Object(l.a)(la,"PresenceBootTelemetry",null,[234]);var qa=c(130),La=c(179),Pa=c(233),Ka=c(22),Na=c(626);class sa{get name(){return"Common.App.CoauthTelemetry"}xc(Da){Da.register(a,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").singleInstance().Rd(()=>new a(Na.a.Bp(Da.Sa("Common.IPeopleInfoProvider")),n.AFrameworkApplication.Kg));Da.register(G,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").singleInstance().Rd(()=>
new G(n.AFrameworkApplication.va,Na.a.Bp(Da.Sa("Common.ICoauthoringTelemeryInfoProvider")),n.AFrameworkApplication.K,qa.a.get_instance(),Pa.a.instance,Na.a.Bp(Da.Sa("Common.IPeoplesWell")),Na.a.Bp(Da.Sa("Common.IPeopleInfoProvider")),a.M1e,()=>this.Exh()));Da.register(la,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").singleInstance().Rd(()=>new la(Na.a.Bp(Da.Sa("Common.ICoauthoringTelemeryInfoProvider")),Na.a.Bp(Da.Sa("Common.IRealtimeChannelBasic")),
Na.a.Bp(Da.Sa("Common.IPeopleInfoProvider")),qa.a.get_instance(),Da.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),Pa.a.instance,()=>this.Exh(),n.AFrameworkApplication.K,null,z.Health.instance));Da.register(H,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").singleInstance().Rd(()=>new H(Na.a.Bp(Da.Sa("Common.IPeopleInfoProvider"))));Da.register(V,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").singleInstance().Rd(()=>new V(Na.a.Bp(Da.Sa("Common.IPeopleInfoProvider")),
Na.a.Bp(Da.Sa("Common.ISystemInitiatedFeedback")),n.AFrameworkApplication.K,"{"+n.AFrameworkApplication.userSessionId+"}"))}init(){n.AFrameworkApplication.K.Po(()=>{Ka.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();Ka.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();n.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&Ka.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();n.AFrameworkApplication.K.$("CashTelemetryIsEnabled")&&
(Ka.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),Ka.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}Exh(){return ra.a.aeb&&Pa.a.instance.Jfa(pa.a.qbd)?0<Pa.a.instance.eF(pa.a.qbd)[pa.a.xJj]:!1}static main(){La.a.instance.Fc(new sa)}}Object(l.a)(sa,"CoauthTelemetryPackage",null,[1,2]);class wa extends Sys.EventArgs{constructor(){super()}}Object(l.a)(wa,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var ja;(function(Da){Da[Da.notYetStarted=
0]="notYetStarted";Da[Da.polling=1]="polling";Da[Da.subscribed=2]="subscribed";Da[Da.blocked=3]="blocked";Da[Da.permanentlyStopped=4]="permanentlyStopped"})(ja||(ja={}));Object(l.b)("RtcHostNotificationSubscriptionState",ja);var ha=c(91),va=c(1413),xa=c(80);class ma{constructor(Da,pb,oc,Mc,$c,$d,jc,$e,Wc){this.Oh=!1;this.raa=this.eYb=this.Xea=this.KXa=null;this.ABc=ma.ore;this.ra=new xa.a;this.Ecb=new va.a(0);this.Ecb.r_e(Object(f.a)(this,this.ytn,"onStateMachineChanged"));this.shk=Da;this.mtd=pb;
this.rhk=oc;this.gQe=Mc;this.Hb=$c;this.$e=$d;jc.execute(Ng=>{this.Oh||(this.eYb=Ng,this.eYb.c3(Object(f.a)(this,this.x0,"onUpdateNotificationReceived")),this.start())});$e.execute(Ng=>{this.Oh||(this.raa=Ng,Ng.YYa(Object(f.a)(this,this.aia,"onTokenRefreshed")))});this.lwd=Wc}get skc(){return this.Ecb.currentState}get YAi(){return!this.$e||this.$e.Wwa}get qBi(){return 2===this.skc&&this.lwd()<this.ABc}start(){0!==this.skc?k.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",
ja[this.skc]):(this.Ecb.event(1),this.e$f(null))}e$f(){this.KXa=null;if(this.YAi){k.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",ja[this.skc]);let Da=null;this.gQe&&this.gQe.length&&(Da={},Da.etts=this.gQe);this.eYb.aN(14,Da,!0);this.Bgj(this.shk)}else this.Ecb.event(3)}Bgj(Da){this.KXa=ha.a.Q7(1E3*Da,Object(f.a)(this,this.e$f,"sendSubscribeEvent"),this.mtd,192,"RtcHostNotificationSubscribe");this.Hb.Wb(this.KXa)}eao(Da){Da=1E3*(Da+this.rhk);
const pb=this.lwd().getTime()+Da;this.ABc=new Date(pb);Da-=this.mtd;this.Xea?this.Hb.J0(this.Xea,Da):(this.Xea=ha.a.Q7(Da,Object(f.a)(this,this.CLo,"transitionToPollingEvent"),this.mtd/2,194,"RtcHostNotificationTransitionToPolling"),this.Hb.Wb(this.Xea))}CLo(){this.Xea=null;2===this.skc&&(this.Ecb.event(1),k.ULS.shipAssertTag(573100185,502,!!this.KXa,"Missing task to ensure that we re-subscribe."))}aia(){this.nlm()}nlm(){3===this.skc&&this.YAi&&(this.Ecb.event(this.qBi?2:1),this.e$f(null))}x0(Da,
pb){if(13===pb.type&&(Da=pb.wL,k.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",{["SerializableHostNotificationSubscription"]:Da,["DurationBeforeExpirationToResubscribeInSec"]:this.mtd}),pb=Da.cts,!this.lOo(pb))){if(Da.sb){var oc=2;this.eao(Da.cts)}else oc=1,this.ABc=ma.ore,this.Xea&&(this.Hb.We(this.Xea),this.Xea=null);this.Ecb.event(oc);this.KXa?this.Hb.J0(this.KXa,1E3*pb):this.Bgj(pb)}}lOo(Da){if(!isNaN(Da)&&isFinite(Da)&&0<Da)return!1;this.ivj(!1);return!0}ivj(Da){this.KXa&&
(this.Hb.We(this.KXa),this.KXa=null);this.Xea&&(this.Hb.We(this.Xea),this.Xea=null);this.eYb&&(this.eYb.TMb(Object(f.a)(this,this.x0,"onUpdateNotificationReceived")),this.eYb=null);this.raa&&(this.raa.RMb(Object(f.a)(this,this.aia,"onTokenRefreshed")),this.raa=null);Da||this.Ecb.event(4)}ytn(Da,pb){Da=pb.newState;const oc=pb.u_f,Mc={};Mc.NewState=ja[Da];Mc.PreviousState=ja[oc];Mc.PreviousStateHits=pb.v_f;Mc.PreviousStateTransitionTime=pb.w_f.toISOString();Mc.IsSubscribed=this.qBi;this.ABc!==ma.ore&&
(Mc.SubscriptionExpiringTime=this.ABc.toISOString());k.ULS.sendTraceTag(572346515,502,4===Da?15:50,"HostNotificationChanged: {0}",Mc);this.ra.raiseEvent("HN",new wa(oc,Da))}dispose(){this.Oh||(this.Oh=!0,this.ivj(!0),this.Xea&&(this.Hb.We(this.Xea),this.Xea=null))}}ma.ore=new Date(0);Object(l.a)(ma,"RtcHostNotificationSubscriptionManager",null,[235,10]);var Ja=c(397);class oa{constructor(){this.Ah=this.Oh=!1}get name(){return"RtcHostNotificationSubscription"}xc(Da){Da.register(ma,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").singleInstance().Rd(()=>
{const pb=n.AFrameworkApplication.K;return new ma(pb.mc("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),pb.mc("RtcHostNotificationRetryIntervalBufferInSeconds",120),pb.mc("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.oam(pb),n.AFrameworkApplication.pc,Ja.SessionStatusManager.instance,Da.Sa("Common.IRealtimeChannelBasic"),Da.Sa("Common.ISessionExpirationManager"),()=>new Date)})}init(){n.AFrameworkApplication.K.Po(()=>{!this.Oh&&n.AFrameworkApplication.K.$("RtcHostNotificationEnabled")&&
(this.Ah=!0,Ka.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.Oh||(this.Oh=!0,this.Ah&&Ka.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}oam(Da){return Da.Sw("RtcEventTypesToSubscribe")?Da.KC("RtcEventTypesToSubscribe"):null}static main(){La.a.instance.Fc(new oa)}}Object(l.a)(oa,"RtcHostNotificationSubscriptionPackage",null,[1,2]);var za=c(465),Fa=c(639);
class kb{constructor(Da,pb,oc,Mc,$c,$d,jc,$e,Wc,Ng,Re){this.clientId=Da;this.SkypeChatThreadId=oc;this.chatThreadDiscoveryUri=Mc;this.inChat=$c;this.localColbaltSessionId=pb;this.capabilities=$d;this.email=jc;this.isReadOnly=$e;this.userName=Wc;this.isAnonymous=Ng;this.presenceStatus=Re}}Object(l.a)(kb,"SerializablePresenceUserData",null,[]);class fb extends za.a{constructor(Da,pb,oc,Mc,$c=null,$d=null,jc=null,$e=null,Wc=null,Ng=!1,Re=!1,Ah=!1,hi=null){super(Da,pb,oc,Mc,$d,jc,$e,Wc,Ng,Re,Ah);this.cP=
$c;this.presenceStatus=hi}getData(){return new kb(this.clientId,this.cP,this.VFc,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}kRd(Da){return(Da=Da.value)?Da.user:null}clone(){return new fb(this.clientId,this.userName,this.color,this.capabilities.clone(),this.cP,this.VFc,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus)}static jBb(Da){return Da.clientId?
new fb(Da.clientId,Da.userName,null,new Fa.a(void 0===Da.capabilities?0:Da.capabilities),Da.localColbaltSessionId,Da.SkypeChatThreadId,Da.email,null,Da.chatThreadDiscoveryUri,Da.isAnonymous,Da.inChat,Da.isReadOnly,Da.presenceStatus):null}static UKh(Da,pb,oc,Mc=null,$c=null,$d=null,jc=null,$e=null,Wc=!1,Ng=!1,Re=!1,Ah=null){return Da?new fb(Da,pb,null,new Fa.a(void 0===oc?0:oc),Mc,$c,$d,jc,$e,Re,Wc,Ng,Ah):null}}Object(l.a)(fb,"PresenceUser",za.a,[1518,1519,27]);class lb extends fb{constructor(){super();
this.agc=this.JJf=null}e3l(){const Da=n.AFrameworkApplication.userName,pb=n.AFrameworkApplication.K.jb("UserPrincipalName"),oc=this.JJf?this.JJf.cP:null,Mc=n.AFrameworkApplication.$Qb||n.AFrameworkApplication.Woa,$c=this.agc?this.agc.getStatus():null;return new fb(this.clientId,Da,this.color,this.capabilities,oc,this.VFc,pb,this.client,this.chatThreadDiscoveryUri,Mc,this.inChat,this.isReadOnly,$c)}}Object(l.a)(lb,"MyPresenceUser",fb,[1573,27]);var sb=c(215);class ab{constructor(Da,pb,oc,Mc,$c){this.Vf=
Da;this._clientId=pb;this.C0j=$c;this.t4j=oc||(()=>null);this.u4j=Mc||(()=>null)}get id(){return this.Vf.id}get jyd(){return this.Vf.jyd}get nyd(){return this.Vf.nyd}get myd(){return this.Vf.myd}get lyd(){return this.Vf.lyd}get kyd(){return this.Vf.kyd}get pyd(){return this.Vf.pyd}get PXe(){return this.Vf.PXe}get Tjc(){return this.Vf.Tjc}get Zie(){return this.Vf.Zie}get L4d(){return this.Vf.L4d}get clientId(){return this._clientId}get KPc(){return this.t4j}get Vhb(){return this.u4j}get mol(){return this.C0j}static createInstance(Da,
pb,oc,Mc,$c=!1){return new ab(Da,pb,oc,Mc,$c)}}Object(l.a)(ab,"PeoplesWellSettings",null,[]);var Ga=c(9),Ua=c(65),wb=c(166),cc=c(106),zb=c(206),nb=c(160),eb=c(399),Ib=c(336);class Xa extends zb.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(l.a)(Xa,"PeopleButtonProps",zb.a,[]);var Ra=c(414),gb=c(415),Bb=c(19),$b=c(77);class Qb{constructor(Da){this.rbd=new $b.a;this.ecf=null;this.clientId=
Da}Fno(Da){this.$Xn();this.igo(Da);for(const pb of Da)pb.clientId!==this.clientId&&this.cph(pb)}get Gng(){const Da=[];for(let pb of this.rbd.values){const oc=this.yhj(pb);Array.add(Da,oc)}return Da}get Llb(){return this.rbd.count}FZe(Da,pb){Da=Da.toUpperCase();let oc;({value:oc}=this.rbd.Dc(Da)).returnValue||(oc=[],this.rbd.Z(Da,oc));Array.add(oc,pb)}$Xn(){this.rbd=new $b.a}igo(Da){for(const pb of Da)if(pb.clientId===this.clientId){this.ecf=pb;break}}}Object(l.a)(Qb,"UserTracker",null,[1345]);class Ac extends Qb{constructor(Da,
pb){super(Da);this.v4j=pb}cph(Da){Da.isAnonymous||!Da.email?this.FZe(Da.clientId,Da):this.ecf&&I.a.ai().equals(this.ecf.email,Da.email)||this.FZe(Da.email,Da)}yhj(Da){let pb=new Date(0),oc=0<Da.length?Da[0]:null;for(const Mc of Da)(Da=this.v4j(Mc.clientId))&&pb.getTime()<Da.scc.getTime()&&(pb=Da.scc,oc=Mc);return oc}}Object(l.a)(Ac,"UniqueUserTracker",Qb,[]);class Db extends Qb{constructor(Da){super(Da)}cph(Da){this.FZe(Da.clientId,Da)}yhj(Da){return Da[0]}}Object(l.a)(Db,"UserInstanceTracker",Qb,
[]);const dc=(Da,pb,oc)=>oc?new Ac(Da,pb):new Db(Da);var Pb=c(67),Ub=c(600),rb=c(13);class Yb{constructor(Da,pb=null,oc=null){this.vD=null;this.HUe=new x.a;this.Vf=Da;this.M9d=pb;oc&&oc.continueWith(()=>{this.vD=oc.result;this.vD.z0b(Object(f.a)(this,this.Fca,"onUsersUpdated"));this.uce()});new za.a(this.settings.clientId,"Anonymous user","#cccccc",new Fa.a(7));this.vYd=this.DGe=!0;this.rCe=this.nNe=!1;this.lza=dc(this.settings.clientId,this.settings.Vhb,Da.mol)}get settings(){return this.Vf}get AGm(){return n.AFrameworkApplication.K?
n.AFrameworkApplication.K.$("ColorPresenceHashIsEnabled"):!1}get yui(){return n.AFrameworkApplication.K?n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}oRl(){let Da;let pb,oc,Mc,$c;var $d=this.pRl();this.lza.Llb?1===this.lza.Llb?(pb=!0,oc=this.settings.Tjc.cluster,Mc=this.settings.Tjc.$Gd,$c=this.lza.Gng[0].color):(pb=!0,oc=this.settings.L4d.cluster,Mc=this.settings.L4d.$Gd,$c=""):(pb=!1,$c=Mc=oc="");Da=$d[0];$d=$d.slice(1);return{Lwn:Da,Mwn:$d,Hwn:pb,ojp:oc,Jwn:Mc,Iwn:$c}}pRl(){if(2<=
this.lza.Llb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.lza.Llb)];if(1===this.lza.Llb){const Da=this.lza.Gng[0],pb=this.settings.Vhb(Da.clientId);return pb&&2===pb.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,Da.userName]:[Da.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,Da.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}shm(Da){return this.thm(Da)}rAh(Da,
pb,oc){return pb?this.cSk(pb)?(Da=this.settings.Vhb(Da))&&2===Da.status?!1:!0:(oc&&k.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(oc&&k.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}Jcm(Da){return Da.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}thm(Da){if(!Da.capabilities.BEa(1))return this.Jcm(Da);const pb=Da.isReadOnly,oc=this.settings.Vhb(Da.clientId);
Da=this.settings.KPc(Da.clientId);if(!oc)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(oc.status){case 1:return Da?pb?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.D6k(Da)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}vZl(Da){if(this.M9d.qWc)return this.M9d.vBb(Da.email,
"O365",n.AFrameworkApplication.hm,0)}ehm(Da){Da=this.settings.Vhb(Da.clientId);return!Da||Da&&1===Da.status?!0:!1}ghm(Da){var pb=String.format("buttonPeoplesWellUser-{0}",Da.clientId),oc=Da.clientId,Mc=this.shm(Da);const $c=Da.userName,$d=Da.color;var jc=Object,$e=jc.assign,Wc=new Xa,Ng=this.settings.pyd.toString(),Re=this.settings.Zie.cluster,Ah=this.settings.Zie.$Gd,hi=this.p7h(),Sj=Da.isAnonymous,al;if(al=[$c],al.length){var fj=new Sys.StringBuilder("STRARRY@");for(const yk of al)fj.append(yk?
yk.length:0),fj.append(","),fj.append(yk),fj.append(",");al=fj.toString().slice(0,-1)}else al=null;pb=$e.call(jc,Wc,{Id:pb,Command:Ng,LabelText:"{0}",Image32by32:Re,Image32by32Class:Ah,MenuItemId:oc,CommandValueId:oc,Alt:$c,DisplayMode:hi,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:Mc,ImageBackColor:$d,IsAnonymous:Sj,LabelTextUserGeneratedPlaceholderReplacements:al,Upn:Da.email});n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
this.M9d&&(oc=this.vZl(Da),Mc=this.ehm(Da),pb.ImageUrl=oc,pb.ActiveStatus=Mc,pb.JoinTimeInMS=Da.AQa,Da=this.rAh(Da.clientId,this.settings.KPc(Da.clientId),!1),pb.CanJump=Da,""===oc&&k.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return pb}GXl(){return Object.assign(new zb.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}p7h(){return this.AGm?"Initials":
"Menu32"}hhm(Da){const pb=[];for(const oc of Da)Da=this.ghm(oc),Array.add(pb,Da);return pb}VXd(){return 0<this.lza.Llb}RLn(Da){if(!this.DGe)return!0;this.vYd||(Da[Ub.a.Visible]=!0);let pb,oc,Mc,$c,$d;({Lwn:pb,Mwn:oc,Hwn:Mc,Jwn:$c,Iwn:$d}=this.oRl());Da[Ub.a.LabelText]=pb;oc&&oc.length&&(Da[Ub.a.LabelTextUserGeneratedPlaceholderReplacements]=oc);Da[Ub.a.ImageIsVisible]=Mc;Da[Ub.a.Image16by16Class]=$c;Da[Ub.a.ImageBackColor]=$d;this.DGe=!1;return!0}fDn(Da){if(0>=this.lza.Llb)return!1;var pb=this.Nyo(this.lza.Gng),
oc=this.hhm(pb);pb=Object.assign(new eb.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});oc=Object.assign(new Ib.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.p7h(),ControlList:oc});n.AFrameworkApplication.K.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.M9d&&(oc.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,oc.TitleId="menuCoauthorsTitle",oc.Theme="Light");Array.add(pb.MenuSectionList,oc);n.AFrameworkApplication.K.$("DocChatIsEnabled")&&n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
n.AFrameworkApplication.ta&&n.AFrameworkApplication.ta.Nb.$q&&(oc=[],Array.add(oc,this.GXl()),oc=Object.assign(new Ib.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:oc}),Array.add(pb.MenuSectionList,oc));n.AFrameworkApplication.ta&&n.AFrameworkApplication.ta.Nb.$q?Da.MenuItems=pb:Da.PopulationXML=nb.o(pb);return!0}Dng(Da){k.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");Da=Da.MenuItemId;if(!Da)return!1;const pb=this.settings.KPc(Da);if(!this.rAh(Da,pb,
!0))return!1;this.zVm(pb);return!0}LSn(){const Da=this.BLl();this.lza.Fno(Da);this.vYd&&1<=this.lza.Llb&&(k.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.vYd=!1);this.DGe=!0}Fca(){this.rCe||(window.setTimeout(()=>{this.uce();this.rCe=!1},3E3),this.rCe=!0)}BLl(){let Da;Da=this.ALl()||[];for(const pb of Da)this.I9n(pb);return Da}I9n(Da){Da.clientId||(Da.clientId=M.a.create().toString());Da.userName||(Da.userName="Anonymous user");Da.capabilities||(Da.capabilities=
new Fa.a);Da.color||(Da.color="#cccccc");Da.AQa||(Da.AQa=0)}Nyo(Da){const pb=[];Array.addRange(pb,Da);pb.sort(Yb.uwn);return pb}dWn(){n.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&!this.nNe&&(n.AFrameworkApplication.va.w_(rb.a.XEh)&&Ra.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||n.AFrameworkApplication.va.fb(rb.a.XEh,Pb.a.frame,Object(f.a)(this,this.nln,"onCoauthorGalleryFirstRender"),96));this.eWn();this.nNe=
!0;this.uce()}nln(Da,pb,oc,Mc,$c){this.HUe.ZR($c.RenderTime);return 32}get Dyj(){return this.HUe.task}uce(){if(!this.nNe&&(this.HUe.ZR((new Date).getTime()),k.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.yui))return;this.LSn();this.yui&&this.vYd?n.AFrameworkApplication.K&&n.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||gb.a.aec("ribbon","coauthorGallery"):
(n.AFrameworkApplication.K&&n.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(gb.a.jpa("ribbon","coauthorGallery"),gb.a.pRa("ribbon","coauthorGallery")),this.MSn())}dispose(){this.vD&&(this.vD.P5f(Object(f.a)(this,this.Fca,"onUsersUpdated")),this.vD=null)}static uwn(Da,pb){return Da.capabilities.BEa(1)&&pb.capabilities.BEa(1)||!Da.capabilities.BEa(1)&&!pb.capabilities.BEa(1)?Bb.a.localeCompare(Da.userName,pb.userName):Da.capabilities.BEa(1)?
-1:1}}Object(l.a)(Yb,"APeoplesWell",null,[1269,10]);var Ya=c(12);const Ob=()=>!0;class vc extends Yb{constructor(Da,pb,oc=null,Mc=null){super(Da,oc,Mc);this.pHm=($c,$d,jc,$e,Wc)=>this.H1a(jc,Wc,()=>this.VXd(),Ob);this.SLn=($c,$d,jc,$e,Wc)=>this.H1a(jc,Wc,Ng=>this.RLn(Ng),Ob);this.gDn=($c,$d,jc,$e,Wc)=>this.H1a(jc,Wc,Ob,Ng=>this.fDn(Ng));this.h0k=($c,$d,jc,$e,Wc)=>this.H1a(jc,Wc,Ob,Ob);this.g0k=($c,$d,jc,$e,Wc)=>this.H1a(jc,Wc,Ob,Ob);this.$Zo=($c,$d,jc,$e,Wc)=>this.H1a(jc,Wc,Ob,Ng=>this.Dng(Ng));this.ZAn=
($c,$d,jc,$e,Wc)=>this.H1a(jc,Wc,Ob,()=>{this.uce();return!0});this.ga=pb}H1a(Da,pb,oc,Mc){let $c=!1;switch(Da){case 1:$c=oc(pb);break;case 2:$c=Mc(pb)}return $c?32:8}eWn(){this.ga.qa(this.settings.jyd,Ya.a.application,this.pHm);this.ga.fb(this.settings.nyd,Ya.a.application,this.SLn,96);this.ga.fb(this.settings.lyd,Ya.a.application,this.h0k,96);this.ga.fb(this.settings.kyd,Ya.a.application,this.g0k,96);this.ga.fb(this.settings.myd,Ya.a.application,this.gDn,96);this.ga.qa(this.settings.pyd,Ya.a.application,
this.$Zo);this.ga.fb(this.settings.PXe,Ya.a.application,this.ZAn,96)}}Object(l.a)(vc,"ABox4PeoplesWell",Yb,[]);var Sa=c(3),Ab=c(46),Fb=c(8),Va=c(28),Wa=c(165);class jb{static isSupported(Da){for(let pb=0;pb<jb.mwj.length;pb++)if(Da===jb.mwj[pb])return!0;return!1}}jb.mwj=[1];Object(l.a)(jb,"RTTDataVersion",null,[]);var mc=c(1625);const yb=Da=>{if("number"!==typeof Da.RK||"number"!==typeof Da.DK)return!1;let pb,oc=!1,Mc=!1,$c=!1;switch(Da.RK){case 0:Mc=pb=!0;break;case 1:$c=oc=Mc=pb=!0;break;case 2:if(null!=
Da.PE&&"number"!==typeof Da.PE)return!1;pb=!0;break;case 4:pb=!0;break;case 3:Mc=pb=!0;break;case 5:oc=pb=!0;break;default:return!1}return pb&&("number"!==typeof Da.PS||"number"!==typeof Da.TS)||Mc&&("object"!==typeof Da.OS||!Da.OS||!mc.validateVersionedCpData(Da.OS))||oc&&("number"!==typeof Da.PE||"number"!==typeof Da.TE)||$c&&("object"!==typeof Da.OE||!Da.OE||!mc.validateVersionedCpData(Da.OE))?!1:!0},Oa=Da=>{let pb="";if("number"!==typeof Da.I)return{returnValue:!1,bha:"Invalid PacketId Type"};
if("number"!==typeof Da.O)return{returnValue:!1,bha:"Invalid Operation Type"};if("string"!==typeof Da.A)return{returnValue:!1,bha:"Invalid ClientId Type"};if("object"!==typeof Da.AN)return{returnValue:!1,bha:"Invalid Anchor Object Type"};if(!Da.AN)return{returnValue:!1,bha:"Null AnchorObject"};if(!yb(Da.AN)){let oc;try{oc=U.c(Da.AN)}catch(Mc){oc=String.format("Failed to JSON-serialize payload : {0}",Mc)}8E3<oc.length&&(oc=String.format("Payload exceeds maximum length: {0} > {1}, not logging",oc.length,
8E3));pb="Invalid AnchorObject: "+oc+", Client: "+Da.C;return{returnValue:!1,bha:pb}}return!Da.O&&Da.AN.RK?(pb="Invalid RangeKind:"+Da.AN.RK+" for Caret",{returnValue:!1,bha:pb}):2===Da.O&&("number"!==typeof Da.TF||"undefined"!==typeof Da.TX&&"string"!==typeof Da.TX||1!==Da.AN.RK&&Da.AN.RK)?{returnValue:!1,bha:"Invalid TypingData"}:3!==Da.O||"object"===typeof Da.AP&&Da.AP&&"number"===typeof Da.AP.TFA&&"number"===typeof Da.AP.PN&&"number"===typeof Da.AP.TN&&2===Da.AN.RK?6!==Da.O||"object"===typeof Da.MP&&
Da.MP&&"number"===typeof Da.MP.PM&&"number"===typeof Da.MP.TM&&5===Da.AN.RK?4!==Da.O||"object"===typeof Da.SP&&Da.SP&&"number"===typeof Da.SP.PA&&"number"===typeof Da.SP.TA&&"number"===typeof Da.SP.PB&&"number"===typeof Da.SP.TBS&&3===Da.AN.RK&&(Da.AN.PS===Da.SP.PA||Da.AN.PS===Da.SP.PB)?7!==Da.O||"object"===typeof Da.SPS&&Da.SPS&&"string"===typeof Da.SPS.SF&&"boolean"===typeof Da.SPS.SL?null!=Da.ISS&&"number"!==typeof Da.ISS?{returnValue:!1,bha:"invalid StrictlySequentialId"}:{returnValue:!0,bha:pb}:
{returnValue:!1,bha:"Invalid SymbolData"}:{returnValue:!1,bha:"Invalid SplitParaData"}:{returnValue:!1,bha:"Invalid RemoveParaData"}:{returnValue:!1,bha:"Invalid AddParaData"}};var Gb=c(1593);class Wb{constructor(Da,pb=null,oc=null){this.d1=this.zXf=this.Iig=null;null!=Da&&(this.Iig=Da);null!=pb&&(this.zXf=pb);null!=oc&&(this.d1=oc)}}Object(l.a)(Wb,"AddParaData",null,[]);class kc{constructor(Da=null,pb=null){this.blc=this.yXf=null;null!=Da&&(this.yXf=Da);null!=pb&&(this.blc=pb)}}Object(l.a)(kc,"MergeRemoveParaData",
null,[]);class Mb{constructor(Da,pb,oc,Mc,$c,$d,jc=null,$e=null,Wc=null,Ng=null,Re=null,Ah=null,hi=0,Sj=null){this.D9c=this.text=this.QPb=this.hPb=this.UYc=this.h0b=this.Fja=null;this.packetId=Da;this.client=oc;this.Gt=Mc;this.clientId=pb.toLowerCase();this.iT=$c;this.version=hi;$d&&(this.Fja=$d);null!=jc&&(this.QPb=jc);void 0!==$e&&null!==$e&&(this.text=$e);Wc&&(this.h0b=Wc);Ng&&(this.UYc=Ng);Re&&(this.hPb=Re);Ah&&(this.D9c=Ah);this.strictlySequentialId=Sj}}Object(l.a)(Mb,"RTTData",null,[]);class Qc{constructor(Da=
null,pb=null,oc=null,Mc=null){this.Hig=this.xXf=this.Eig=this.wXf=null;null!=Da&&(this.wXf=Da);null!=pb&&(this.Eig=pb);null!=oc&&(this.xXf=oc);null!=Mc&&(this.Hig=Mc)}}Object(l.a)(Qc,"SplitParaData",null,[]);class Ic{constructor(Da=null,pb=null){this.ihg=this.hhg=null;Da&&(this.hhg=Da);null!=pb&&(this.ihg=pb)}}Object(l.a)(Ic,"SymbolData",null,[]);class Ed{constructor(Da,pb=null,oc=null){null!=Da&&(this.TFA=Da);null!=pb&&(this.PN=pb);null!=oc&&(this.TN=oc)}}Object(l.a)(Ed,"SerializableAddParaDataV1",
null,[]);class me{constructor(Da=null,pb=null){null!=Da&&(this.PM=Da);null!=pb&&(this.TM=pb)}}Object(l.a)(me,"SerializableMergeRemoveParaDataV1",null,[]);class Be{}Object(l.a)(Be,"SerializableRTTDataV1",null,[]);class ad{constructor(Da=null,pb=null,oc=null,Mc=null){null!=Da&&(this.PA=Da);null!=pb&&(this.TA=pb);null!=oc&&(this.PB=oc);null!=Mc&&(this.TBS=Mc)}}Object(l.a)(ad,"SerializableSplitParaDataV1",null,[]);class Nc{constructor(Da=null,pb=null){Da&&(this.SF=Da);null!=pb&&(this.SL=pb)}}Object(l.a)(Nc,
"SerializableSymbolDataV1",null,[]);const Sc=Da=>{var pb;if(!({bha:pb}=Oa(Da)).returnValue)return k.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",pb),null;let oc=pb=null,Mc=null,$c=null,$d=null,jc=null,$e=null,Wc=null;Da.WD&&(pb=Da.WD);null!=Da.TF&&(oc=Da.TF);void 0!==Da.TX&&null!==Da.TX&&(Mc=Da.TX);Da.AP&&($c=new Wb(Da.AP.TFA,Da.AP.PN,Da.AP.TN));Da.MP&&($d=new kc(Da.MP.PM,Da.MP.TM));Da.SP&&(jc=new Qc(Da.SP.PA,Da.SP.TA,Da.SP.PB,Da.SP.TBS));Da.SPS&&($e=new Ic(Da.SPS.SF,
Da.SPS.SL));null!=Da.ISS&&(Wc=Da.ISS);return new Mb(Da.I,Da.A,Da.C,Da.O,Gb.a(Da.AN),pb,oc,Mc,$c,$d,jc,$e,1,Wc)},Gc=Da=>{let pb=Da;if("number"===typeof pb.V){if(1===pb.V)return Sc(Da);k.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");return null}let oc=0,Mc=null;for(let $c=0;$c<Da.length;$c++)pb=Da[$c],jb.isSupported(pb.V)&&pb.V>oc&&(oc=pb.V,Mc=Da[$c]);return 1===oc?Sc(Mc):null},ie=Da=>{if(Da){const pb=new Be;pb.I=Da.packetId;pb.V=1;pb.A=Da.clientId;pb.C=Da.client;pb.O=Da.Gt;pb.AN=Gb.c(Da.iT);
Da.Fja&&(pb.WD=Da.Fja);null!=Da.QPb&&(pb.TF=Da.QPb);void 0!==Da.text&&null!==Da.text&&0<Da.text.length&&(pb.TX=Da.text);Da.h0b&&(pb.AP=new Ed(Da.h0b.Iig,Da.h0b.zXf,Da.h0b.d1));Da.UYc&&(pb.MP=new me(Da.UYc.yXf,Da.UYc.blc));Da.hPb&&(pb.SP=new ad(Da.hPb.wXf,Da.hPb.Eig,Da.hPb.xXf,Da.hPb.Hig));Da.D9c&&(pb.SPS=new Nc(Da.D9c.hhg,Da.D9c.ihg));pb.ISS=Da.strictlySequentialId;Da=pb}else Da=null;return Da};var cf=c(58);class Ge{constructor(Da,pb,oc,Mc,$c,$d,jc,$e,Wc){this.LocalCobaltSessionId=Da;this.SkypeChatThreadId=
pb;this.ChatThreadDiscoveryUri=oc;this.InChat=Mc;this.Capabilities=$c;this.Email=$d;this.UserName=jc;this.IsAnonymous=$e;this.PresenceStatus=Wc}}Object(l.a)(Ge,"SerializableWacData",null,[]);class gf{constructor(){this.Nud=this.Mud=0}U3l(){this.Nud===Number.MAX_VALUE&&(this.Nud=0);this.Nud++;return this.Nud}T3l(){this.Mud===Number.MAX_VALUE&&(this.Mud=0);this.Mud++;return this.Mud}static get instance(){return gf.$jk}}gf.$jk=new gf;Object(l.a)(gf,"StrictlySequentialIdGenerator",null,[231]);var Ie=
c(1523);class zf{constructor(Da,pb,oc,Mc,$c,$d,jc,$e=0){this.Ksa=null;this.dryDeletion=0;this.CI=Da;this.vLa=$d;this.ud=$c;this.Myb=jc;this.Lc=pb;this.shapeId=$e;this.BGa=oc;this.y9=jc.create(this,Mc,$c,$d)}clone(){return new zf(this.CI,this.Lc,this.BGa,this.y9.Hqb,this.ud,this.vLa,this.Myb,this.shapeId)}get paragraphId(){return this.Ksa?this.Ksa:this.CI.Ihb(this.Lc)}eVf(){this.Ksa||(this.Ksa=this.paragraphId,this.y9.eVf())}isValid(){return 0<=this.y9.cp}getData(){const Da=this.y9.Hqb;return Da?new Ie.a(0,
this.Lc,this.BGa,Da,null,null,null,0,this.shapeId):null}static jBb(Da,pb,oc,Mc,$c){return pb?new zf(pb,parseInt(Da.KRa),Da.n7a,Da.xR,oc,Mc,$c,Da.shapeId):null}}Object(l.a)(zf,"WordPresenceIp",null,[249,111,250]);class uc{constructor(Da,pb,oc){this.lTa=this.gca=this.Twc=!1;this.ybb=Da;this.mWa=oc;this.user=pb}get ip(){return this.mWa}get ndc(){return this.Twc}set ndc(Da){(this.Twc=Da)&&this.ip.eVf()}Jtf(){const Da=gf.instance.T3l();return new Mb(this.ybb,this.user.clientId,1,0,this.ip?this.ip.getData():
null,new Ge(this.user.cP,this.user.VFc,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus),void 0,void 0,void 0,void 0,void 0,void 0,void 0,Da)}s9h(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():cf.a.nil.toString())}isValid(){const Da=!!this.user&&this.user.isValid(),pb=!this.ip||this.ip.isValid();return Da&&pb}clone(){const Da=new uc;Da.ybb=this.ybb;Da.Twc=this.Twc;
Da.user=this.user?this.user.clone():null;Da.mWa=this.ip?this.ip.clone():null;Da.gca=this.gca;Da.lTa=this.lTa;return Da}static iaf(Da,pb,oc,Mc,$c){if(!Da||!pb)return null;if(Da.Gt)return k.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",Da.Gt),null;let $d;$d=void 0!==Da.Fja&&null!==Da.Fja?fb.UKh(Da.clientId,Da.Fja.UserName,Da.Fja.Capabilities,Da.Fja.LocalCobaltSessionId,Da.Fja.SkypeChatThreadId,Da.Fja.Email,Da.client,Da.Fja.ChatThreadDiscoveryUri,Da.Fja.InChat,
!1,Da.Fja.IsAnonymous,Da.Fja.PresenceStatus):fb.UKh(Da.clientId,null,0,void 0,void 0,void 0,Da.client);return new uc(Da.packetId,$d,zf.jBb(Da.iT,pb,oc,Mc,$c))}}Object(l.a)(uc,"WordPresenceInfo",null,[253,111]);class Rc extends vc{constructor(Da,pb,oc,Mc,$c,$d,jc,$e,Wc,Ng,Re,Ah,hi,Sj){super(Da,$d,Sj,pb);this.$Xj=oc;this.Dhk=Mc;this.agk=$c;this.ib=jc;Rc.St=$e;this.CI=Wc;this.ud=Ng;this.vLa=Re;this.qXe=Ah;this.xJa=hi}Dng(Da){this.xJa.CDi(Da.CommandValueId);return super.Dng(Da)}zVm(Da){let pb;({i_f:pb}=
this.dFf(Da)).returnValue&&(this.Dhk(pb.ip.paragraphId,pb.ip.y9.cp),n.AFrameworkApplication.K.$("WordEditorMoveIpToUserLocationIsEnabled")&&(Da=Rc.qbm(pb),void 0!==Da&&null!==Da?(k.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.ib.setSelection(Da),Ua.FocusManager.$J()&&Ua.FocusManager.instance().mg(wb.AFrame.Pn)):k.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),Da=new ha.a(2,1,0,
()=>{this.ga.Qb(Sa.a.Aie,2,pb)}),cc.a.instance.Wb(Da))}Gdi(Da){return Da?(Da=uc.iaf(Gc(Da),this.CI,this.ud,this.vLa,this.qXe.instance))&&Da.isValid()&&Da.ip?Da:null:null}cSk(Da){return this.qPm(Da)?this.vSk(Da)?!0:(k.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(k.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}qPm(Da){return!!this.Gdi(Da)}dFf(Da){Da=this.Gdi(Da);return{returnValue:!!Da,
i_f:Da}}vSk(Da){let pb;return({i_f:pb}=this.dFf(Da)).returnValue?this.$Xj(pb.ip.paragraphId,pb.ip.y9.cp):!1}ALl(){if(!this.vD)return[];const Da=[];for(const pb of this.vD.G0a())pb.userName?Da.push(pb):k.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return Da}D6k(Da){let pb;return({i_f:pb}=this.dFf(Da)).returnValue&&pb.user&&pb.user.presenceStatus&&"0"!==pb.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,pb.user.presenceStatus):CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}MSn(){this.agk(this.settings.id)}static createInstance(Da,
pb,oc,Mc,$c,$d,jc){const $e=Ga.App.xa.hb,Wc=n.AFrameworkApplication.va,Ng=Ab.a.instance,Re=Ka.a.instance.resolve("Box4.ICoauthCashTelemetry");return new Rc(Da,pb,Ah=>$e.rc.Vi?$e.rc.B5e(Ah,!0):!1,(Ah,hi)=>{$e.rc.Vi&&$e.rc.kHa(Ah,hi,!0,!0,!1)},()=>{Ga.App.Bv.NI.Oad()},Wc,Ng,$e,oc,Mc,$c,$d,Re,jc)}static qbm(Da){const pb=Rc.St.Uc.od.Db(Da.ip.paragraphId);if(void 0===pb||null===pb)return k.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!Fb.ParagraphReader.Vb(pb))return k.ULS.sendTraceTag(20764577,
325,15,"The obtained node is not a paragraph node"),null;Da=Va.a.Rc(pb,Da.ip.y9.cp);return new Wa.Selection([Da],!0)}}Rc.St=null;Object(l.a)(Rc,"WordEditorPeoplesWell",vc,[]);class Dd{constructor(){this.Mx=()=>{n.AFrameworkApplication.k0i?Dd.cqa.OD().continueWith(this.U_c):k.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")};this.U_c=()=>{Dd.fj=Dd.cqa.OD().result;if(Dd.fj){var Da=()=>{const pb=Ga.App.xa.hb;return pb?pb.Uc?pb.Uc.od:(k.ULS.sendTraceTag(23196876,
325,15,"ActivePage is null"),null):(k.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};Ga.App.Pna().continueWith(()=>{const pb=Ga.App.Pna().result.kj,oc=sb.CuiHelper.u7l(n.AFrameworkApplication.Vs,n.AFrameworkApplication.Vs,n.AFrameworkApplication.Vs,n.AFrameworkApplication.Vs),Mc=ab.createInstance(oc,pb,Object(f.a)(Dd.fj.xee,Dd.fj.xee.KPc,"getUserPresence"),Object(f.a)(Dd.fj.xee,Dd.fj.xee.Vhb,"getUserStatusInfo"),n.AFrameworkApplication.K.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));
Ka.a.instance.ha("RealtimePresenceUI.WordEditorPeoplesWell",()=>Rc.createInstance(Mc,Na.a.Bp(Dd.W.Sa("Common.IPeopleInfoProvider")),Dd.W.Na("WordEditor.ParagraphWordIdMapping"),Dd.W.Na("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Da,Dd.W.Sa("WordEditor.Presence.IWordPresenceCpFactory"),Dd.W.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").singleInstance();Dd._instance=Ka.a.instance.resolve("Common.IPeoplesWell");Dd._instance.dWn();k.ULS.sendTraceTag(23196877,
325,50,"PeoplesWellControl is fully initialized")})}else k.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}}get name(){return"WordEditor.PeoplesWellControl"}xc(Da){Dd.W=Da}init(){n.AFrameworkApplication.K.Po(this.Mx)}dispose(){Dd._instance&&(Dd._instance.dispose(),Dd._instance=null)}static get cqa(){return null!=Dd.MFg?Dd.MFg:Dd.MFg=Ka.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}}Dd._instance=null;Dd.W=null;Dd.fj=null;Object(l.a)(Dd,
"WordEditorPeoplesWellControlPackage",null,[1,2]);var Id=c(97),Kd=c(161);class af{constructor(Da,pb,oc,Mc,$c,$d,jc,$e,Wc=!1){this.O8a=null;this.BAe=!0;this.ONe=this.Cl=this.nte=null;this.ra=new xa.a;this.oLa=Da;this.GZ=pb;this.Cah=oc;this.dzc=Mc;this.bMg=$d;af.Hb=$c;this.cfk=jc;this.P6=$e;this.igk=Wc;F.Task.WAA(pb,oc).continueWith(Object(f.a)(this,this.Owm,"initOnTaskReady"))}Nyk(Da){this.ra.addHandler("u",Da)}V5i(){this.ra.raiseEvent("u",null,this)}Owm(){this.GZ.result&&this.Cah.result&&(this.Cl=
this.GZ.result,this.ONe=this.Cah.result,this.Cl.aZa(Object(f.a)(this,this.I4,"onPresenceUpdated")),this.nte=new ha.a(2,2,this.bMg,Object(f.a)(this,this.dSo,"updateAwayClientsTask"),88),af.Hb.Wb(this.nte))}I4(Da,pb){(this.BAe||this.qPn(pb.Xqa))&&af.Hb.J0(this.nte,0)}qPn(Da){for(let oc in Da){var pb=this.dzc.kRd({key:oc,value:Da[oc]});if(pb&&pb.clientId&&(pb=pb.clientId.toLowerCase(),(pb=this.O8a[pb]||this.O8a[pb.toUpperCase()])&&2===pb.status))return!0}return!1}dSo(Da){var pb=this.Cl.$Mc();if(pb){var oc=
new Date,Mc=!1;if(this.BAe){this.O8a=pb;this.BAe=!1;var $c=this.O8a;for(var $d in $c){pb=$d;var jc=$c[$d];jc.scc<oc&&(oc=jc.scc);2===jc.status&&(Mc=!0,this.ONe.j4c(pb))}Mc&&this.V5i();af.Hb.J0(Da,this.tbi(oc))}else{jc=new P.a;$d=!1;var $e=this.O8a;for($c in $e){$e=$c;if(!($e in this.O8a)||this.oLa.clientId===$e)continue;var Wc=this.O8a[$e];const Ng=pb[$e];if(Wc&&Ng){Wc=Wc.status;const Re=Ng.status;2===Wc&&1===Re?(jc.add($e),k.ULS.sendTraceTag(38052609,392,50,$e+" returned from away")):1===Wc&&2===
Re&&($d=Mc=!0,this.ONe.j4c($e),k.ULS.sendTraceTag(38052610,392,50,$e+" went away"));1===Re&&Ng.scc<oc&&(oc=Ng.scc)}}this.O8a=pb;af.Hb.J0(Da,this.tbi(oc));(0<jc.count||Mc)&&this.V5i();0<jc.count&&!this.igk?(Da=this.zPl(jc),this.pJo(Da)):Da=new P.a;($d||0<Da.count)&&this.cfk(rb.a.ZDd,2)}}}pJo(Da){if(Da.count)for(let pb of Da)Da=this.P6.Ama(String.format(CommonUIStrings.l_EditorsToastArriving,pb),!1),Da.image=5,Da.aoa="CoAuth_AuthorStatus_16x16x32",this.P6.fA(Da)}zPl(Da){const pb=this.Cl.BDb(),oc=new P.a;
for(let Mc in pb){const $c={key:Mc,value:pb[Mc]};if(Da.contains($c.key)){const $d=this.dzc.kRd($c);$d&&(oc.add($d.userName),Da.remove($c.key))}}oc.count||k.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return oc}tbi(Da){const pb=new Date;return Math.max(Da.getTime()+this.bMg-pb.getTime(),0)}}af.Hb=null;Object(l.a)(af,"AwayManager",null,[]);var Dg=c(763);class oi{constructor(Da=0){this.updates=Da}get rxf(){return 0!==this.updates}BEa(Da){return!!(this.updates&Da)}o6a(Da){this.updates|=
Da}toString(){if(this.BEa(0))return"none";const Da=new P.a;this.BEa(1)&&Da.add("user(s) joined");this.BEa(2)&&Da.add("user(s) disconnected");this.BEa(4)&&Da.add("user(s) updated");return Da.toArray().join(", ")}}Object(l.a)(oi,"UserUpdateEvent",null,[]);var zg=c(34);class ec{constructor(Da,pb,oc,Mc,$c=null){this.ra=new xa.a;this.kK=this.fj=null;this.$6g=this.w7g=this.$l=!1;this.rq=new $b.a;Da.continueWith(()=>{this.fj=Da.result;this.fj.aZa(Object(f.a)(this,this.HWi,"onRtcPresenceUpdate"));this.fj.Fta(Object(f.a)(this,
this.GWi,"onRtcConnectionChange"));this.cng(null,null)});pb.continueWith(()=>{this.kK=pb.result;this.kK.rdb(Object(f.a)(this,this.x_c,"onEditorsTableUpdated"))});$c&&$c.continueWith(()=>{$c.result.Nyk(Object(f.a)(this,this.cng,"updateUserStatus"));this.cng(null,null)});this.HLa=oc;this.dzc=Mc}get users(){return this.rq}z0b(Da){this.ra.addHandler("UU",Da)}P5f(Da){this.ra.removeHandler("UU",Da)}cng(){if(this.fj){var Da=!1,pb=this.fj.$Mc();for(let Mc in pb){var oc=pb[Mc];const $c=Mc;this.users.nb($c)&&
(oc=this.vAj(oc),Da=this.users.J($c).EAb!==oc||Da,this.users.J($c).EAb=oc)}Da&&(Da=new oi(4),this.zfe(Da))}}vAj(Da){return 1===Da.status?0:1}G0a(){this.users.count||(this.w7g||(zg.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.w7g=!0),this.FDn());const Da=[];for(let pb of this.users)Array.add(Da,pb.value);return Da}FDn(){if(this.fj){var Da=this.fj.BDb();this.KMf(Da)}if(this.kK){Da=this.kK.UMc();for(const pb of Da)pb.Id&&(Da=this.bNh(pb.Id),this.bng(new oi,Da))}}YKf(Da){({value:Da}=
this.users.Dc(Da));return Da}dispose(){this.$l||(this.fj&&(this.fj.SMb(Object(f.a)(this,this.HWi,"onRtcPresenceUpdate")),this.fj.$gc(Object(f.a)(this,this.GWi,"onRtcConnectionChange"))),this.kK&&this.kK.iaj(Object(f.a)(this,this.x_c,"onEditorsTableUpdated")),this.$l=!0)}GWi(Da,pb){2===pb.newState&&(Da=this.KMf(this.fj.BDb()),Da.rxf&&this.zfe(Da))}x_c(Da,pb){Da=new oi;var oc=this.kK.UMc();k.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",
oc.length,pb.Zin,pb.PPi);const Mc=new $b.a;for(var $c of oc){oc=$c.Id;const $d=this.bNh(oc);this.bng(Da,$d);Mc.Z(oc,$d)}if((pb=pb.leaving)&&0<pb.length)for($c=0;$c<pb.length;$c++)k.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.users.count,pb.J($c).Id),({value:oc}=this.users.Dc(pb.J($c).Id)).returnValue?oc?(this.users.remove(pb.J($c).Id),Da.o6a(2),Mc.Z(pb.J($c).Id,oc)):k.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",pb.J($c).Id):
k.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",pb.J($c).Id);pb=this.fj.BDb();for(let $d in pb)$c=this.dzc.kRd({key:$d,value:pb[$d]}),Mc.Z($c.clientId,$c);for(let $d of this.users)Mc.nb($d.value.clientId)||(k.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",$d.key),this.users.remove($d.key),Da.o6a(2));Da.rxf&&this.zfe(Da)}HWi(Da,pb){Da=this.KMf(pb.Xqa);for(const oc of pb.EId)this.users.nb(oc)&&(Da.o6a(2),this.users.J(oc).EAb=
2);Da.rxf&&this.zfe(Da)}KMf(Da){const pb=new oi;if(!Da)return pb;for(let Mc in Da){var oc=this.dzc.kRd({key:Mc,value:Da[Mc]});oc&&(oc=oc.clone(),this.bng(pb,oc))}return pb}bng(Da,pb){if(pb){var oc=pb.clientId;var Mc=this.Z5n(pb);({value:pb}=this.users.Dc(oc)).returnValue?pb.equals(Mc)||(Da.o6a(4),this.users.Z(oc,Mc)):(k.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,oc),Da.o6a(1),this.users.Z(oc,Mc))}}bNh(Da){return this.users.nb(Da)?this.users.J(Da):
za.a.m$k(Da)}Z5n(Da){if(!Da||!Da.clientId||!this.kK)return Da;const pb=Da.clone();pb.EAb=this.yPl(Da);if(Da=this.kK.e7b(pb.clientId))pb.isReadOnly=pb.isReadOnly||Da.IsReadOnly?!0:!1,pb.userName=this.Y5n(pb,Da),pb.capabilities=this.dcn(pb.capabilities,Da.Capabilities),pb.email=pb.email||Da.SIPAddress||Da.EmailAddress,Da.JoinCoauthTime&&(pb.AQa=Da.JoinCoauthTime);pb.color=this.HLa.R8b(new Dg.a(pb.email,void 0,pb.userName,void 0,pb.isAnonymous,pb.clientId),3);return pb}yPl(Da){if(!this.fj)return 2;if(Da&&
Da.clientId){const pb=this.fj.$Mc();if(Da.clientId in pb)return this.vAj(pb[Da.clientId])}return 2}R1k(Da,pb){pb.Name&&Da.userName&&pb.Name!==Da.userName&&!this.$6g&&(this.$6g=!0,zg.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}dcn(Da,pb){Da=Da||new Fa.a;pb&&(pb.SupportsRealtimeChannel&&Da.o6a(1),pb.SupportsRename&&Da.o6a(2),pb.SupportsChat&&Da.o6a(4));return Da}Y5n(Da,pb){this.R1k(Da,pb);return pb.Name||Da.userName||(Da.isAnonymous||pb.IsAnonymous?CommonUIStrings.l_GuestUserName:
null)}zfe(Da){k.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",Da.toString());this.ra.raiseEvent("UU")}}Object(l.a)(ec,"PeopleInfoProvider",null,[1292,10]);var Bc;(function(Da){Da[Da.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";Da[Da.peopleImageClassName=1]="peopleImageClassName";Da[Da.peopleImageClusterPath=4]="peopleImageClusterPath";Da[Da.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";Da[Da.imageDimension=6]="imageDimension";
Da[Da.rtl=8]="rtl";Da[Da.pointerInputManager=9]="pointerInputManager";Da[Da.clickInputManager=10]="clickInputManager";Da[Da.vertical=11]="vertical";Da[Da.zIndex=12]="zIndex";Da[Da.contextMenuInputManager=13]="contextMenuInputManager";Da[Da.imageDomElement=14]="imageDomElement";Da[Da.useIdleTooltip=15]="useIdleTooltip";Da[Da.viewportBoundsCallback=16]="viewportBoundsCallback";Da[Da.flipHorizontalDirection=17]="flipHorizontalDirection";Da[Da.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash";
Da[Da.ignoreEventOnExpandedTooltip=19]="ignoreEventOnExpandedTooltip";Da[Da.ipWidthAdjustForFlyout=20]="ipWidthAdjustForFlyout"})(Bc||(Bc={}));Object(l.b)("PresenceTooltipSettingKeys",Bc);class Vc{constructor(){this.ou={}}get(Da,pb=null){Da=Bc[Da];return"number"===typeof pb?(pb=this.ou[Da])?Number.parseInvariant(pb.toString()):0:this.ou[Da]}add(Da,pb){this.ou[Bc[Da]]=pb}KMa(Da,pb){Bc[Da]in this.ou||(this.ou[Bc[Da]]=pb)}remove(Da){delete this.ou[Bc[Da]]}}Object(l.a)(Vc,"PresenceTooltipSettings",null,
[]);class xd extends xa.a{constructor(Da){super();this._element=null;this.element=Da}get element(){return this._element}set element(Da){this._element=Da}get visible(){return"visible"===this.element.style.visibility}set visible(Da){this.element.style.visibility=Da?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(Da){this.element.dir=Da?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(Da){this.element.style.zIndex=String(Da)}dispose(){this.element&&
this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(Da){return this.element.ownerDocument.createElement(Da)}hja(){return!0}static pMh(Da){return"prControl"+(Da?"Rtl":"")}}Object(l.a)(xd,"BasePresenceControl",xa.a,[10,1299]);class ee extends Sys.EventArgs{constructor(Da,pb){super();this.type=Da;this.Lo=pb}}ee.nU="InteractivityChanged";Object(l.a)(ee,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class Me{static ISl(Da){return Me.JSl(Da)}static JSl(Da){const pb=
document.createElementNS(Me.Jpg,"svg");pb.setAttribute("viewBox",String.format(Me.pgl,Me.nJj,Me.mJj));pb.appendChild(Me.zdm(Da));return pb}static zdm(Da){const pb=Me.nJj/Da,oc=2*pb,Mc=Me.mJj/2;Da=(Da-12-8)*pb/2;const $c=document.createElementNS(Me.Jpg,"g");Sys.UI.DomElement.addCssClass($c,Me.ogl);for(let $d=1;3>=$d;$d++)$c.appendChild(Me.kPl($d,oc,Da+(6*$d-2)*pb,Mc));return $c}static kPl(Da,pb,oc,Mc){const $c=document.createElementNS(Me.Jpg,"circle");Sys.UI.DomElement.addCssClass($c,String.format("{0}-{1}",
Me.BWk,Da));$c.setAttribute("cx",String.format("{0}",oc));$c.setAttribute("cy",String.format("{0}",Mc));$c.setAttribute("r",String.format("{0}",pb));return $c}}Me.Jpg="http://www.w3.org/2000/svg";Me.ogl="prDancingDots";Me.BWk="prAnimateCircle";Me.pgl="0 0 {0} {1}";Me.mJj=40;Me.nJj=120;Object(l.a)(Me,"ModernPresenceTooltipDancingDots",null,[]);var De=c(95),oe=c(88),nf=c(11),Qe=c(26),of=c(141),mf=c(54);class jg extends xd{constructor(Da,pb){super(Da);this.ekh=this.C$a=this.ave=this._img=this.oE=this.Zr=
this.ig=null;this.$La=pb.get(8,!1);this.j$a=pb.get(6,0);this.pnk=pb.get(15,!1);this.Vf=pb;this.fUg=0;this.element=Da;this.element.className=jg.Rkf;this._span=document.createElement("span");this.element.appendChild(this._span);this.b1j=Me.ISl(pb.get(6,0));this.QB(pb);this._state=5}fzb(Da){this.addHandler(ee.nU,Da)}NMb(Da){this.removeHandler(ee.nU,Da)}get user(){return this.ekh}get state(){return this._state}dispose(){this.element&&(this.ig.uc(nf.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),
this.ig.uc(nf.a.oB,this.element,Object(f.a)(this,this.hja,"stopPropagationAndPreventDefaultBehavior")),this.Zr.uc(nf.a.pointerDown,this.element,Object(f.a)(this,this.$C,"onPointerDown")),this.Zr.uc(nf.a.pointerOut,this.element,Object(f.a)(this,this.GJ,"onPointerOut")),this.Zr.uc(nf.a.pointerOver,this.element,Object(f.a)(this,this.hP,"onPointerOver")),this.oE.uc(this.element,Object(f.a)(this,this.hja,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}QB(Da){this.ig=Da.get(10);this.ig.mb(nf.a.click,
this.element,Object(f.a)(this,this.onClick,"onClick"));this.ig.mb(nf.a.oB,this.element,Object(f.a)(this,this.hja,"stopPropagationAndPreventDefaultBehavior"));this.Zr=Da.get(9);this.Zr.mb(nf.a.pointerOver,this.element,Object(f.a)(this,this.hP,"onPointerOver"));this.Zr.mb(nf.a.pointerOut,this.element,Object(f.a)(this,this.GJ,"onPointerOut"));this.Zr.mb(nf.a.pointerDown,this.element,Object(f.a)(this,this.$C,"onPointerDown"));this.oE=Da.get(13);this.oE.mb(this.element,Object(f.a)(this,this.hja,"stopPropagationAndPreventDefaultBehavior"))}hide(Da=
null,pb=0,oc=0){this.pnk&&Da?this.xvo(Da,pb,oc):(3===this.state&&this.S9i(),this.visible=!1,this._state=5)}xvo(Da,pb,oc=0){this.show(Da,pb,15,4,void 0,oc)}Tqj(Da,pb,oc=!1,Mc=!1,$c=!1,$d=0){this.show(Da,pb,20,oc?2:Mc?1:0,$c,$d)}Vuo(Da,pb,oc,Mc=!1,$c=0){this.show(Da,pb,oc+20,3,Mc,$c)}show(Da,pb,oc,Mc=3,$c=!1,$d=0){!Da||Mc===this.state&&this.sqm(pb,oc)||(this.Fqk(Mc,$c,$d),this.hfa(Da,Mc,$d),this._state=Mc,4===$d||0===$d&&!this.$La?this.element.style.left=pb+"px":this.element.style.right=pb+"px",this.element.style.top=
oc+"px",this.visible=!0)}hfa(Da,pb,oc){this.ekh=Da;mf.a.vC(this._span);of.a.jYk(this._span);this._span.id="fly_"+Da.clientId;this._span.style.backgroundColor=Da.color;4!==pb?(this._span.style.height=this.j$a+"px",this._span.style.lineHeight=this.j$a+"px",of.a.Xic(this._span,"border-radius",this.j$a+"px")):4===oc||0===oc&&!this.$La?this._span.style.left="0px":this._span.style.right="0px";2!==pb&&(4===pb?mf.a.Gy(this._span,""):1===pb?this._span.appendChild(this.b1j):(this._span.setAttribute("dir","auto"),
oc=Bb.a.UZl(Da.userName),(!Da.isAnonymous||n.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&oc||0!==pb?(Da=Da.userName,0===pb&&(Da=oc,of.a.Xic(this._span,"text-align","center")),mf.a.Gy(this._span,Da)):(this._img||(this._img=this.i8k()),this._span.appendChild(this._img),of.a.Xic(this._span,"text-align","start"))))}onClick(Da){if(0===this.state)return this.raiseEvent(ee.nU,new ee(1,Da)),!0;3===this.state&&k.ULS.sendTraceTag(50436114,
302,50,"User clicked on presence pill.");return!1}GJ(Da){3===this.state&&this.raiseEvent(ee.nU,new ee(3,Da));return!1}hP(Da){3!==Da.kg&&this.raiseEvent(ee.nU,new ee(2,Da));return!1}$C(Da){if(3!==Da.kg)return!0;this.raiseEvent(ee.nU,new ee(4,Da));return!1}i8k(){const Da=document.createElement("img");Da.src=De.a.Yaa("doughperson_white_glyph.svg");Da.setAttribute("Unselectable","on");Qe.a.gr(Da,Qe.a.qh,Qe.a.$y);return oe.createClusteredImageFromClusterWithImageClass(this.j$a,this.j$a,null,null,jg.mFl,
"",!1,"",this.element.ownerDocument,Da)}Fqk(Da,pb=!1,oc=0){if(!this.xTc(this.state)||!this.xTc(Da))switch(Sys.UI.DomElement.removeCssClass(this.element,this.ave),this.state){case 4:3===Da?this.PYa(jg.Skf,jg.h0h):this.xTc(Da)&&this.PYa(jg.Qkf,jg.h0h);break;case 3:4===Da?this.PYa(jg.Vkf,jg.g0h):this.xTc(Da)&&(pb&&this.S9i(),this.PYa(jg.Qkf,jg.g0h,pb?jg.lFl:""));break;case 0:case 1:case 2:4===Da?this.PYa(jg.Vkf,jg.Tkf):3===Da&&(pb&&this.Mrk(),this.PYa(jg.Skf,jg.Tkf,pb?jg.i0h:"",3===oc?jg.pFl:jg.nFl));
break;default:4===Da?this.PYa(jg.Vkf):3===Da?this.PYa(jg.Skf):this.xTc(Da)&&this.PYa(jg.Qkf)}}PYa(...Da){this.ave=Da.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.ave)}Mrk(){this.fUg=window.setTimeout(()=>{this.element&&(this.C$a=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.C$a),this.element.style.zIndex="2",this.C$a.style.zIndex="1")},300)}S9i(){window.clearTimeout(this.fUg);this.C$a&&(Sys.UI.DomElement.removeCssClass(this.C$a,jg.Tkf+" "+jg.i0h),Sys.UI.DomElement.addCssClass(this.C$a,
jg.kFl),F.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.C$a.parentNode&&this.element.parentNode.removeChild(this.C$a)}),of.a.Ygc(this.element,"z-index"))}xTc(Da){return 0===Da||1===Da||2===Da}sqm(Da,pb){const oc=of.a.yY(this.element.style.top);return of.a.yY(this.element.style.left)===Da&&oc===pb}Z6f(Da){3===Da&&of.a.Raa(this.element,"left")?(Da=of.a.yY(this.element.style.left),of.a.Ygc(this.element,"left"),this.element.style.right=-1*Da+"px"):4===Da&&of.a.Raa(this.element,
"right")&&(Da=of.a.yY(this.element.style.right),of.a.Ygc(this.element,"right"),this.element.style.left=-1*Da+"px")}}jg.Rkf="prModernFlyout UIFont";jg.Vkf="flyoutIdle";jg.Skf="flyoutExpanded";jg.Qkf="flyoutCollapsed";jg.h0h="flyoutFromIdle";jg.g0h="flyoutFromExpanded";jg.Tkf="flyoutFromCollapsed";jg.i0h="flyoutStacked";jg.lFl="flyoutFromStacked";jg.kFl="flyoutFadeOut";jg.mFl="cui-img-cont-float cui-img-20by20";jg.nFl="flyoutLtrDir";jg.pFl="flyoutRtlDir";Object(l.a)(jg,"ModernPresenceTooltipFlyoutControl",
xd,[]);class pf{constructor(Da,pb,oc=2,Mc=4){this.offsetTop=Da;this.offsetLeft=pb;this.kJj=oc;this.Bni=Mc}}Object(l.a)(pf,"FlyoutsPositioningInfo",null,[]);var xb=c(39);class Tb{constructor(Da=!1,pb=!1){this.em=Da;this.GAe=pb}f0l(Da,pb,oc,Mc,$c){const $d=$c.y,jc=$c.height;var $e=this.GNl(Mc);const Wc=$e+pb,Ng=Da*oc+2*(Da-1);oc=null;1===Da||this.TRk($e,Ng,$d,jc)?Da=new pf(0,0,2):(Da=this.ykf(Wc,Ng,$d,jc),Da.offsetTop-=$e);this.GAe?oc=new pf(0,0,void 0,this.em?4:3):(Mc=this.FNl(Mc,$c),$e=Math.max(0,
$c.x),$c=$c.width,pb=Mc+pb,this.URk(Mc,$e,$c)?oc=new pf(0,0,void 0,this.em?3:4):this.VRk(pb,$e)&&(oc=new pf(0,0,void 0,this.em?4:3)),oc||(oc=this.VDl(Mc,pb,$e,$c)));return new pf(Da.offsetTop,oc.offsetLeft,Da.kJj,oc.Bni)}GNl(Da){return xb.a.ZDa(Da)}FNl(Da,pb){return this.em?pb.width-xb.a.r4h(Da):xb.a.Enf(Da)}TRk(Da,pb,oc,Mc){return Da+pb<=oc+Mc}ykf(Da,pb,oc,Mc){let $c=1,$d=Math.max(oc,Da-pb);pb>Da-oc&&($c=2,$d=pb<Mc?Mc-pb:oc);return new pf($d,0,$c)}URk(Da,pb,oc){return Da+150<=pb+oc}VRk(Da,pb){return 150<=
Da-pb}VDl(Da,pb,oc,Mc){Mc-pb>=Da-oc?Da=4:(pb=Da,Da=3);return new pf(0,pb,void 0,Da)}}Object(l.a)(Tb,"ModernPresenceTooltipPositioner",null,[]);class Xc{constructor(Da,pb,oc,Mc,$c,$d,jc){this.H$=Da;this._parent=pb;this.KOg=oc;this.RYj=Mc;this.N5j=$c;this.KZb=$d;this.$La=jc;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(Da,pb){if(3!==Da)if(5!==Da&&this.H$&&this.H$.length){if(4===Da){var oc=this.N5j;var Mc=(this.KZb-oc)/2;
this.element.style.height=this.KZb+"px";this.element.style.width=this.KZb+"px";Da=of.a.yY(this.H$[0].element.style.top);pb=of.a.yY(this.$La?this.H$[0].element.style.right:this.H$[0].element.style.left)}else oc=this.KOg,Mc=(this.KZb-oc)/2,this.element.style.height=this.KZb+"px",this.element.style.width=this.CPl()+2*Mc+"px",Da=of.a.yY(this.H$[this.H$.length-1].element.style.top),pb=this.WQk(this.H$[this.H$.length-1].element,oc,pb);of.a.Xic(this.element,"border-radius",this.KZb+"px");this.element.style.top=
Da-Mc-oc+"px";this.$La?this.element.style.right=pb-Mc+"px":this.element.style.left=pb-Mc+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}WQk(Da,pb,oc){return this.$La&&!oc?of.a.yY(Da.style.right):this.$La||oc?this.$La&&oc?-of.a.yY(Da.style.left)-pb:-of.a.yY(Da.style.right)-pb:of.a.yY(Da.style.left)}CPl(){return this.H$&&this.H$.length?this.KOg+Math.min(this.H$.length-1,2)*
this.RYj:0}}Object(l.a)(Xc,"ModernPresenceTooltipTarget",null,[]);var Fd=c(127),Se=c(189);class pd extends xd{constructor(Da,pb,oc){super(Da);this.hYb=this.LKa=this.eZg=this.utb=!1;this.rq=[];this.wkd={};this.Vf=oc;this.em=oc.get(8,!1);this.VXg=oc.get(15,!1);this.V_j=oc.get(12,0);this.beb=oc.get(6,0);this.kla=pb;this.zkh=oc.get(16);this.GAe=oc.get(17,!1);this.R5j=oc.get(19,!1);this.Tek=oc.get(20,!1);this.und=0;this.Nek=new Tb(this.em,this.GAe);this.poc=this.Y6h();this.owb=!1;this.YRb=[];this.puc=
[];this.element.id=pd.Tgb();this.element.className=xd.pMh(this.em);this.F_a&&(this.zIndex=this.F_a);this.rtl=this.em;this.W$f(pb);this.t6=this.createElement("div");this.t6.className="prFlyoutContainer";this.element.appendChild(this.t6);this.H$=[];this.cab=new Xc(this.J3,this.element,this.beb,4,6,32,this.em);this.Zr=oc.get(9);this.Zr.mb(nf.a.pointerDown,this.cab.element,Object(f.a)(this,this.xec,"onHitTarget"));this.Zr.mb(nf.a.pointerOver,this.cab.element,Object(f.a)(this,this.xec,"onHitTarget"));
this.Zr.mb(nf.a.pointerOut,this.cab.element,Object(f.a)(this,this.xec,"onHitTarget"))}get M$d(){return Se.a.clone(this.rq)}get J3(){return this.H$}get F_a(){return this.V_j}get v0a(){return this.J3?this.J3.length:0}get bQb(){return 0<this.v0a?this.J3[0].state:5}get WCf(){return 3===this.bQb&&!this.utb}fzb(Da){this.addHandler(ee.nU,Da)}NMb(Da){this.removeHandler(ee.nU,Da)}dispose(){if(this.WCf)this.owb=!0;else{if(this.J3)for(const Da of this.J3)Da.NMb(Object(f.a)(this,this.xRa,"onInteractivityChanged")),
Id.a.VB(Da);this.H$=null;this.Zr.uc(nf.a.pointerDown,this.cab.element,Object(f.a)(this,this.xec,"onHitTarget"));this.Zr.uc(nf.a.pointerOver,this.cab.element,Object(f.a)(this,this.xec,"onHitTarget"));this.Zr.uc(nf.a.pointerOut,this.cab.element,Object(f.a)(this,this.xec,"onHitTarget"));super.dispose()}}Ijc(){this.L2b();this.visible=!0}j8c(){this.visible=!0;this.EXh();this.utb=!0}Jdg(){this.j8c()}hide(){this.z$i();this.T1a();this.cab.update(this.bQb,this.hYb)}hfa(Da){const pb=this.bQb,oc=this.utb;Da.clientId||
(Da.clientId=(pd.Juc++).toString());if(Da.clientId in this.wkd){var Mc=this.dDb(Da.clientId);if(0<=Mc){Mc=this.rq[Mc];if(Mc.color===Da.color&&Mc.userName===Da.userName)return;this.F5a(Da.clientId)}}this.hide();Mc=new jg(this.createElement("div"),this.Vf);Mc.fzb(Object(f.a)(this,this.xRa,"onInteractivityChanged"));this.t6.insertBefore(Mc.element,this.t6.firstChild);this.wkd[Da.clientId]=Mc;Array.add(this.rq,Da);Array.add(this.J3,Mc);this.tHj(pb,oc);this.visible=!0}F5a(Da){if(this.WCf)Array.add(this.puc,
Da);else{var pb=this.bQb,oc=this.utb;this.hide();this.i4c(Da);this.tHj(pb,oc)}}ZOi(Da){const pb=this.dDb(Da);if(!(0>=pb)){var oc=this.rq[pb];Da=this.wkd[Da];Array.removeAt(this.rq,pb);Array.insert(this.rq,0,oc);Array.removeAt(this.J3,pb);Array.insert(this.J3,0,Da);this.t6.removeChild(Da.element);this.t6.appendChild(Da.element);this.L2b()}}tHj(Da,pb){0>=this.rq.length?this.hide():3===Da&&pb?this.j8c():this.Ijc()}pif(Da){if(this.WCf&&this.R5j)return!1;Da=pd.itf(Da);if(this.t6!==Da&&mf.a.VPa(this.t6,
Da))return!0;for(const pb of this.J3)if(mf.a.VPa(pb.element,Da))return!0;return!1}position(Da,pb){this.element.style.top=pb+"px";this.element.style.left=Da+"px"}L2b(Da=!1){if(!Da||this.LKa){this.eZg&&this.Bmj(!0);var pb=Math.min(3,this.v0a)-1;Da=0;var oc=1,Mc=0;this.hYb&&(Da=this.poc,oc=-1,Mc=-this.beb);for(let $c=this.v0a-1;$c>pb;$c--)this.J3[$c].Tqj(this.rq[$c],-4*pb*oc+Mc,!0,!1,!0,Da);for(;0<=pb;pb--)this.J3[pb].Tqj(this.rq[pb],-4*pb*oc+Mc,0<pb,Array.contains(this.YRb,this.rq[pb].clientId),pb!==
this.und,Da);this.und=0;this.cab.update(0,this.hYb);this.zIndex=this.F_a;this.utb=!1;this.z$i(0);this.owb&&this.dispose()}}EXh(){this.eZg&&this.Bmj(!1);this.zIndex=this.F_a+1;let Da,pb,oc;({offsetX:pb,offsetY:Da,Ani:oc}=this.Sio());for(let Mc=0;Mc<this.v0a;Mc++)this.J3[Mc].Vuo(this.rq[Mc],pb,Da+(this.beb+2)*Mc,Mc!==this.und,oc)}T1a(){let Da=0,pb=0;this.hYb&&(Da=this.poc,pb=-6);for(let oc=0;oc<this.v0a;oc++)this.J3[oc].hide(this.rq[oc],pb,Da);this.zIndex=this.F_a;this.visible=this.utb=!1;this.owb&&
this.dispose()}V7e(Da=0){Da?(this.LKa=!0,F.Task.delay(Da).continueWith(()=>{this.VXg?this.asm():this.L2b(!0);this.LKa=!1})):this.VXg?this.hide():this.L2b()}asm(){this.LKa&&this.hide()}VJk(){if(n.AFrameworkApplication.ta&&n.AFrameworkApplication.ta.Nb.Ioa&&Fd.c()){const Da=appChrome.selectors.getShyState();return Da.isActive&&0!==Da.state}return!1}xRa(Da,pb){Da=this.bQb;this.VJk()||2!==pb.type&&(4!==pb.type||3===Da)?4===pb.type&&3===Da?(this.LKa&&(this.LKa=!1),this.V7e()):3!==pb.type||3!==Da||this.utb||
(1<this.v0a?(this.LKa=!0,F.Task.delay(250).continueWith(()=>{this.L2b(!0);this.LKa=!1})):this.V7e()):(this.LKa&&(this.LKa=!1),3!==Da&&(this.EXh(),3===pb.Lo.kg&&this.V7e(2E3)));this.raiseEvent(ee.nU,pb)}xec(Da){3===Da.kg?this.xRa(this,new ee(4,Da)):Da.eventName===nf.a.pointerOver?this.xRa(this,new ee(2,Da)):Da.eventName===nf.a.pointerOut&&this.xRa(this,new ee(3,Da));return!1}W$f(Da){this.element.style.width=Da+"px";this.element.style.height=this.beb+"px"}i4c(Da){this.RXn(Da);Da=this.dDb(Da);if(!(0>
Da)){var pb=this.rq[Da];Array.removeAt(this.rq,Da);delete this.wkd[pb.clientId];pb=this.J3[Da];this.t6.removeChild(pb.element);this.Vf.get(18,!1)&&pb.NMb(Object(f.a)(this,this.xRa,"onInteractivityChanged"));Array.removeAt(this.J3,Da);pb.dispose()}}z$i(Da=5){if(this.puc.length){this.visible&&this.T1a();for(let pb=0;pb<this.puc.length;pb++)this.i4c(this.puc[pb]);Array.clear(this.puc);0>=this.rq.length||5===Da?this.hide():0===Da&&this.Ijc()}}dDb(Da){for(let pb=0;pb<this.rq.length;pb++)if(this.rq[pb].clientId===
Da)return pb;return-1}RXn(Da){-1===this.dDb(Da)?k.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.YRb,Da)&&(Array.remove(this.YRb,Da),this.rq[0].clientId===Da&&0<this.YRb.length&&this.ZOi(this.YRb[this.YRb.length-1]),this.rq[0].clientId===Da&&1===this.bQb&&this.L2b())}Bmj(Da){Da?Sys.UI.DomElement.addCssClass(this.t6,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.t6,"prBackgroundSelection")}Sio(){let Da,pb;pb=Da=0;var oc=
this.poc;if(this.zkh){const Mc=this.zkh(this);if(!Mc)return{offsetX:Da,offsetY:pb,Ani:oc};const $c=4===this.bQb;oc=this.Nek.f0l(this.v0a,$c?6:this.beb,this.beb,this.element,Mc);pb=oc.offsetTop;this.und=this.JZl(oc.kJj,oc.offsetTop);oc=oc.Bni;oc!==this.poc&&(this.Z6f(oc),this.element.dir=3===oc?"rtl":"ltr",this.poc=oc);oc!==this.Y6h()?(Da=this.Tek?-2:$c?-6:-this.beb,this.hYb=!0):this.hYb=!1}return{offsetX:Da,offsetY:pb,Ani:oc}}JZl(Da,pb){if(1===Da)return this.v0a-1;Da=Math.abs(pb);return 0<Da?Da/(this.beb+
2):0}Z6f(Da){for(let pb=0;pb<this.v0a;pb++)this.J3[pb].Z6f(Da)}Y6h(){return this.em?3:4}static Tgb(){return String.format("{0}-{1}","presencetooltip",pd.Juc++)}static itf(Da){return Da.Gb.rawEvent.relatedTarget}}pd.Juc=0;Object(l.a)(pd,"ModernPresenceTooltipControl",xd,[1408,10]);var lf=c(230),Ze=c(272);class Vg{constructor(Da){this.Vf=Da;this.Vf.KMa(10,lf.a.instance);this.Vf.KMa(9,Kd.a.instance);this.Vf.KMa(6,20);this.Vf.KMa(13,Ze.a.instance);this.Vf.KMa(17,!1)}O$e(Da,pb=!1){this.Vf.KMa(15,pb);return new pd(Da,
20,this.Vf)}}Object(l.a)(Vg,"ModernPresenceTooltipFactory",null,[1407]);class Pi extends xd{constructor(Da,pb){super(Da);this.rq=null;this.$La=pb.get(8,!1);this.j$a=pb.get(6,0);this.element=Da;this.element.className=Pi.Rkf;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.ig=pb.get(10);this.ig.mb(nf.a.click,this.element,Object(f.a)(this,this.onClick,"onClick"));this.Zr=pb.get(9);this.Zr.mb(nf.a.pointerOut,this.element,Object(f.a)(this,this.GJ,"onPointerOut"));this.Zr.mb(nf.a.pointerDown,
this.element,Object(f.a)(this,this.hja,"stopPropagationAndPreventDefaultBehavior"));this.oE=pb.get(13);this.oE.mb(this.element,Object(f.a)(this,this.hja,"stopPropagationAndPreventDefaultBehavior"))}fzb(Da){this.addHandler(ee.nU,Da)}NMb(Da){this.removeHandler(ee.nU,Da)}get users(){return this.rq}dispose(){this.element&&(this.ig.uc(nf.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),this.Zr.uc(nf.a.pointerDown,this.element,Object(f.a)(this,this.hja,"stopPropagationAndPreventDefaultBehavior")),
this.Zr.uc(nf.a.pointerOut,this.element,Object(f.a)(this,this.GJ,"onPointerOut")),this.oE.uc(this.element,Object(f.a)(this,this.hja,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(Da,pb,oc){this.hide();!Da||0>=Da.length||(this.$La?this.element.style.right=pb+"px":this.element.style.left=pb+"px",this.element.style.top=oc+"px",this.ovk(Da),this.visible=!0)}ovk(Da){this.rq=Da;mf.a.vC(this._ul);for(let pb=Da.length-1;0<=pb;pb--)this.hfa(Da[pb])}hfa(Da){const pb=
document.createElement("li");pb.style.backgroundColor=Da.color;pb.style.height=this.j$a+"px";pb.id="fly_"+Da.clientId;pb.style.lineHeight=this.j$a+"px";mf.a.Gy(pb,Da.userName);pb.setAttribute("dir","auto");this._ul.appendChild(pb)}onClick(){this.hide();return!1}GJ(Da){this.raiseEvent(ee.nU,new ee(3,Da));return!1}}Pi.Rkf="prFlyout UIFont";Object(l.a)(Pi,"PresenceTooltipFlyoutControl",xd,[]);class Sh extends xd{constructor(Da,pb,oc){super(Da);this._img=null;this.rq=[];this.element.className="prGlyph";
this.Vf=pb;this.NXb=this.Vf.get(9);this.Lq=this.Vf.get(10);this.oE=this.Vf.get(13);this.vsm();this.hfa(oc);this.eFe=!1}get w4a(){return this.rq.length}get users(){return this.rq}fzb(Da){this.addHandler(ee.nU,Da)}NMb(Da){this.removeHandler(ee.nU,Da)}dispose(){this.UPo();super.dispose()}hfa(Da){Array.add(this.rq,Da);2===this.w4a?this.Aja(!0):1===this.w4a?this.Aja(!1):this.Aja(this.eFe)}F5a(Da){this.qBl(Da)&&(1<this.w4a&&this.Aja(!0),1===this.w4a?this.Aja(!1):1>this.w4a&&this.hide())}show(){this.Aja(2<=
this.w4a);this.visible=!0}hide(){this.visible=!1}tZl(Da){return Da?this.w5h(0,5):this.w5h(1,4)}qBl(Da){for(let pb=0;pb<this.w4a;pb++)if(this.rq[pb].clientId===Da)return Da=this.rq[pb],Array.removeAt(this.rq,pb),Da;return null}Aja(Da){this.eFe!==Da&&(this._img&&this.element.removeChild(this._img),this._img=this.tZl(Da),this.element.appendChild(this._img),this.eFe=Da);this._img.childNodes[0].style.backgroundColor=this.rq[this.rq.length-1].color}w5h(Da,pb){const oc=this.Vf.get(6,0),Mc=this.Vf.get(14);
return oe.createClusteredImageFromClusterWithImageClass(oc,oc,this.Vf.get(Da),this.Vf.get(pb),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,Mc?Mc.cloneNode(!0):null)}hP(Da){3!==Da.kg&&this.raiseEvent(ee.nU,new ee(2,Da));return!1}onClick(Da){this.raiseEvent(ee.nU,new ee(1,Da));return!0}GJ(Da){3!==Da.kg&&this.raiseEvent(ee.nU,new ee(3,Da));return!1}UPo(){this.element&&(this.NXb.uc(nf.a.pointerDown,this.element,Object(f.a)(this,this.hja,"stopPropagationAndPreventDefaultBehavior")),
this.NXb.uc(nf.a.pointerOver,this.element,Object(f.a)(this,this.hP,"onPointerOver")),this.NXb.uc(nf.a.pointerOut,this.element,Object(f.a)(this,this.GJ,"onPointerOut")),this.Lq.uc(nf.a.oB,this.element,Object(f.a)(this,this.hja,"stopPropagationAndPreventDefaultBehavior")),this.Lq.uc(nf.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),this.oE.uc(this.element,Object(f.a)(this,this.hja,"stopPropagationAndPreventDefaultBehavior")))}vsm(){this.element&&(this.NXb.mb(nf.a.pointerDown,this.element,
Object(f.a)(this,this.hja,"stopPropagationAndPreventDefaultBehavior")),this.NXb.mb(nf.a.pointerOver,this.element,Object(f.a)(this,this.hP,"onPointerOver")),this.NXb.mb(nf.a.pointerOut,this.element,Object(f.a)(this,this.GJ,"onPointerOut")),this.Lq.mb(nf.a.oB,this.element,Object(f.a)(this,this.hja,"stopPropagationAndPreventDefaultBehavior")),this.Lq.mb(nf.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),this.oE.mb(this.element,Object(f.a)(this,this.hja,"stopPropagationAndPreventDefaultBehavior")))}}
Object(l.a)(Sh,"PresenceTooltipGlyph",xd,[]);class wh extends xd{constructor(Da,pb,oc){super(Da);this.rq=[];this.BK=[];this.rLa=0;this.dBc=this.ZUb=!1;this.sKg=null;this.xkd={};this.Vf=oc;this.em=oc.get(8,!1);this.Fka=oc.get(11,!1);Da=oc.get(12,0);this.imageDimension=oc.get(6,0);this.kla=pb;this.element.id=wh.Tgb();this.element.className=xd.pMh(this.em);Da&&(this.zIndex=Da);this.rtl=this.em;this.W$f(pb);this.xAa=this.createElement("div");this.xAa.className=this.Fka?"prContainerV":"prContainerHr";
this.element.appendChild(this.xAa);this.oVg=Array(this.rLa);for(pb=0;pb<this.rLa;pb++)this.tba[pb]=new Pi(this.createElement("div"),this.Vf),this.tba[pb].fzb(Object(f.a)(this,this.xRa,"onInteractivityChanged")),this.element.appendChild(this.tba[pb].element)}get M$d(){return Se.a.clone(this.rq)}get tba(){return this.oVg}get tmh(){return this.sKg}get fje(){return this.imageDimension+2}get width(){return this.Fka?this.fje:this.kla}get height(){return this.Fka?this.kla:this.fje}fzb(Da){this.addHandler(ee.nU,
Da)}NMb(Da){this.removeHandler(ee.nU,Da)}dispose(){if(this.tba)for(const Da of this.tba)Da.NMb(Object(f.a)(this,this.xRa,"onInteractivityChanged")),Id.a.VB(Da);Id.a.G8f(this.BK);this.BK=this.oVg=null;super.dispose()}Ijc(){this.T1a();this.Wdg();this.visible=!0;this.ZUb=!1}j8c(){!this.BK||1>this.BK.length||(this.T1a(),this.visible=!0,this.Wdg(),this.A$d(this.BK[this.BK.length-1]),this.ZUb=!0)}Jdg(){if(this.BK&&!(1>this.BK.length)){this.visible=!0;this.Wdg();var Da=0;for(const pb of this.BK)this.A$d(pb,
Da++);this.ZUb=!1;this.dBc=!0}}hide(){this.visible=!1;this.T1a();for(let Da=0;Da<this.BK.length;Da++)this.BK[Da].hide();this.ZUb=!1}tCh(){if(!this.dBc)return!1;let Da=0;for(const pb of this.tba)pb.visible&&Da++;return this.dBc=0<Da&&(this.rq.length<=this.rLa?Da===this.rq.length:Da===this.rLa)}hfa(Da){if(!(0>=this.rLa)){Da.clientId||(Da.clientId=(wh.Juc++).toString());if(Da.clientId in this.xkd){var pb=this.dDb(Da.clientId);if(0<=pb){pb=this.rq[pb];if(pb.color===Da.color&&pb.userName===Da.userName)return;
this.F5a(Da.clientId)}}pb=this.tCh();var oc=0;if(this.rq.length<this.rLa){var Mc=new Sh(this.createElement("div"),this.Vf,Da);Mc.fzb(Object(f.a)(this,this.xRa,"onInteractivityChanged"));this.em&&!this.Fka&&0<this.rq.length?this.xAa.insertBefore(Mc.element,this.xAa.firstChild):(this.xAa.appendChild(Mc.element),oc=this.BK.length);Array.add(this.BK,Mc)}else this.em&&!this.Fka?Mc=this.BK[0]:(oc=this.BK.length-1,Mc=this.BK[oc]),Mc.hfa(Da);Mc.show();this.xkd[Da.clientId]=Mc;Array.add(this.rq,Da);this.dFj(Mc,
oc);pb&&this.Jdg()}}F5a(Da){const pb=this.tCh();pb&&this.T1a();this.i4c(Da);this.rq.length>=this.rLa&&this.BK.length<this.rLa&&this.uPn();0>=this.rq.length?this.hide():pb&&this.Jdg()}ZOi(){}i4c(Da){var pb=this.dDb(Da);0>pb||(Da=this.rq[pb],Array.removeAt(this.rq,pb),pb=this.xkd[Da.clientId],delete this.xkd[Da.clientId],pb.F5a(Da.clientId),this.dFj(pb),0>=pb.w4a&&(this.xAa.removeChild(pb.element),Array.remove(this.BK,pb),pb.dispose()))}uPn(){var Da=this.B5l();!Da||1>=Da.users.length||(Da=Array.clone(this.rq),
Da.forEach(pb=>{this.i4c(pb.clientId)}),Da.forEach(pb=>{this.hfa(pb)}))}dDb(Da){for(let pb=0;pb<this.rq.length;pb++)if(this.rq[pb].clientId===Da)return pb;return-1}B5l(){return this.em&&!this.Fka?this.BK[0]:this.BK[this.BK.length-1]}position(Da,pb){this.element.style.top=pb+"px";this.element.style.left=Da+"px"}Wdg(){for(let Da=0;Da<this.BK.length;Da++)this.BK[Da].show()}T1a(){for(let Da=0;Da<this.rLa;Da++)this.tba[Da].hide();this.dBc=!1}A$d(Da,pb=0){if(Da)if(this.sKg=Da,this.Fka){const oc=this.imageDimension;
if(1<Da.users.length)this.tba[pb].show(Da.users,oc,this.height-this.imageDimension);else{const Mc=this.xAa.children.length;for(let $c=0;$c<this.xAa.children.length;$c++)Da.element===this.xAa.children[$c]&&this.tba[pb].show(Da.users,oc,this.height-(Mc-$c)*this.fje+2)}}else this.tba[pb].show(Da.users,this.width,0)}xRa(Da,pb){var oc=Object(y.a)(Sh,Da);oc=oc?this.zZh(oc):-1;if(2===pb.type||1===pb.type&&-1!==oc&&!this.tba[oc].visible)this.A$d(Da);else if(1===pb.type)this.T1a(),this.ZUb=!1;else if(3===
pb.type){if(this.pif(pb.Lo))return;this.ZUb||this.T1a()}this.raiseEvent(ee.nU,pb)}pif(Da){Da=wh.itf(Da);let pb=!1;for(const oc of this.tba)if(mf.a.VPa(oc.element,Da)){pb=!0;break}return this.xAa!==Da&&mf.a.VPa(this.xAa,Da)||pb}dFj(Da,pb=0){const oc=this.rEm(Da);oc&&0>=Da.w4a?this.tba[pb].hide():oc?this.A$d(Da):this.tba[pb].hide()}zZh(Da){let pb=0;for(const oc of this.BK){if(Da===oc)return pb;pb++}return-1}rEm(Da){const pb=this.zZh(Da);return!!this.tmh&&Da===this.tmh&&-1!==pb&&this.tba[pb].visible}W$f(Da){this.rLa=
Da===this.imageDimension?1:Math.floor(Da/this.fje);this.Fka?(this.element.style.height=Da+"px",this.element.style.width=this.imageDimension+"px"):(this.element.style.width=Da+"px",this.element.style.height=this.imageDimension+"px")}static Tgb(){return String.format("{0}-{1}","presencetooltip",wh.Juc++)}static itf(Da){Da=Da.Gb.rawEvent;return Da.relatedTarget||Da.toElement}}wh.Juc=0;Object(l.a)(wh,"PresenceTooltipControl",xd,[1408,10]);class rm{constructor(Da){this.Vf=Da;this.Vf.KMa(10,lf.a.instance);
this.Vf.KMa(9,Kd.a.instance);this.Vf.KMa(6,16);this.Vf.KMa(13,Ze.a.instance)}O$e(Da){return new wh(Da,16,this.Vf)}}Object(l.a)(rm,"PresenceTooltipFactory",null,[1407]);var xf=c(251),lg=c(112),nd=c(53),ud=c(6),Bd=c(5),kl=c(18),fi=c(78),ji=c(511),wi=c(306),xl=c(110);class Fl extends Sys.EventArgs{constructor(Da,pb){super();this.paragraphId=Da;this.oYm=pb}}Object(l.a)(Fl,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class di extends xd{constructor(Da,pb,oc,Mc,$c,$d=null,jc=null){super(null);this.qkd=
this.Vm=null;this.lXc=!1;this.Oqa=0;this.yp=Da;this.fCc=pb;this.Zr=oc;this.mj=Mc;this.xJa=$c;di.Ptb=0;this.Mrh=new $b.a;this.wdj=new $b.a;this.sW=$d;this.Ma=jc;this.M2j=this.Ma.mc("PresenceIpRenderedFloodgateTimeLapseSec",30);this.Bmk=this.Ma.mc("PresenceIpRenderedFloodgateTriggerThreshold",3);this.Fra=0}get m4a(){return n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}awk(Da){this.addHandler("CR",Da)}gaj(Da){this.removeHandler("CR",Da)}Ybe(){this.raiseEvent("CR",new Fl(this.yp.ip.paragraphId,
this.lXc))}GNf(){if(Object(xl.a)(pd,this.Vm)){const Da=Object(y.a)(pd,this.Vm);di.Ptb=0<di.Ptb?di.Ptb+1:Da.F_a+1;Da.zIndex=di.Ptb;this.element.style.zIndex=String(di.Ptb)}}d5n(){if(Object(xl.a)(pd,this.Vm)){const Da=Object(y.a)(pd,this.Vm);di.Ptb=Da.F_a;Da.zIndex=Da.F_a;this.element.style.zIndex=String(Da.F_a)}}MJi(){this.sW&&!this.lMo()&&this.sW.continueWith(()=>{this.sW.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.M2j)&&this.Fra++})}lMo(){return this.Fra>=this.Bmk}static $Ii(){di.aVg||
(di.aVg=!0,k.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static Tgb(Da){return di.Ktm+Da.s9h()}}di.p2i="data-presence-control";di.dZi="OverlayControlElementOwner";di.Ktm="ipId_";di.q2i="WacPresence";di.zxn="PresenceIpPaddingDiv";di.aVg=!1;di.Ptb=0;Object(l.a)(di,"APresenceControl",xd,[1580,10]);class Xi{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.E6a=!1}}Object(l.a)(Xi,"PresenceImageControlStyle",null,[1579]);class Yi extends di{constructor(Da,
pb,oc,Mc,$c,$d=null,jc=null){super(Da,pb,oc,Mc,$c,$d,jc);this.GJ=()=>{this.eOi();return!1};this.g8d=$e=>{this.Vm&&3===$e.kg&&(2!==this.Oqa?(this.GNf(),this.aPb()):this.eOi());return!1}}F5a(Da){this.Vm&&this.Vm.F5a(Da)}hoe(){return this.Vm?this.Vm.M$d.length:0}updatePosition(Da){if(this.element&&this.element.parentNode){var pb=this.R9h(Da);if(pb){var oc=Sys.UI.DomElement.getBounds(this.element.parentNode),Mc,$c;({left:oc,top:Mc,height:$c,width:pb}=this.d8l(pb,oc,this.element.parentNode,this.mj.instance));
this.element.style.top=Mc+"px";this.element.style.left=oc+"px";this.element.style.height=$c+"px";this.element.style.width=pb+"px";oc=this.Z9h(Da);of.a.i5(this.element,oc);Da=this.Eqf(Da,this.yp.ip.shapeId);this.fnj(oc,pb,this.isSelected(Da),n.AFrameworkApplication.isRtl);this.aPb()}}}CY(){this.element&&(mf.a.jx(this.element),this.Vm.F5a(this.yp.user.clientId),this.Ybe())}IGh(Da,pb,oc,Mc){pb=new Xi;if(!Mc||!oc)return pb;oc=this.R9h(Da);if(!oc)return pb;pb.top=oc.y;pb.left=oc.x;pb.height=oc.height;
pb.width=oc.width;pb.rotation=this.M$l(Da);pb.E6a=!0;return pb}fbj(Da,pb,oc,Mc){di.$Ii();this.qkd=Da;if(Mc){const $c=this.Eqf(Da,this.yp.ip.shapeId);if(!$c)return;const $d=!this.element;$d&&this.S$e(pb.ownerDocument,Da);$d||!this.element.parentNode?$c.appendChild(this.element):this.element.parentNode!==$c&&(this.element.parentNode.removeChild(this.element),$c.appendChild(this.element));this.Vm.hfa(this.yp.user);this.element.style.borderColor=this.yp.user.color;this.element.id=di.Tgb(this.yp);oc.E6a&&
(this.element.style.height=oc.height+"px",this.element.style.top=oc.top+"px",this.element.style.left=oc.left+"px",this.element.style.width=oc.width+"px",of.a.i5(this.element,oc.rotation),of.a.i5(this.Vm.element,-1*oc.rotation),this.fnj(oc.rotation,oc.width,this.isSelected($c),n.AFrameworkApplication.isRtl),this.aPb())}this.lXc=!Mc;this.Ybe()}M$l(Da){return this.element&&this.element.parentNode&&this.bfi(of.a.getTransform(this.element.parentNode))?this.bfi(of.a.getTransform(this.element)):this.Z9h(Da)}bfi(Da){return Da&&
-1<Da.indexOf("deg")&&(Da=parseInt(Da.substring(Da.indexOf("(")+1,Da.indexOf("deg"))),!isNaN(Da))?Da:0}EEj(Da){this.element.style.borderColor=this.yp.user.color;this.element.id=di.Tgb(this.yp);this.updatePosition(Da)}S$e(Da,pb){this.element=Da.createElement("div");this.element.setAttribute(di.p2i,!0);lg.a.Kl(this.element,di.dZi,this);this.element.className=Yi.EFn;n.AFrameworkApplication.K&&n.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoopsCoAuthSelectionIssueFixIsEnable",
!1)&&(Da=pb.Bb)&&Da.wQ&&(this.element.style.pointerEvents="none");this.element.dir=n.AFrameworkApplication.isRtl?"rtl":"ltr";this.Vm=this.fCc.O$e(this.createElement("div"),!0);this.Vm.hfa(this.yp.user);this.Vm.hide();this.Zr.mb(nf.a.pointerOut,this.Vm.element,this.GJ);this.Zr.mb(nf.a.pointerDown,this.Vm.element,this.g8d);this.Vm.element.classList.add(di.q2i);this.element.appendChild(this.Vm.element)}d8l(Da,pb,oc,Mc){let $c=Da.y,$d=Da.x,jc=Da.height;Da=Da.width;(1<Math.abs(pb.width-oc.offsetWidth)||
1<Math.abs(pb.height-oc.offsetHeight))&&Mc&&($c=Math.round($c/Mc.hj),$d=Math.round($d/Mc.hj),jc=Math.round(jc/Mc.hj),Da=Math.round(Da/Mc.hj));return{left:$d,top:$c,height:jc,width:Da}}isSelected(Da){return Da.classList.contains(wi.a.q4b)}fnj(Da,pb,oc,Mc){this.Vm.element.style.left="auto";this.Vm.element.style.top="auto";this.Vm.element.style.right="auto";this.Vm.element.style.bottom="auto";oc=oc?Math.round(.5*Yi.Nqa)+Yi.$Jo:0;0<=Da&&90>Da||360===Da?(this.Vm.element.style.top=-.5*Yi.Nqa-oc+"px",Mc?
this.Vm.element.style.right=pb-.5*Yi.Nqa+"px":this.Vm.element.style.left=pb-.5*Yi.Nqa+"px"):90<=Da&&180>Da?(this.Vm.element.style.left=-.5*Yi.Nqa-oc+"px",Mc?this.Vm.element.style.bottom=-.5*Yi.Nqa+"px":this.Vm.element.style.top=-.5*Yi.Nqa+"px"):180<=Da&&270>Da?(this.Vm.element.style.bottom=-.5*Yi.Nqa-oc+"px",Mc?this.Vm.element.style.left=pb-.5*Yi.Nqa+"px":this.Vm.element.style.right=pb-.5*Yi.Nqa+"px"):(this.Vm.element.style.right=-.5*Yi.Nqa-oc+"px",Mc?this.Vm.element.style.top=-.5*Yi.Nqa+"px":this.Vm.element.style.bottom=
-.5*Yi.Nqa+"px")}wl(Da,pb){const oc=this.xPd(Da,pb);return oc?oc.properties:(Da=this.X9h(Da,pb))?Da.properties:null}Eqf(Da,pb){var oc=this.xPd(Da,pb);return oc&&(oc=oc.Ova(Da.fh,Da))?oc.element:(pb=this.X9h(Da,pb))?Object(y.a)(ji.a,pb).De(Da.ic).htmlElement:null}xPd(Da,pb){Da=fi.i(Da.Bb,5);for(const oc of Da)if(oc.properties.getValue(ud.a.qCb)===pb)return oc;return null}X9h(Da,pb){Da=Bd.GraphIterator.$a(Da.Bb);let oc=Da.Sb(6);for(;oc;){const Mc=oc.properties.getValue(ud.a.qCb);if(kl.ImageReader.Eu(oc)&&
Mc===pb)return oc;oc=Da.vf(6)}return null}gZl(Da){const pb=nd.a.xf(kl.ImageReader.dF(Da),0);Da=nd.a.xf(kl.ImageReader.wG(Da),1);return{Hja:pb,srm:Da}}Z9h(Da){Da=this.wl(Da,this.yp.ip.shapeId);return kl.ImageReader.A_(Da)}R9h(Da){var pb=this.yp.ip;if(!pb||!pb.shapeId)return null;var oc=this.wl(Da,pb.shapeId);const Mc=this.Eqf(Da,pb.shapeId);if(!oc||!Mc)return null;const $c=kl.ImageReader.mk(oc);let $d=Da=1,jc;({Hja:pb,srm:jc}=this.gZl(oc));Ga.App.instance&&Ga.App.instance.f4($c)?(oc=kl.ImageReader.wna(oc),
Da=nd.a.xf(oc[0],0),$d=nd.a.xf(oc[2],1)):oc.hasProperty(ud.a.Nca)?(oc=oc.getValue(ud.a.Nca),Da+=nd.a.xf(oc[0],0),$d+=nd.a.xf(oc[2],1)):(Da+=0<Mc.offsetWidth?(Mc.offsetWidth-pb)/2:2,$d+=0<Mc.offsetHeight?(Mc.offsetHeight-jc)/2:2);return new Sys.UI.Bounds(Math.round(Da),Math.round($d),Math.round(pb),Math.round(jc))}eOi(){this.Vm&&(this.Vm.Ijc(),this.Oqa=1)}aPb(){for(const Da of this.Vm.M$d)if(Da.clientId===this.yp.user.clientId&&!Da.equals(this.yp.user)){this.Vm.hfa(this.yp.user);break}if(this.yp.lTa||
2===this.Oqa)this.Vm.j8c(),this.yp.lTa=!1,this.yp.gca=!0,this.Oqa=2;this.yp.gca&&1!==this.Oqa||(this.Vm.Ijc(),this.yp.gca=!0,this.Oqa=1)}}Yi.EFn="WACImgPresenceHighlight";Yi.Nqa=20;Yi.$Jo=6;Object(l.a)(Yi,"PresenceImageControl",di,[]);var sm=c(276);class Fg{constructor(){this.height=this.top=this.left=this.pti=0;this.E6a=!1;this.MB=this.Lh=null}}Object(l.a)(Fg,"PresenceIpControlStyle",null,[1579]);var $f=c(61);class Qi extends di{constructor(Da,pb,oc,Mc,$c,$d=null,jc=null,$e=null){super(Da,pb,oc,
Mc,$c,$d,jc);this.kBc=this.nWa=this.kZb=null;this.hP=Wc=>{!this.Vm||this.m4a&&!this.Vm.pif(Wc)||(this.GNf(),this.Tee(Wc));this.EEj(this.qkd);return!1};this.GJ=()=>{this.Vm&&this.YQ();return!1};this.g8d=Wc=>{this.Vm&&3===Wc.kg&&(2!==this.Oqa?(this.GNf(),this.Tee(Wc)):this.YQ());return!1};this.vD=$e}S$e(Da){this.element=Da.createElement("div");this.element.setAttribute(di.p2i,!0);lg.a.Kl(this.element,di.dZi,this);this.element.className=di.zxn;this.element.dir=n.AFrameworkApplication.isRtl?"rtl":"ltr";
this.Zr.mb(nf.a.pointerOver,this.element,this.hP);this.m4a&&(this.Zr.mb(nf.a.pointerOut,this.element,this.GJ),this.Zr.mb(nf.a.pointerDown,this.element,this.g8d));this.nWa=this.createElement("div");this.nWa.className=Qi.FFn;this.m4a||(this.kBc=this.createElement("div"),this.kBc.className=Qi.IFn,this.nWa.appendChild(this.kBc));this.Vm=this.fCc.O$e(this.createElement("div"),this.m4a);Da=this.Ma.$("NoPresenceUserLookUpBeforeRender");this.vD&&!Da&&(this.yp.user=this.vD.YKf(this.yp.user.clientId)||this.yp.user);
this.Vm.hfa(this.yp.user);this.Vm.hide();this.Vm.element.classList.add(this.m4a?di.q2i:Qi.RAn);this.nWa.appendChild(this.Vm.element);this.element.appendChild(this.nWa)}fjl(){this.kZb&&(cc.a.instance.We(this.kZb),this.kZb=null)}aPb(Da){for(var pb of this.Vm.M$d)if(pb.clientId===this.yp.user.clientId&&!pb.equals(this.yp.user)){this.Vm.hfa(this.yp.user);break}pb=!1;Qi.Zgl===this.yp.user.color?({value:pb}=this.Mrh.Dc(this.yp.user.clientId,!1),pb||(this.Mrh.Z(this.yp.user.clientId,!0),k.ULS.sendTraceTag(17954772,
302,50,'{ "ClientID" : "'+this.yp.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):({value:pb}=this.wdj.Dc(this.yp.user.clientId,!1),pb||(this.wdj.Z(this.yp.user.clientId,!0),k.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.yp.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return Da||this.yp.lTa||2===this.Oqa?(this.MJi(),this.Vm.j8c(),this.yp.lTa=!1,this.yp.gca=!0,this.Oqa=2,Qi.KIo):this.yp.gca&&1!==this.Oqa?0:(this.MJi(),this.Vm.Ijc(),this.yp.gca=!0,this.Oqa=1,Qi.JIo)}Tee(Da=null){this.fjl();
const pb=this.aPb(!!Da);this.m4a&&Da&&Da.eventName===nf.a.pointerOver||this.V$n(pb)}YQ(){this.Vm&&this.Oqa&&(this.d5n(),this.Vm.hide(),this.Oqa=0)}V$n(Da){this.kZb=new ha.a(2,1,Da,()=>{this.kZb=null;this.YQ()},56);cc.a.instance.Wb(this.kZb)}updatePosition(Da){if(this.element&&this.element.parentNode){var pb=this.G$h(Da);if(pb){Da=Sys.UI.DomElement.getBounds(this.element.parentNode);pb=new Sys.UI.Bounds(pb.x-Da.x,pb.y-Da.y,Qi.tti,pb.height);var oc;({left:Da,top:pb,height:oc}=this.g8l(pb,Da,this.element.parentNode,
this.mj.instance));this.element.style.height=2*Qi.jfc+oc+"px";this.element.style.top=pb-Qi.jfc+"px";this.element.style.left=Da-Qi.jfc+"px";this.nWa.style.height=Math.max(Qi.UNi,oc)+"px";this.Tee()}}}CY(){this.element&&(mf.a.jx(this.element),this.Ybe())}IGh(Da,pb,oc,Mc,$c){const $d=new Fg;if(!Mc||!oc)return $d;Mc=this.G$h(Da);if(!Mc)return $d;var jc=oc;oc=Da;if(Da.Cj){var $e=Da.nc;jc=Da.Qg.x8b(this.yp.ip.y9.cp);0>jc&&0==jc;Da.nc.xwa?mf.a.VPa($e.editingElement,Da.Qg.Qi.J(jc))||(oc=$f.InteractiveViewManager.instance.Bd.Gj(Da.source),
pb=oc.Qg.Qi.J(jc)):pb=oc.Qg.Qi.J(jc);jc=pb.getBoundingClientRect()}jc=new Sys.UI.Bounds(Mc.x-jc.x,Mc.y-jc.y,Qi.tti,Mc.height);Da=jc.y;Mc=jc.x;jc=jc.height;$e=this.mj.instance;$c&&$e&&($c=$e.hj,Da=Math.round(Da/$c),Mc=Math.round(Mc/$c),jc=Math.round(jc/$c));$d.top=Da-Qi.jfc;$d.left=Mc-Qi.jfc;$d.height=2*Qi.jfc+jc;$d.pti=Math.max(Qi.UNi,jc);$d.E6a=!0;$d.Lh=pb;$d.MB=oc;return $d}fbj(Da,pb,oc,Mc){di.$Ii();this.qkd=Da;Da=oc.Lh;pb=oc.MB;if(Da&&pb){if(Mc){const $c=!this.element;$c&&this.S$e(Da.ownerDocument);
$c||!this.element.parentNode?Da.appendChild(this.element):this.element.parentNode!==Da&&(this.element.parentNode.removeChild(this.element),Da.appendChild(this.element));this.qkd=pb;Da=this.yp.user.color;this.nWa.style.borderColor=Da;this.m4a||(this.kBc.style.borderColor=Da);this.element.id=di.Tgb(this.yp);oc.E6a&&(this.element.style.height=oc.height+"px",this.element.style.top=oc.top+"px",this.element.style.left=oc.left+"px",this.nWa.style.height=oc.pti+"px",this.Tee())}this.lXc=!Mc;this.Ybe()}else k.ULS.sendTraceTag(520950942,
302,50,`Skip IpControl rendering due to paragraphElement is null:${!Da} or paragraphViewElement is null:${!pb}`)}dispose(){this.element&&(this.CY(),this.Zr.uc(nf.a.pointerOver,this.element,this.hP),this.m4a&&(this.Zr.uc(nf.a.pointerOut,this.element,this.GJ),this.Zr.uc(nf.a.pointerDown,this.element,this.g8d)),Id.a.VB(this.Vm),this.element=this.Vm=null);super.dispose()}EEj(Da){const pb=this.yp.user.color;this.nWa.style.borderColor=pb;this.m4a||(this.kBc.style.borderColor=pb);this.element.id=di.Tgb(this.yp);
this.updatePosition(Da)}g8l(Da,pb,oc,Mc){let $c=Da.y,$d=Da.x;Da=Da.height;(1<Math.abs(pb.width-oc.offsetWidth)||1<Math.abs(pb.height-oc.offsetHeight))&&Mc&&($c=Math.round($c/Mc.hj),$d=Math.round($d/Mc.hj),Da=Math.round(Da/Mc.hj));return{left:$d,top:$c,height:Da}}G$h(Da){const pb=this.yp.ip;if(!pb)return null;let oc;try{const Mc=pb.y9.cp;oc=sm.a.b_(Mc,Da,0<Mc,!1,!1,!1)}catch(Mc){k.ULS.sendTraceTag(4301318,302,15,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",cc.a.instance.Kv,
Mc.message,Mc.stack),oc=null}return oc}}Qi.RAn="WacPawn";Qi.tti=2;Qi.JIo=7E3;Qi.KIo=2E3;Qi.jfc=5;Qi.FFn="presenceIp";Qi.IFn="PresenceSmallBox";Qi.UNi=10;Qi.Zgl="0xcccccc";Object(l.a)(Qi,"PresenceIpControl",di,[]);class em{constructor(Da,pb,oc,Mc,$c=null,$d=null,jc=null){this.Nqc={};this.Lqc={};this.sOg={};this.fCc=Da;this.Zr=pb;this.Wm=oc;this.xJa=Mc;this.sW=$c;this.Ma=$d;this.vD=jc}get Efl(){return this.Nqc}get KNh(){return this.Lqc}c8l(Da){const pb=!!this.Ma&&this.Ma.$("PeoplesWellExtraButtonInfoIsEnabled");
return Da.ip.shapeId&&pb?this.h8l(Da):this.i8l(Da)}h8l(Da){const pb=Da.ip.shapeId.toString();this.sOg[Da.user.clientId]=pb;const oc=this.Lqc[pb];return oc?(oc.yp=Da,{returnValue:oc,foe:!0}):{returnValue:this.Lqc[pb]=new Yi(Da,this.fCc,this.Zr,this.Wm,this.xJa,this.sW,this.Ma),foe:!1}}i8l(Da){const pb=Da.user.clientId,oc=this.Nqc[pb];return oc&&oc.yp.user.equals(Da.user)?(oc.yp=Da,{returnValue:oc,foe:!0}):{returnValue:this.Nqc[pb]=new Qi(Da,this.fCc,this.Zr,this.Wm,this.xJa,this.sW,this.Ma,this.vD),
foe:!1}}H$h(Da){return this.Nqc[Da]}cZl(Da){return(Da=this.Lqc[this.sOg[Da]])&&!Da.hoe()?Da:null}wol(){var Da=this.Nqc;for(const pb in Da)Da[pb].dispose();Da=this.Lqc;for(const pb in Da)Da[pb].dispose()}}Object(l.a)(em,"PresenceControlProvider",null,[]);var Zi=c(157);class Tg{constructor(){this.ybb=0}ybi(){this.ybb++;this.ybb===Number.MAX_VALUE&&(this.ybb=1);return this.ybb}static get instance(){return Tg.pyc}}Tg.pyc=new Tg;Object(l.a)(Tg,"PacketIdGenerator",null,[230]);var Ri=c(1092);class cj{constructor(Da,
pb,oc){this.iao=Da;this.qvm=pb;this.kEi=oc}}Object(l.a)(cj,"SuccessfulInboundReplicationCallbackData",null,[]);class Fh{constructor(Da,pb,oc,Mc,$c,$d,jc){this.M8n=($e,Wc)=>{Wc.type||($e=this.Nk.nUh>=this.f1j,this.Rlk&&$e?($e=this.GBe())?$e.gWh():k.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.aF())};this.Ctn=$e=>{if($e=Object(y.a)(cj,$e)){var Wc=$e.qvm.ti.toString(),Ng=this.GBe(),Re=Ng.Bt,Ah="";Re!==$e.kEi&&(k.ULS.sendTraceTag(19964236,
500,50,"Time saved due to force inbound on update notification message = {0} ms",$e.iao.toString()),Ah=this.z3l(Ng,Re,$e.kEi));k.ULS.sendTraceTag(19964237,500,50,"Revisions: {0}, InboundDuration: {1}",Ah,Wc)}else k.ULS.sendTraceTag(19964235,500,10,"The callback data was null")};this.E8n=Da;this.GBe=pb;this.Nk=oc;this.Rlk=$c;this.f1j=$d;this.hWb=Mc;this.Eq=jc;this.E8n.c3(this.M8n)}aF(){const Da=this.GBe();if(!Da)k.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");
else if(!this.hWb()&&Da.GQa){let pb=-1;Object(xl.a)(Ri.a,Da)&&(pb=Da.ek.ZGa());const oc=this.Eq.$f("Task","ShoulderTapInboundReplicationTimer");Da.aF(this.Ctn,null,new cj(pb,oc,Da.Bt))}}z3l(Da,pb,oc){const Mc=new Sys.StringBuilder;Da=Da.node.od.store.getRevision(pb);if(!Da)return k.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:pb}),"";for(Mc.append(Da.id.guid);pb!==oc;){Mc.append(", ");Mc.append(pb.guid);Da=Da.im;if(!Da)break;
pb=Da.id}return Mc.toString()}}Object(l.a)(Fh,"ContentNotificationManager",null,[]);class Kh extends Fh{constructor(Da,pb,oc,Mc,$c,$d,jc){super(Da,pb,oc,Mc,$c,$d,jc)}static get cqa(){return null!=Kh.OFg?Kh.OFg:Kh.OFg=Ka.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){if(Ga.App.xa){var Da=Ga.App.xa.hb;Da&&(Da.ifa(Kh.g_c),Da=Da.Uc)&&(Kh.xv=Da.contentReplicator,Kh.xv&&Ga.App.Pna().continueWith(Kh.VSf))}}static VSf(){Kh.pfd=Ga.App.Pna().result;Kh.pfd&&Kh.pfd.Qo&&Kh.cqa.OD().continueWith(Kh.U_c)}static U_c(){Kh.fj=
Kh.cqa.OD().result;if(Kh.fj){var Da=n.AFrameworkApplication.K,pb=Da.$("Box4ThrottleInboundRequests");Da=Da.mc("Box4ThrottleInboundsAtUserCount",20);Kh.xv.ERd=()=>Kh.fj.VQa;Kh.mfd=Kh.mfd||new Kh(Kh.fj,()=>Kh.xv,Kh.pfd,()=>n.AFrameworkApplication.Lk,pb,Da,Ga.App.xa.Gq);Kh.mfd.aF()}}static g_c(Da){Kh.mfd||(Da.ynb(Kh.g_c),Kh.init())}}Kh.mfd=null;Kh.fj=null;Kh.xv=null;Kh.pfd=null;Object(l.a)(Kh,"WordContentNotificationManager",Fh,[]);var Ok=c(48);class uj{constructor(Da,pb,oc,Mc,$c,$d){this.kgd=null;this.Aah=
Da;this.ud=oc;this.vLa=Mc;this.Ly=$c;this.yh=$d;this.Hqb=pb}clone(){return new uj(this.Aah,this.Hqb.clone(),this.ud,this.vLa,this.Ly,this.yh)}get cp(){if(null!=this.kgd)return this.kgd;var Da=this.Aah.paragraphId;if(Da.equals(cf.a.nil))return 0;var pb=this.vLa();if(!pb)return 0;Da=pb.Db(Da);if(!Da)return k.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;pb=this.ud.eBb(this.ud.MRa(Da.characterData,Da.pa),this.Hqb);if(Ok.a.Pj&&this.Ly){var oc=Va.a.Rc(Da,pb);
this.yh&&Da.Us&&(oc.Eb=this.yh.yQd(Da,pb,this.Hqb.rua));pb=this.Ly.cba(oc,!0)}else this.Ly&&this.yh&&Da.Us&&(oc=Va.a.Rc(Da,pb),oc.Eb=this.yh.yQd(Da,pb,this.Hqb.rua),pb=this.Ly.cba(oc,!0));return pb}eVf(){null==this.kgd&&(this.kgd=this.cp)}equals(Da){return Da?this.Hqb.isEqual(Da.Hqb,!1):!1}}Object(l.a)(uj,"WordPresenceCp",null,[251,111,252]);class tl{constructor(Da,pb){this.Ly=Da;this.yh=pb}create(Da,pb,oc,Mc){return new uj(Da,pb,oc,Mc,this.Ly,this.yh)}}Object(l.a)(tl,"Factory",null,[229]);class Lj extends Sys.EventArgs{constructor(Da,
pb,oc){super();this.paragraphId=Da;this.presence=pb;this.pBf=oc}}Object(l.a)(Lj,"ParagraphChangedEventArg",Sys.EventArgs,[]);class yl{constructor(Da){this.cp=Da}equals(Da){return Da?this.cp===Da.cp:!1}clone(){return new yl(this.cp)}}Object(l.a)(yl,"PresenceCp",null,[251,111]);class Lh{constructor(Da,pb,oc,Mc,$c){this.paragraphId=Da;this.cp=pb;this.length=oc;this.shapeId=Mc;this.dryDeletion=$c}}Object(l.a)(Lh,"SerializablePresenceIpData",null,[]);class Ck{constructor(Da,pb,oc,Mc=0,$c=0){this.Ksa=null;
Da&&(this.Ksa=cf.a.Ff(Da));this.zah=new yl(pb);this.BGa=oc;this.cfh=Mc;this.OSg=$c}get paragraphId(){return this.Ksa}get y9(){return this.zah}get shapeId(){return this.cfh}get dryDeletion(){return this.OSg}isValid(){return 0<=this.y9.cp&&!!this.paragraphId&&!this.paragraphId.equals(cf.a.nil)}getData(){return new Lh(this.paragraphId.toString(),this.y9.cp,this.BGa,this.shapeId,this.dryDeletion)}clone(){const Da=new Ck;Da.Ksa=this.paragraphId;Da.zah=this.y9?this.y9.clone():null;Da.BGa=this.BGa;Da.cfh=
this.shapeId;Da.OSg=this.dryDeletion;return Da}static jBb(Da){return Da.paragraphId&&void 0!==Da.cp&&null!==Da.cp&&void 0!==Da.length&&null!==Da.length?new Ck(Da.paragraphId,Da.cp,Da.length,void 0,Da.dryDeletion):null}}Object(l.a)(Ck,"PresenceIp",null,[249,111]);class lk{constructor(Da,pb){this.ip=Da;this.user=pb}}Object(l.a)(lk,"SerializablePresenceData",null,[]);class Pk{constructor(Da,pb){this.lTa=this.gca=this.ndc=!1;this.mWa=pb;this.user=Da}get ip(){return this.mWa}Jtf(){return new lk(this.ip?
this.ip.getData():null,this.user.getData())}s9h(){return this.user.clientId+(this.mWa?this.mWa.paragraphId.toString():cf.a.nil.toString())}isValid(){const Da=!!this.user&&this.user.isValid(),pb=!this.ip||this.ip.isValid();return Da&&pb}clone(){const Da=new Pk;Da.user=this.user?this.user.clone():null;Da.mWa=this.mWa?this.mWa.clone():null;Da.gca=this.gca;Da.ndc=this.ndc;Da.lTa=this.lTa;return Da}static jBb(Da){return Da?new Pk(fb.jBb(Da.user),Da.ip?Ck.jBb(Da.ip):null):null}}Object(l.a)(Pk,"PresenceInfo",
null,[253,111]);class Fm extends xa.a{constructor(){super();this.Cyc={};this.WUa={};this.VUg=!1}get Cyn(){return this.Cyc}get Zyi(){return!!n.AFrameworkApplication.K&&n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}oqh(Da){this.addHandler("PPC",Da)}Maj(Da){this.removeHandler("PPC",Da)}TOc(Da){return Da.ip.paragraphId.toString()}fZe(Da,pb=!1){this.VUg||(this.VUg=!0,k.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var oc=({GFn:Mc}=this.DTm(Da)).returnValue;
if(Mc&&!pb)(oc=this.WUa[Da.user.clientId])&&0<=oc.length&&(oc[oc.length-1].ip.BGa=Da.ip.BGa);else{oc||this.D$i(Da.user.clientId);this.Zyi&&oc&&this.UUo(Da);pb=this.TOc(Da);var Mc=Da.user.clientId;var $c=this.Cyc[pb]||[],$d=this.WUa[Mc]||[];$d.length>=Fm.CMi&&($d=$d.splice(-Fm.cin,Fm.CMi));oc||$c.push(Mc);$d.push(Da);this.Cyc[pb]=$c;this.WUa[Mc]=$d;Da.ip.paragraphId.equals(cf.a.nil)||this.r2f(Da.ip.paragraphId,Da,!0)}}DTm(Da){var pb=this.WUa[Da.user.clientId];const oc=!pb||0>=pb.length?null:pb[pb.length-
1],Mc=!!oc&&this.TOc(oc)===this.TOc(Da);pb=Mc&&oc.ip.y9.equals(Da.ip.y9)&&oc.user.equals(Da.user);this.Zyi&&pb&&oc.ip.shapeId&&Da.ip.shapeId&&oc.ip.shapeId!==Da.ip.shapeId&&(pb=!1);return{returnValue:Mc,GFn:pb}}UUo(Da){const pb=this.Rfl(Da);pb&&pb.ip.shapeId&&(Da.ip.shapeId&&Da.ip.shapeId===pb.ip.shapeId||this.r2f(pb.ip.paragraphId,pb,!1))}Rfl(Da){Da=this.WUa[Da.user.clientId];return!Da||0>=Da.length?null:Da[Da.length-1]}D$i(Da){const pb=this.WUa[Da];if(pb&&0<pb.length){const oc=pb[0].ip.paragraphId,
Mc=this.TOc(pb[0]);delete this.WUa[Da];this.AZn(Mc,Da);oc.equals(cf.a.nil)||this.r2f(oc,pb[0],!1)}}p5h(Da){return this.Cyc[Da]}YMc(Da,pb,oc,Mc=!1){const $c=[],$d=this.p5h(Da);if(!$d)return $c;for(let jc=0;jc<$d.length;jc++){const $e=$d[jc],Wc=this.WUa[$e];let Ng=!1;for(let Re=Wc.length-1;0<=Re;Re--){const Ah=Wc[Re];if(Mc){if(Ah.gca&&Ah.ip.paragraphId.equals(cf.a.Ff(Da))){Ng=!0;$c.push(Ah);break}}else if(Object(xl.a)(Pk,Ah)?Ah.ip.BGa===pb:Ah.ip.BGa===oc){Ng=!0;Ah.ndc=!0;$c.push(Ah);this.WUa[$e]=Wc.splice(Re,
Wc.length);break}}!Ng&&0<Wc.length&&Wc[0].ndc&&Wc[0].ip.paragraphId.equals(cf.a.Ff(Da))&&$c.push(Wc[0])}return $c}qLl(Da){if(!Da||!Da.Oa||!Da.Oa.node)return null;Da=this.YMc(Da.Oa.node.id.toString(),0,0,!0);Da=this.xhm(Da);Da.sort((pb,oc)=>{if(!(pb&&pb.userName&&oc&&oc.userName))return k.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),0});return Da}xhm(Da){if(!Da||!Da.length)return[];const pb=[],oc=new L.a(I.a.ai());for(let Mc=0;Mc<Da.length;Mc++){const $c=
Da[Mc].user;$c.isAnonymous&&oc.contains($c.clientId)||!$c.isAnonymous&&$c.email&&oc.contains($c.email)||(pb.push($c),oc.add($c.isAnonymous?$c.clientId:$c.email))}return pb}r2f(Da,pb,oc){this.raiseEvent("PPC",new Lj(Da,pb,oc))}AZn(Da,pb){Array.remove(this.Cyc[Da],pb)}}Fm.CMi=10;Fm.cin=2;Object(l.a)(Fm,"PresenceDataManager",xa.a,[1525]);class fm extends Fm{constructor(Da){super();this.kH=Da}fZe(Da,pb=!1){super.fZe(Da,pb)}TOc(Da){return Da.ip.Lc.toString()}p5h(Da){Da=this.kH.Db(cf.a.Ff(Da));if(!Da)return null;
Da=Da.ia(ud.a.Lc,0);return this.Cyn[Da.toString()]}}Object(l.a)(fm,"WordPresenceDataManager",Fm,[]);var gm=c(1478),kg=c(1061),$k=c(1865),am=c(17);class bg{constructor(Da,pb,oc,Mc,$c,$d,jc,$e,Wc,Ng,Re,Ah,hi,Sj,al,fj,yk,dn,Ji,nm,Lg,sf,ne,ke){this.wMa=Array(5);this.eWe=this._started=this.gRe=!1;this.LNe=null;this.abh=new L.a(I.a.ai());this.Kqd={};this.hGe=!1;this.iyn=()=>{if(!this.eWe&&!this.tl.rz){var We=new ha.a(0,1,20,()=>{const de=new P.a;var vl=this.Hbb.Efl;for(var Um in vl){const Th=vl[Um];Th.lXc&&
de.add(Th.yp.ip.paragraphId)}if(this.I5d){vl=this.Hbb.KNh;for(const Th in vl)Um=vl[Th],Um.lXc&&!de.contains(Um.yp.ip.paragraphId)&&de.add(Um.yp.ip.paragraphId)}this.z3h(de);this.eWe=!1},72);this.Hb.Wb(We);this.eWe=!0}};this.fUi=()=>{this.gRe&&(this.S9f(),this.gRe=!1)};this.J4=(We,de)=>{this.Aij(de.nl.kb)};this.I4=(We,de)=>{We=de.Xqa;for(var vl in We){const Um=We[vl];this.Ma.$("CashTelemetryIsEnabled")&&this.IKc(Um,new Date,null);Um.ip?this.ZYe(Um):this.j4c(Um.user.clientId)}de=de.EId;for(vl=0;vl<
de.length;++vl)this.Sjl(de[vl]);this.lde()};this.fVf=(We,de)=>{de.paragraphId?this.WWo(de.paragraphId.toString(),de.oYm,this.Kqd):k.ULS.shipAssertTag(8758481,302,!1,"null paraid")};this.r2i=(We,de)=>{de.paragraphId&&(We=this.FF.Db(de.paragraphId))&&((Object(xl.a)(Pk,de.presence)?this.wBe(We):this.xBe(We))===de.presence.ip.BGa&&this.bao(de.paragraphId),this.I5d&&this.HFn(de))};this.$v=Da;this.ib=Mc;this.vD=$c;this.vwb=$d;this.tl=Wc;this.d1j=Ng;this.Hbb=Re;this.FF=oc;this.TWg=Ah;this.wBe=hi;this.xBe=
Sj;this.iUj=jc;this.g1j=$e;this.oLa=al;this.Vp=fj;this.Gc=yk;this.Hb=dn;this.jih=sf;this.Wfk=ke;this.MNe=nm;this.Ma=Lg;this.mqd=pb;bg.rrd=new $b.a;for(Da=0;Da<this.mqd.length;Da++)this.mqd[Da].UVn(this);this.vwb.oqh(this.r2i);this.$v.aZa(this.I4);ne&&this.tl.Kla(this.iyn);this.$v.Cce(this)}get I5d(){return!!this.Ma&&this.Ma.$("PeoplesWellExtraButtonInfoIsEnabled")}lde(Da=!1){this.jih&&!Da||this.bbj()}bbj(){const Da=new P.a,pb=this.Kqd;for(const oc in pb)Da.add(cf.a.Ff(oc));this.z3h(Da);this.Kqd={}}S9f(){this.ib.gb&&
this.Aij(this.ib.gb.kb,!0)}Aij(Da,pb=!1){this.Wfk||(this.FF.jm.Nwa||pb?Da?(pb=this.jcl(Da))?this.$v.$9f(pb):(this.$v.$9f(null),k.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",Da.Oa.contextId)):this.$v.$9f(null):this.gRe=!0)}jcl(Da){if(!this.I5d||!Da.okb)if(Da=am.SelectionEditor.xj(Da,!0,!1),!am.SelectionEditor.km(Da))return null;return this.cyh(Da)}cyh(Da){const pb=Da.Oa.cpBegin,oc=Da.Oa.node.id;Da=this.wBe(Da.Oa.node);return new Ck(oc.toString(),pb,Da)}IKc(Da,pb,oc){if(this.MNe)if(Da&&
Da.user&&Da.user.clientId){var Mc=Da.user.clientId;this.abh.contains(Mc)||(this.LNe?(this.LNe.IKc(Mc,pb,null,bg.W$l(oc||Da.user.client)),this.abh.add(Mc)):this.MNe.continueWith(()=>{this.LNe=this.MNe.result;this.IKc(Da,pb,oc)}))}else k.ULS.sendTraceTag(42262876,302,15,"invalid presence")}e8l(Da){const pb=new P.a;for(let oc=0;oc<Da.length;oc++)pb.add(this.nhm(Da[oc]));return pb}ZYe(Da){var pb=null;Da&&Da.user&&(pb=Da.user.client);Da=Da.clone();Da.user=this.vD.YKf(Da.user.clientId)||Da.user;this.Ma.$("CashTelemetryIsEnabled")&&
this.IKc(Da,new Date,pb);Da.isValid()&&!Da.user.pU()&&(pb=Da.user.clientId,bg.rrd.nb(pb)||this.zki(pb),this.KWo(pb),Da.user.userName=CommonUIStrings.l_AnonymousUserName);this.vwb.fZe(Da,!1)}KWo(Da){const {value:pb}=bg.rrd.Dc(Da,!1);pb||(bg.rrd.Z(Da,!0),k.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+Da+'" , "Event" : "CreateAnonymousGrayPawn"}'))}zki(){}j4c(Da){this.vwb.D$i(Da)}Sjl(Da){this.j4c(Da);const pb=this.Hbb.H$h(Da);pb&&(pb.gaj(this.fVf),pb.dispose());this.I5d&&(Da=this.Hbb.cZl(Da))&&
(Da.gaj(this.fVf),Da.dispose())}Y7b(Da){if(12!==Da.type)return new P.a;Da=this.vwb.YMc(Da.id.toString(),this.wBe(Da),this.xBe(Da));return 0>=Da.length?new P.a:this.e8l(Da)}WWo(Da,pb,oc){!pb&&Da in oc&&delete oc[Da]}dispose(){this.stop();this.vwb.Maj(this.r2i);this.$v.SMb(this.I4);this.$v.qlg(this);for(let Da=0;Da<this.mqd.length;Da++)this.mqd[Da].NQo(this);Id.a.G8f([this.iUj,this.g1j,this.$v]);this.Hbb.wol()}nhm(Da){let pb=!1;Da=({foe:pb}=this.Hbb.c8l(Da)).returnValue;pb||Da.awk(this.fVf);return Da}Gii(Da){Da=
this.FF.Db(Da);if(!Da)return this.wMa[0]||(k.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.wMa[0]=!0),null;if(!Fb.ParagraphReader.Vb(Da))return this.wMa[1]||(k.ULS.sendTraceTag(4281421,302,50,"Not a paragraph node"),this.wMa[1]=!0),null;if(!Da.De(this.tl.ic))return this.wMa[2]||(k.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.wMa[2]=!0),null;if(!Da.anchor)return this.wMa[3]||(k.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.wMa[3]=
!0),null;this.wMa[4]||(k.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.wMa[4]=!0);return Da}i$i(Da){Da=this.vwb.YMc(Da.toString(),-1,-1,!0);if(!Se.a.jf(Da))for(const pb of Da)(Da=this.Hbb.H$h(pb.user.clientId))&&Da.element&&Da.CY()}z3h(Da){if(Da.count){var pb=new P.a;for(var oc of Da)(Da=this.Gii(oc))?pb.add(Da):this.i$i(oc);if(pb.count){oc=this.Gc.Oc(2);try{oc.set(this.Vp);for(const Mc of pb)this.BSh(Mc)}finally{oc&&oc.dispose()}}}}BSh(Da){Da.rJ(this.tl.ic,32,
!0);Da.rJ(this.d1j,32,!0)}bao(Da){this.Kqd[Da.toString()]=null;this.jih&&!this.hGe&&(Da=new ha.a(0,1,200,()=>{this.hGe=!1;this.bbj()},70),this.Hb.Wb(Da),this.hGe=!0)}HFn(Da){if(Da.presence.ip.shapeId&&!Da.pBf){var pb=this.Hbb.KNh[Da.presence.ip.shapeId.toString()];pb&&pb.F5a(Da.presence.user.clientId)}}stop(){this._started&&(this._started=!1,this.ib.DY(this.J4),this.TWg.Gaj(this.fUi))}start(){if(!this._started){this._started=!0;this.ib.Pw(this.J4);this.TWg.f_e(this.fUi);var Da=this.$v.BDb();delete Da[this.oLa.clientId];
this.I4(null,new $k.a(Da,[]));this.S9f()}}Aie(Da){if(Da&&Da.isValid()&&Da.ip){var pb=this.vwb.YMc(Da.ip.paragraphId.toString(),-1,-1),oc=!1,Mc=null;for(let $c=0;$c<pb.length;$c++)if(Mc=pb[$c],Mc.user.clientId===Da.user.clientId){oc=Mc.lTa=!0;break}if(oc)if(pb=Mc.ip.paragraphId,Da=this.Gii(pb)){pb=this.Gc.Oc(2);try{pb.Cb(Da),this.BSh(Da)}finally{pb&&pb.dispose()}}else this.i$i(pb)}}static W$l(Da){return Da?Da?1===Da?1:2===Da?2:0:2:0}}bg.rrd=null;Object(l.a)(bg,"PresenceManager",null,[1520,10,218,1521,
1522,1523]);class Hd{constructor(Da,pb,oc,Mc){this.BTb=null;this._started=this.IEe=!1;this.wyb=null;this.opa=($c,$d)=>{if(!n.AFrameworkApplication.Lk&&($c=this.CFj($d.nl),this.BTb&&$c)){$c=this.jxe.YMc(this.BTb.toString(),-1,-1,!0);for($d=0;$d<$c.length;$d++)this.wyb[$c[$d].user.clientId]=$c[$d];0>=$c.length||($c=this.N9k($c),this.Rp.sendNotification($c,!0))}};this.TVi=($c,$d)=>{this.ib.gb&&!n.AFrameworkApplication.Lk&&this.IEe&&this.BTb&&this.BTb.equals($d.paragraphId)&&($c=null,!$d.pBf||$d.presence.user.clientId in
this.wyb?$d.pBf||($c=this.bMh($d.presence.user.userName,!1),delete this.wyb[$d.presence.user.clientId]):($c=this.bMh($d.presence.user.userName,!0),this.wyb[$d.presence.user.clientId]=$d.presence),$c&&this.Rp.sendNotification($c,!0))};this.fj=Mc;this.ib=pb;this.jxe=Da;this.Rp=oc;this.fj.Cce(this)}start(){this._started||(this._started=!0,this.wyb={},this.jxe.oqh(this.TVi),this.ib.Pw(this.opa),this.CFj(this.ib.gb))}stop(){this._started&&(this._started=!1,this.wyb=null,this.jxe.Maj(this.TVi),this.ib.DY(this.opa))}N9k(Da){if(1===
Da.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,Da[0].user.userName);const pb=[],oc=Da.length;for(let Mc=0;Mc<oc;Mc++)pb.push(Da[Mc].user.userName);return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,pb.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}bMh(Da,pb){return String.format(pb?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,Da)}dispose(){this.fj.qlg(this);this.stop()}CFj(Da){if(!Da)return!1;
Da=Da.kb;if(!Da)return!1;Da=Da.Oa;if(!Da)return!1;this.IEe=am.SelectionEditor.gf(Da);Da=Da.node.id;if(Da.equals(this.BTb)||!this.IEe)return!1;this.BTb=Da;this.wyb={};return!0}}Object(l.a)(Hd,"PresenceAccessibilityManager",null,[10,218]);class zd{constructor(Da,pb){this._started=!1;this.kK=null;this.xld=!1;this.x_c=()=>{this._started&&this.kij()};this.fj=Da;pb&&(this.kK=pb,this.kK.rdb(this.x_c));this.fj.Cce(this)}start(){this._started||(this._started=!0,this.kK?this.kij():this.fj.aN(1,this.IKh()))}kij(){const Da=
this.xld;(this.xld=!!this.kK.Kx)&&!Da&&this.fj.aN(1,this.IKh())}IKh(){const Da={};Da.Id="{"+n.AFrameworkApplication.userSessionId.toUpperCase()+"}";Da.HQ=!1;Da.NT=1;Da.WEB=!0;return Da}stop(){this._started&&(this._started=this.xld=!1)}dispose(){this.fj.qlg(this);this.kK&&this.kK.iaj(this.x_c)}}Object(l.a)(zd,"EditorsTableNotifier",null,[10,218]);var vf=c(369),cg=c(16);class og extends bg{constructor(Da,pb,oc,Mc,$c,$d,jc,$e,Wc,Ng,Re,Ah,hi,Sj,al,fj,yk,dn,Ji,nm,Lg,sf,ne,ke,We,de,vl,Um,Th,Gk,Ye){super(Da,
pb,oc,Mc,$c,$d,jc,$e,Wc,Ng,Re,hi,Sj,al,fj,Ji,nm,Lg,sf,ne,ke,We,de,Th);this.Nk=null;this.qsl=rf=>{const Dp=!!this.Nk.YB.e7b(rf);k.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",rf,Dp)};this.psl=(rf,Dp)=>{k.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",Dp,rf)};this.aia=()=>{if(2===og.fj.connectionState&&!Ja.SessionStatusManager.instance.cca){const rf={};rf.qs=n.AFrameworkApplication.rootQuerySignature;og.fj.gqb(rf)}};Ah.fb(cg.a.fwo,
Ya.a.application,og.ztk,64);Ah.fb(cg.a.f5f,Ya.a.application,og.f5f,64);Ah.fb(cg.a.Q1f,Ya.a.application,og.Q1f,96);Ah.fb(Sa.a.Aie,Ya.a.application,og.ewo,64);this.CI=yk;this.ud=dn;this.Myb=vl;this.oLa.agc=Um;this.oLa.agc.gyk(og.UVi);Gk.continueWith(()=>{this.Nk=Gk.result});k.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized");(this.G2=Ye)&&this.G2.execute(rf=>{rf.YYa(this.aia)})}rEa(Da){if(!Da||!Da.anchor)return null;for(Da=Da.anchor.eq;Da;Da=Da.HA)if(Da.oFa)return Da.vr.node;return null}cyh(Da){var pb=
null;pb=n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled");var oc=Da.Oa.cpBegin,Mc=Da.Oa.node;pb&&kl.ImageReader.Eu(Mc)&&(Mc=this.rEa(Mc));if(!Mc)return k.ULS.sendTraceTag(51242309,302,15,"selectedNode is null"),null;Mc=this.xBe(Mc);const $c=Da.Oa.node.ia(ud.a.Lc,0);if(!this.CI)return k.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var $d=this.CI.value.Ihb($c);const jc=og.kH.Db($d);if(!jc)return k.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+$d),null;
oc=this.ud.mnc(this.ud.MRa(jc.characterData,jc.pa),oc);oc.rua=-1===Da.Oa.Eb?0:Da.Oa.Eb;$d=0;pb&&Da.okb&&($d=this.Gbm(Da));return pb=new zf(this.CI.value,$c,Mc,oc,this.ud,()=>og.kH,this.Myb,$d)}Gbm(Da){const pb=kl.ImageReader.kEa(Da.Oa);return pb?pb.properties.ia(ud.a.qCb,0):Da.Oa.node.properties.ia(ud.a.qCb,0)}zki(Da){this.Nk&&this.Nk.Vma&&this.Nk.Vma.aF(this.qsl,this.psl,Da)}dispose(){this.G2&&this.G2.execute(Da=>{Da.RMb(this.aia)});super.dispose()}static get uu(){return Ka.a.instance.resolve("Common.Utils.IAriaNotifier")}static OD(){return og.Kuc.task}static get_instance(){return og.qrd.task}static j8l(){return og.Bah.task}static get cqa(){return null!=
og.NFg?og.NFg:og.NFg=Ka.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){og.qrd||(og.qrd=new x.a);og.hVg&&(k.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),og.hVg=!1);if(Ga.App.xa){var Da=Ga.App.xa.hb;Da?(Da.ifa(og.g_c),og.wyc=Da.rc,Da.Boa()?(og.GN=Da.Uc.contentReplicator,og.GN?(og.kH=Da.Uc.od,og.kH?og.cqa.OD().continueWith(og.tsn):k.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):
k.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):k.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):k.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else k.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static tsn(){og.fj=
og.cqa.OD().result;if(og.fj){var Da=[og.wyc.r0c,og.wyc.editingView.r0c],pb=Ab.a.instance,oc=Ka.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),Mc=new Hd(oc,pb,og.uu,og.fj),$c=n.AFrameworkApplication.K.$("DoNotAddToEditorsTableOnFrameIsEnabled")?Ga.App.qd.YB:null;$c=new zd(og.fj,$c);var $d=Ka.a.instance.Ue("WordEditor.IParagraphWordIdMapping"),jc=Ka.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),$e=Ka.a.instance.resolve("Common.IPeopleInfoProvider");
og._instance=new og(og.fj,Da,og.kH,pb,$e,oc,Mc,$c,og.wyc,og.wyc.editingView.ic,Ka.a.instance.resolve("Box4.Presence.PresenceControlProvider"),n.AFrameworkApplication.va,og.GN,Fb.ParagraphReader.textLength,Fb.ParagraphReader.Wma,Ka.a.instance.resolve("Box4.Presence.MyPresenceUser"),$d,jc,Ga.App.Tj.zl,new vf.a,cc.a.instance,gm.a.get_instance(),Na.a.Bp(Ka.a.instance.Sa("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),n.AFrameworkApplication.K,n.AFrameworkApplication.K.$("Box4ThrottleAndBatchPresenceRendering"),
n.AFrameworkApplication.K.$("Box4DoNotRenderPresenceOutOfView"),Ka.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),Ka.a.instance.resolve("Common.IPresenceStatusProvider"),!Ga.App.hs&&!Ga.App.vm,Ga.App.Pna(),Ka.a.instance.Sa("Common.ISessionExpirationManager"));k.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");og.qrd.zg(og._instance);og.Kuc.zg(og._instance);og.Bah.zg(og._instance);Da=Ka.a.instance;Da.ha("WordEditor.Presence.WordPresenceManager",()=>og._instance).as("Common.IPresenceRemover").as("Common.IPresenceSender").singleInstance();
Da.resolve("WordEditor.Presence.WordPresenceManager")}else k.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static g_c(Da){og._instance||(k.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(Da=Object(y.a)(13,Da))&&Da.ynb(og.g_c),og.init())}static UVi(){og._instance.S9f()}static ztk(Da,pb,oc,Mc,$c){oc=$c.split(",");if(!oc||3!==oc.length)return 8;Da=oc[0].trim();pb=oc[1].trim();oc=
Number.parseInvariant(oc[2].trim());Da=new Pk(new fb(Da),new Ck(pb,oc,-1));if(!og.Kuc.task.isCompleted)return 8;pb=og.OD().result;pb.ZYe(Da);pb.lde();return 32}static f5f(Da,pb,oc,Mc,$c){if(!og.Kuc.task.isCompleted)return 8;Da=og.OD().result;Da.j4c($c);Da.lde();return 32}static ewo(Da,pb,oc,Mc,$c){if(!og.Kuc.task.isCompleted)return 8;Da=og.OD().result;if(!Da)return 8;Da.Aie($c);return 32}static Q1f(Da,pb,oc,Mc,$c){if(1===oc)return 32;if(!og.cqa.OD().isCompleted)return 8;Da=og.cqa.OD().result;if(!Da)return k.ULS.sendTraceTag(4301136,
302,10,"rtcProxy is null when trying to display RTC connection status"),8;$c[kg.a.Value]=2===Da.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===Da.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:"";return 32}}og._instance=null;og.hVg=!0;og.qrd=new x.a;og.Kuc=new x.a;og.Bah=new x.a;og.kH=null;og.wyc=null;og.GN=null;og.fj=null;Object(l.a)(og,"WordPresenceManager",bg,[]);class be{constructor(Da){this.ra=new xa.a;this.kZ=Da;this.kZ.CWR(()=>this.kZ.result.cwk(()=>{this.ra.raiseEvent("X")}))}gyk(Da){this.ra.addHandler("X",
Da)}N0n(Da){this.ra.removeHandler("X",Da)}getStatus(){return this.kZ.isCompleted&&this.kZ.result?this.kZ.result.lHd.toString():"0"}}Object(l.a)(be,"WordPresenceStatusProvider",null,[228]);class jd{constructor(Da,pb,oc,Mc){this.fj=null;this.$Ug=this.bJe=!1;this.usn=()=>{this.GZ.isCompleted&&this.GZ.result?(this.fj=this.GZ.result,this.fj.aZa(this.I4),k.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):k.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")};
this.I4=($c,$d)=>{$c=$d.Xqa;for(const jc in $c)if($d=$c[jc],!this.bJe&&$d.user.cP&&$d.user.cP!==this.w2.cP){k.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",this.w2.cP,$d.user.cP);this.bJe=!0;break}this.bJe&&this.fj.SMb(this.I4);this.$Ug||(k.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.$Ug=!0)};this.Nk=Da;this.w2=pb;this.GZ=oc;oc.continueWith(this.usn);this.Pak=Mc;this.Pak.JJf=this.w2}}Object(l.a)(jd,"WordPresenceUpdateMonitor",
null,[]);var ak=c(412),sh=c(1536),pg=c(223),ul=c(1867),jh=c(1868),ag=c(1753);class Uf{constructor(Da,pb,oc,Mc,$c,$d,jc){this.ra=new xa.a;this.C0g=this.r2g=this.eHe=this.a5g=!1;this.jWe=this.gxd=0;this.q_b=null;this.oLa=$d;this.oLa.clientId=Da.clientId;this.Cl=Da;this.t$=pb;this.T$=Mc;this.Z2j=$c;this.Hb=oc;this.e$a=new pg.a;this.pn=jc;this.t$&&this.t$.continueWith(()=>{this.t$.zo||this.t$.Ci||this.t$.result.hph(Object(f.a)(this,this.lSi,"onAmIAloneChanged"))})}get connectionState(){return this.Cl.connectionState}aZa(Da){this.ra.addHandler("PU",
Da)}SMb(Da){this.ra.removeHandler("PU",Da)}Fta(Da){this.ra.addHandler("CSC",Da)}$gc(Da){this.ra.removeHandler("CSC",Da)}MDc(Da){this.ra.addHandler("PSU",Da)}r4c(Da){this.ra.removeHandler("PSU",Da)}zzd(Da){this.ra.addHandler("PSC",Da)}gde(Da){this.ra.removeHandler("PSC",Da)}vij(){}get clientId(){return this.Cl.clientId}c3(Da){this.ra.addHandler("UN",Da)}TMb(Da){this.ra.removeHandler("UN",Da)}gxm(){this.q_b=Array(12);for(let Da=0;12>Da;Da++)this.q_b[Da]=0;this.r2g=this.pn?this.pn.$("UpdateNotificationTaskExperimentIsEnabled"):
!0;n.AFrameworkApplication.dI(()=>{this.e7m()})}init(){this.Cl.Fta(Object(f.a)(this,this.Vha,"onConnectionStateChanged"));this.Cl.aZa(Object(f.a)(this,this.I4,"onPresenceUpdated"));this.Cl.MDc(Object(f.a)(this,this.ARa,"onPersistentStateUpdated"));this.Cl.zzd(Object(f.a)(this,this.Gec,"onPersistentStateCleared"));this.Cl.c3(Object(f.a)(this,this.x0,"onUpdateNotificationReceived"));this.WGh();this.gxm()}Cce(Da){this.e$a.contains(Da,(pb,oc)=>pb===oc)||(this.e$a.add(Da),2===this.connectionState&&Da.start())}qlg(Da){for(let pb=
0;pb<this.e$a.length;pb++)if(this.e$a.J(pb)===Da){this.e$a.lG(pb);break}}connect(){this.eHe||this.Cl.connect()}disconnect(){this.Cl.disconnect()}get xee(){return this.Cl}pQh(Da){return Pk.jBb(Da)}p$f(Da,pb){return(new Pk(Da,pb)).Jtf()}$9f(Da){Da&&Da.isValid()&&!this.T$()?this.Cl.vij(this.p$f(this.oLa.e3l(),Da)):F.Task.M3(null)}lic(Da,pb){return this.Cl.lic(Da,pb)}P6b(Da){return this.Cl.P6b(Da)}$Mc(){return this.Cl.$Mc()}aN(Da,pb,oc=!1){return this.Cl.aN(Da,pb,oc)}BDb(){return this.zKh(this.Cl.BDb())}gqb(Da){const pb=
new x.a;ag.a.getInstance().T5i(Da,pb);return pb.task}get VQa(){return this.Cl.VQa}Vha(Da,pb){2===pb.newState&&this.e$a.forEach(oc=>{oc.start();return!0});pb.newState||this.pn.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&!this.eHe||this.e$a.forEach(oc=>{oc.stop();return!0});this.ra.raiseEvent("CSC",pb)}Akf(Da){return Da.toLowerCase()}I4(Da,pb){if(!this.T$()){Da=this.zKh(pb.Xqa);pb=this.BKh(pb.EId);var oc=new $k.a(Da,pb);pb=new ha.a(0,1,0,()=>{this.ra.raiseEvent("PU",oc)},57);this.Hb.Wb(pb)}}zKh(Da){const pb=
{};for(const Mc in Da){var oc=Mc;const $c=this.pQh(Da[Mc]);$c&&$c.isValid()?pb[this.Akf(oc)]=$c:k.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",oc)}return pb}BKh(Da){const pb=Array(Da.length);for(let oc=0;oc<Da.length;oc++)pb[oc]=this.Akf(Da[oc]);return pb}ARa(Da,pb){if(!this.T$()){var oc={};Da=pb.Xqa;for(var Mc in Da)oc[this.Akf(Mc)]=Da[Mc];Mc=new ha.a(0,1,0,()=>{this.ra.raiseEvent("PSU",new ul.a(pb.type,oc))},80);this.Hb.Wb(Mc)}}Gec(Da,pb){if(!this.T$()){Da=this.BKh(pb.LDd);var oc=new jh.a(Da);
Da=new ha.a(0,1,0,()=>{this.ra.raiseEvent("PSC",oc)},81);this.Hb.Wb(Da)}}x0(Da,pb){this.r2g?this.SXi(pb):(Da=new ha.a(0,1,0,()=>{this.SXi(pb)},58),this.Hb.Wb(Da))}SXi(Da){var pb=Date.now();this.ra.raiseEvent("UN",Da);pb=Date.now()-pb;500<=pb&&(this.gxd++,k.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",Da.type,pb),this.kDl(Da));this.jWe++}kDl(Da){0>Da.type||21<=Da.type?k.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",
Da.type):this.q_b[Da.type]++}e7m(){if(!this.C0g){var Da={};Da.TC=this.jWe;Da.HRC=this.gxd;this.q_b&&0<this.gxd&&(Da.TBC=this.q_b);this.gxd=this.jWe=0;this.q_b=null;k.ULS.sendTraceTag(42541603,302,50,"UpdateNotificationHeuristics: {0}",Da);this.C0g=!0}}dispose(){this.e$a=new pg.a;this.Cl.$gc(Object(f.a)(this,this.Vha,"onConnectionStateChanged"));this.Cl.SMb(Object(f.a)(this,this.I4,"onPresenceUpdated"));this.Cl.r4c(Object(f.a)(this,this.ARa,"onPersistentStateUpdated"));this.Cl.gde(Object(f.a)(this,
this.Gec,"onPersistentStateCleared"));this.Cl.TMb(Object(f.a)(this,this.x0,"onUpdateNotificationReceived"));this.t$&&this.t$.continueWith(()=>{this.t$.zo||this.t$.Ci||this.t$.result.K_n(Object(f.a)(this,this.lSi,"onAmIAloneChanged"))});this.Cl.disconnect();k.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}lSi(){this.WGh()}WGh(){let Da=!1;this.t$?this.t$.continueWith(()=>{this.t$.zo||this.t$.Ci||(Da=!this.t$.result.amIAlone);this.Cl.connectionState||!Da&&!this.Z2j()?2!==this.Cl.connectionState||
Da||(this.disconnect(),k.ULS.sendTraceTag(4564937,302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),k.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));!this.a5g&&Da&&(k.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.a5g=!0)}):(this.connect(),k.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}CJc(){this.eHe=!0;this.disconnect();k.ULS.sendTraceTag(4564938,
302,50,"DisconnectForever")}}Object(l.a)(Uf,"RtcProxy",null,[1502,10,1212,1503]);class Dk extends Uf{constructor(Da,pb,oc,Mc,$c,$d,jc,$e,Wc,Ng,Re,Ah,hi){super(Da,pb,oc,Mc,$c,$d,hi);this.Sea=null;this.CI=jc;this.ud=$e;this.vLa=Wc;this.pyc=Ng;this.YSe=Re;this.Myb=Ah}get RJ(){return this.Sea||(this.Sea=this.YSe())}Vha(Da,pb){2===pb.newState&&k.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.lXo();super.Vha(Da,pb)}lXo(){this.RJ&&this.RJ.RU("RtcConnectionStatusLabel")}pQh(Da){return uc.iaf(Gc(Da),
this.CI,this.ud,this.vLa,this.Myb)}p$f(Da,pb){return Object(xl.a)(zf,pb)?(Da=new uc(this.pyc.ybi(),Da,pb),ie(Da.Jtf())):super.p$f(Da,pb)}}Object(l.a)(Dk,"WordRtcProxy",Uf,[]);class ve{constructor(Da,pb,oc,Mc,$c,$d,jc,$e,Wc,Ng,Re,Ah,hi){this.Xp=new x.a;this.Kfh=!0;this.ge=pb;this.Hb=oc;this.T$=Mc;this.oLa=$c;this.CI=$d;this.uta=jc;this.vLa=$e;this.pyc=Wc;this.YSe=Ng;this.G2=Re;this.Myb=Ah;this.Ma=hi}OD(){this.RMo();return this.Xp.task}sOc(){return ak.a.then(this.OD(),Da=>Da)}RMo(){if(this.Kfh)if(this.Kfh=
!1,Ga.App.UFf()&&Ga.App.UDf()){var Da=n.AFrameworkApplication.Ne;if(Da){Da=sh.RealtimeChannel.createInstance("{"+n.AFrameworkApplication.userSessionId+"}",n.AFrameworkApplication.userSessionId,n.AFrameworkApplication.kfj,Da,this.G2,1,this.ge,this.Ma.jb("RtcEndpointUrl"),void 0,void 0,null,this.Ma.$("FindSessionOnBootIsEnabled")?Ka.a.instance.resolve("Common.IFindSessionUtils"):null,this.Ma.jb("RtcBootToken"));var pb=this.Ma.$("RtcAlwaysOnEnabled"),oc=new Dk(Da,pb?null:Ga.App.Pna(),this.Hb,this.T$,
ve.AGl,this.oLa,this.CI,this.uta,this.vLa,this.pyc,this.YSe,this.Myb,n.AFrameworkApplication.K);Ga.App.dlo(oc);this.LVn(oc);oc.init();Zi.App.b6a=oc;this.G2.execute(Mc=>{Mc.tdb(()=>{oc.CJc()})});this.Xp.zg(oc)}else k.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else k.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}LVn(Da){const pb=Ka.a.instance;pb.ha("WordEditor.Presence.WordRtcProxy",
()=>Da).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").singleInstance();pb.resolve("Common.IRealtimeChannelBasic")}static AGl(){return!1}}Object(l.a)(ve,"WordRtcProxyProvider",null,[226,227]);class Hf{constructor(){this.W=null;this.$l=!1}get name(){return"WordEditor.Presence"}init(){k.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");Ga.App.IKj&&(this.W.resolve("WordEditor.Presence.WordRtcProxyProvider").OD(),og.init(),this.W.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));
Ga.App.tHc&&Kh.init();this.W.resolve("Common.App.Presence.AwayManager");this.W.resolve("Common.IPeopleInfoProvider");if(Hf.q0g){const Da=this.W.resolve("WordEditor.IMainViewModeManager");Da.gzb(this.mWf);Hf.MFe=1===Da.Wu}}dispose(){if(!this.$l){this.$l=!0;og.OD().continueWith(()=>{Id.a.VB(og.OD().result)});var Da=this.W.resolve("Box4.Presence.MyPresenceUser");Da&&Da.agc&&Da.agc.N0n(og.UVi)}}xc(Da){this.W=Da;this.W.ha("Box4.Presence.MyPresenceUser",()=>new lb).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").singleInstance();
Da.ha("WordEditor.Presence.IWordPresenceCpFactory",()=>new tl(Da.resolve("Box4.CpConversionManagerImpl"),Da.resolve("Box4.IContentControlReader"))).singleInstance();Da.ha("WordEditor.Presence.WordPresenceUpdateMonitor",()=>new jd(new X.a(()=>Ga.App.qd),xf.a.instance,Da.resolve("WordEditor.Presence.WordRtcProxyProvider").sOc(),Da.resolve("Box4.Presence.IMyPresenceUser"))).singleInstance();Da.ha("WordEditor.Presence.WordRtcProxyProvider",()=>new ve(n.AFrameworkApplication.buildVersion,Ga.App.xa.Gq,
cc.a.instance,()=>n.AFrameworkApplication.Lk,Ka.a.instance.resolve("Box4.Presence.IMyPresenceUser"),Ka.a.instance.Na("WordEditor.ParagraphWordIdMapping"),Ka.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),()=>n.AFrameworkApplication.ta&&Ga.App.xa.hb&&Ga.App.xa.hb.Uc?Ga.App.xa.hb.Uc.od:null,Tg.instance,()=>Ka.a.instance.Na("WordEditor.IStatusBarUser"),Ka.a.instance.Sa("Common.ISessionExpirationManager"),Ka.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),
n.AFrameworkApplication.K)).singleInstance().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");Da.ha("Box4.Presence.PresenceControlProvider",()=>new em(Hf.fel(),Kd.a.instance,Ka.a.instance.Sa("Common.IZoomManager"),Ka.a.instance.resolve("Box4.ICoauthCashTelemetry"),Na.a.Bp(Ka.a.instance.Sa("Common.ISystemInitiatedFeedbackWithTimeLapse")),n.AFrameworkApplication.K,Da.resolve("Common.IPeopleInfoProvider"))).singleInstance();Da.ha("Common.App.Presence.AwayManager",()=>new af(Ka.a.instance.resolve("Common.IPresenceUser"),
Ka.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").sOc(),og.j8l(),Ka.a.instance.resolve("Common.IPresenceConverter"),cc.a.instance,n.AFrameworkApplication.K.$("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:n.AFrameworkApplication.K.mc("AwayCoauthorThresholdMs",9E5),Object(f.a)(n.AFrameworkApplication.va,n.AFrameworkApplication.va.processAction,"processAction"),Ga.App.xa.notificationBar,n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"))).singleInstance();Da.ha("WordEditor.Presence.WordPresenceStatusProvider",
()=>new be(Na.a.Bp(Ka.a.instance.Sa("Common.ICurrentPageCalculator")))).as("Common.IPresenceStatusProvider").singleInstance();Da.ha("Common.App.Presence.PeopleInfoProvider",()=>new ec(Da.resolve("WordEditor.Presence.WordRtcProxyProvider").sOc(),Ga.App.Pna().CWR(()=>Ga.App.Pna().result.YB),Da.resolve("Common.App.People.IPeopleColorUtils"),Da.resolve("Common.IPresenceConverter"),Na.a.Bp(Da.Sa("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").singleInstance();Da.ha("Box4.Presence.WordPresenceDataManager",
()=>new fm(Ga.App.xa.hb.Uc.od)).as("Box4.IPresenceDataManager").singleInstance()}mWf(Da,pb){Ga.App.xa&&Ga.App.xa.lD&&(Hf.jqd=null,Hf.MFe=1===pb.Alb)}static get TYi(){if(!Hf.jqd&&Ga.App.xa&&Ga.App.xa.lD){const Da=Zi.App.un.lD;Hf.jqd=Hf.MFe&&Hf.q0g?Da.getElementsByClassName("PaginatedContentContainerDisplayWrapper")[0]:Da.getElementsByClassName("OutlineContainerDisplayWrapper")[0]}return Hf.jqd}static fel(){const Da=n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"),pb=n.AFrameworkApplication.K.$("PresenceIgnoreEventOnExpandedTooltip"),
oc=n.AFrameworkApplication.K.$("PresenceIpWidthAdjustForFlyout"),Mc=new Vc;Mc.add(Bc.multipleBrowsersImageClassName,oe.getImageClassWithCluster(n.AFrameworkApplication.Pba,"MoreUsersGlyph16"));Mc.add(Bc.multipleBrowserImageClusterPath,n.AFrameworkApplication.Vs);Mc.add(Bc.peopleImageClassName,oe.getImageClassWithCluster(n.AFrameworkApplication.Pba,Da?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));Mc.add(Bc.peopleImageClusterPath,n.AFrameworkApplication.Vs);Mc.add(Bc.zIndex,1);Mc.add(Bc.rtl,
n.AFrameworkApplication.isRtl);Mc.add(Bc.viewportBoundsCallback,Hf.Zhm);Mc.add(Bc.ignoreEventOnExpandedTooltip,pb);Mc.add(Bc.ipWidthAdjustForFlyout,oc);return Da?new Vg(Mc):new rm(Mc)}static Zhm(){return Hf.TYi?xb.a.getElementBounds(Hf.TYi):null}}Hf.MFe=!0;Hf.q0g=n.AFrameworkApplication.K.$("FlippedFlyoutForPaginationViewIsEnabled");Hf.jqd=null;Object(l.a)(Hf,"WordPresencePackage",null,[1,2]);var ej=c(1039),vj=c(1403),Xh=c(1045),dg=c(177);class ll{constructor(Da,pb){this.$Ye=Da;this.paragraphId=pb}get opType(){return 2}get operation(){return this.$Ye}}
Object(l.a)(ll,"RttAppliedAddParagraphOp",null,[271]);class gi{constructor(Da,pb){this.Q2n=Da;this.paragraphId=pb}get opType(){return 6}get operation(){return this.Q2n}}Object(l.a)(gi,"RttAppliedReplaceSymbolRangeOp",null,[271]);class Gm{constructor(Da,pb){this.U2n=Da;this.paragraphId=pb}get opType(){return 1}get operation(){return this.U2n}}Object(l.a)(Gm,"RttAppliedReplaceTextRangeOp",null,[271]);class An{constructor(Da,pb,oc){this.auj=Da;this.eje=pb;this.yIc=oc}get opType(){return 4}get operation(){return this.auj}get Ook(){return this.auj.H3b()?
this.yIc:this.eje}}Object(l.a)(An,"RttAppliedSplitParagraphOp",null,[271]);class qg{constructor(){this.a9a=new $b.a}AHf(Da){return Da.toString()}rDc(Da,pb){Da=this.AHf(Da);this.a9a.nb(Da)||this.a9a.Z(Da,new P.a);this.a9a.J(Da).add(pb)}OUf(Da){switch(Da.opType){case 1:var pb=Object(y.a)(Gm,Da);this.rDc(pb.paragraphId,Da);break;case 6:pb=Object(y.a)(gi,Da);this.rDc(pb.paragraphId,Da);break;case 4:pb=Object(y.a)(An,Da);this.rDc(pb.eje,Da);this.rDc(pb.yIc,Da);break;case 2:pb=Object(y.a)(ll,Da),this.rDc(pb.paragraphId,
Da)}}Tnn(Da){return this.Ylb(Da)}Ylb(Da){Da=this.AHf(Da);if(!this.a9a.nb(Da))return new P.a;const pb=this.a9a.J(Da);this.a9a.remove(Da);for(const oc of pb)oc.operation&&(oc.operation.p7=null);return pb}$4l(Da){let pb;return({value:pb}=this.a9a.Dc(this.AHf(Da),pb)).returnValue?pb:new P.a}BKl(Da){for(const pb of this.a9a.values){if(!pb.count)continue;if(2!==pb.J(0).opType)continue;const oc=pb.J(0);if(oc.$Ye.AQf===Da)return oc}return null}}Object(l.a)(qg,"RttAppliedOpTracker",null,[265]);var xk=c(244),
Gj;(function(Da){Da[Da.Qxl=0]="expired";Da[Da.Hdp=1]="dried"})(Gj||(Gj={}));Object(l.b)("RemoveChangeReason",Gj);class Of{constructor(){this.tza=new xk.a}Aqk(Da){if(!Da)return k.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const pb=Da.Lc,oc=Da.sj;this.tza.nb(pb)||this.tza.add(pb,new xk.a);this.tza.J(pb).Z(oc,Da);return this.ngl(pb,oc)?(k.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",pb),this.tza.J(pb).remove(oc),
!1):!0}Rrf(Da,pb){if(!this.tza.nb(Da))return null;Da=this.tza.J(Da);return Da.nb(pb)?Da.J(pb):null}FQd(Da){const pb=new P.a;for(const oc of this.tza.keys){const Mc=this.tza.J(oc);for(const $c of Mc.keys){const $d=Mc.J($c);Da($d)&&pb.add($d)}}return pb}w$i(Da,pb){let oc=null;({value:oc}=this.tza.Dc(Da.Lc,oc)).returnValue?(Da.activity.PSf(Gj[pb]),oc.remove(Da.sj),oc.count||this.tza.remove(Da.Lc)):k.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",
Da.Lc,pb)}N4f(Da){this.w$i(Da,1)}Q4f(Da){this.w$i(Da,0)}ngl(Da,pb){if(!this.tza.nb(Da))return!1;Da=this.tza.J(Da);if(!Da.nb(pb))return!1;for(var oc=Da.J(pb);oc;){oc=oc.d1;if(oc===pb)return!0;if(!Da.nb(oc))break;oc=Da.J(oc)}return!1}}Object(l.a)(Of,"RttDataStore",null,[262,263]);var hm=c(285),fe=c(103),Ti=c(273),Ek=c(15);class rg{constructor(Da,pb){this.G6d=(oc,Mc)=>{4===this.nq.opType?k.ULS.shipAssertTag(9204866,355,12===Mc.node.type||11===Mc.node.type,"Unexpected graph modification detected during RTT edit"):
k.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")};this.Ylb=()=>{k.ULS.shipAssertTag(9204868,355,!1,"Unexpected graph modification detected during RTT edit")};this.gUi=()=>{k.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")};this.nq=Da;if(this.lq=pb)Da=this.lq.Ye(12),Da.Vt(this.G6d),Da.Ow(this.Ylb),Da.Go(this.gUi)}dispose(){if(this.lq){const Da=this.lq.Ye(12);Da.VU(this.G6d);Da.Dia(this.Ylb);Da.WU(this.gUi)}}}Object(l.a)(rg,
"GraphChangeValidator",null,[10]);class Vf{constructor(Da,pb,oc,Mc){this.id=Da;this.cpBegin=pb;this.cpEnd=oc;this.fUk=Mc}X_o(Da){var pb=this.id===Da.id;pb&&(pb=this.fUk.replace("\u00a0"," "),Da=Da.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),pb=pb===Da);return pb}}Object(l.a)(Vf,"RttOpValidator",null,[288]);class lh{constructor(Da,pb){this.p7=this.d8a=this.activity=null;this.opType=Da;this.metadata=pb}Guf(){return""}serialize(){return null}}Object(l.a)(lh,"RttOp",
null,[225]);class qj extends lh{constructor(Da,pb,oc,Mc,$c,$d,jc,$e,Wc){super(Wc,$e);this.Lc=Da;this.sj=pb;this.xR=oc;this.C4=Mc;this.d1=$c;this.Fpb=$d;this.DH=jc}wMh(){return this.xR.isEqual(this.C4,!0)?new Ie.a(0,this.Lc,this.sj,this.xR,void 0,void 0,void 0,this.DH):new Ie.a(1,this.Lc,this.sj,this.xR,this.Lc,this.sj,this.C4,this.DH)}static vBj(Da){let pb,oc;var Mc=Da.iT;if(1===Mc.dce&&(Mc.KRa!==Mc.yGa||Mc.n7a!==Mc.alc))return k.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),
oc=pb=null,Da=Mc=-1,{returnValue:!1,xR:oc,C4:pb,Lc:Da,sj:Mc};if(Mc.DH)return oc=pb=null,Da=Mc=-1,{returnValue:!1,xR:oc,C4:pb,Lc:Da,sj:Mc};pb=oc=Mc.xR;1===Mc.dce&&(pb=Mc.C4);Da=Mc.KRa;Mc=Mc.n7a;return{returnValue:!0,xR:oc,C4:pb,Lc:Da,sj:Mc}}}Object(l.a)(qj,"RttReplaceRangeOp",lh,[]);var lm=c(1401),Nd=c(382),Un=c(582);class Ad extends Un.a{constructor(){super();this.RttStatusRecords=this.FileId=null}al(){return 110}static Zaa(Da,pb){const oc=new Ad;oc.FileId=Da;oc.RttStatusRecords=pb;return oc}}Object(l.a)(Ad,
"RttStatusRequest",Un.a,[]);class ml{}Object(l.a)(ml,"RttStatusOp",null,[]);class Pf{constructor(){this.contentState=this.contentType=this.timeToRender=this.strictlySequentialId=this.packetVersion=this.clientType=this.clientId=this.packetId=null}}Object(l.a)(Pf,"WireRttStatusOpRecord",null,[]);class sg extends Nd.a{constructor(){super();const {App:Da}=c(157);this.AYb=new P.a;this.nQe=new P.a;this.ek=new lm.a(n.AFrameworkApplication.K.mc("WordEditorRttStatusReplicatorIntervalMs",6E4));this.enabled=
1;Da.e1.register(this)}qRj(){const Da=Date.now();for(const pb of this.AYb)pb.MKb&&1===pb.MKb&&(pb.MKb=2,pb.timeToRender=Da-pb.metadata.Zig)}Bpe(Da){const pb=new ml;pb.metadata=Da.operation.metadata;pb.opType=Da.opType;pb.MKb=1;this.AYb.add(pb)}get Pha(){return"RttStatusReplicator"}V3(){return this.ee&&2===this.ee.status?!0:1===this.enabled&&this.ek.KX()?this.RD():!1}RD(){for(const Da of this.AYb)if(Da.MKb&&2===Da.MKb)return!0;return!1}wSa(){if(1===this._state){this._state=3;const pb=this.AYb.toArray().filter(oc=>
2===oc.MKb);var Da=this.m9k(pb);Da=Ad.Zaa(n.AFrameworkApplication.rootQuerySignature,Da);pb.forEach(oc=>this.AYb.remove(oc));pb.forEach(oc=>this.nQe.add(oc));this.ee.Dq=Da;this.ee.HG="RttStatusRequest";this.ee.status=1}else 3===this._state&&this.ee&&2===this.ee.status&&(this.ek.q1(),2!==this.ee.statusCode&&this.AYb.RC(0,this.nQe),this.nQe.clear(),this._state=1)}m9k(Da){const pb=[];Da.forEach(oc=>{const Mc=new Pf;Mc.clientId=oc.metadata.clientId;Mc.clientType=oc.metadata.clientType;Mc.packetId=oc.metadata.packetId;
Mc.packetVersion=oc.metadata.packetVersion;Mc.strictlySequentialId=oc.metadata.strictlySequentialId;Mc.contentType=oc.opType;Mc.contentState=oc.MKb;Mc.timeToRender=oc.timeToRender;pb.push(Mc)});return pb}rjc(){return!0}aF(){}forceOutbound(){}}Object(l.a)(sg,"RttStatusReplicator",Nd.a,[]);class cb{constructor(Da,pb,oc,Mc,$c,$d){this.packetId=Da;this.clientId=pb;this.clientType=oc;this.Zig=Mc;this.packetVersion=$c;this.strictlySequentialId=$d}static create(Da){let pb=null;null!=Da.strictlySequentialId&&
(pb=Da.strictlySequentialId);return new cb(Da.packetId,Da.clientId,Da.client,Date.now(),Da.version,pb)}}Object(l.a)(cb,"RttOpMetadata",null,[]);class Jb extends lh{constructor(Da,pb,oc,Mc,$c,$d,jc,$e,Wc){super(4,Wc);this.d1=0;this.Lc=Da;this.sj=pb;this.offset=oc;this.DH=Mc;this.gpg=$c;this.Fig=$d;this.ape=jc;this.Gig=$e;this.gpg===this.Lc?this.d1=this.Fig:this.ape===this.Lc?this.d1=this.Gig:(k.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.d1=0)}H3b(){return this.Lc===
this.ape}get yHo(){return this.d1}get y3o(){return this.H3b()?this.gpg:this.ape}get Xxj(){return this.H3b()?this.Fig:this.Gig}serialize(){const Da=new Ie.a(3,this.Lc,this.sj,this.offset,null,null,null,this.DH),pb=new Qc(this.gpg,this.Fig,this.ape,this.Gig);return new Mb(this.metadata.packetId,this.metadata.clientId,1,4,Da,null,void 0,void 0,void 0,void 0,pb,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){const pb=Da.iT,oc=Da.hPb;return new Jb(pb.KRa,pb.n7a,pb.xR,pb.DH,oc.wXf,oc.Eig,
oc.xXf,oc.Hig,cb.create(Da))}static eam(Da,pb,oc){if(1!==Da.type)return null;const Mc=oc.MRa(Da.D4.characterData,Da.D4.pa);return new Jb(Da.D4.Lc,Da.D4.sj,oc.mnc(Mc,Da.Ntj),Da.DH,Da.Qyb.Lc,Da.Qyb.sj,Da.REc.Lc,Da.REc.sj,pb)}}Object(l.a)(Jb,"RttSplitParagraphOp",lh,[224,225]);class ac{constructor(Da,pb,oc,Mc){this.Ujn=()=>{this.gxb.qRj()};this.Wja=Da;this.Mxc=pb;this.zka=oc;this.Zxb=Mc;null!=n.AFrameworkApplication.K&&n.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.WordEditorRttStatusReplicatorIsEnabled",
!1)&&(this.gxb=new sg,hm.GraphTransactionManager.instance.gph(this.Ujn))}AEk(Da,pb,oc,Mc=null){if(pb.isDirty)return Mc&&Mc.properties.Z(ac.h_i,"1"),!1;const $c=new rg(Da,pb.pj);try{if(1===Da.opType||6===Da.opType){const $e=Object(y.a)(qj,Da),Wc=this.a5k($e,pb);var $d=Wc.node.characterData;const Ng=10<=Wc.cpBegin?Wc.cpBegin-10:0;let Re=Wc.cpEnd+10<=$d.length?Wc.cpEnd+10:$d.length;const Ah=$d.substr(Ng,Wc.cpBegin-Ng),hi=$d.substr(Wc.cpEnd,Re-Wc.cpEnd);Re=Re+$e.Fpb.length-(Wc.cpEnd-Wc.cpBegin);var jc=
new Vf(Wc.node.id,Ng,Re,Ah+$e.Fpb+hi);const Sj=6===$e.opType;$d="";Sj&&($d=$e.font);if(!this.B2n(Wc,$e.Fpb,Sj,$d,Mc))return!1;let al;al=1===Da.opType?new Gm($e,pb.id):new gi($e,pb.id);pb.Wma=Da.d1;$e.d8a=jc;Da.p7=al;oc.OUf(al);null!=this.gxb&&this.gxb.Bpe(al)}else return 4===Da.opType?this.zEk(Da,pb,oc):!1}finally{$c&&$c.dispose()}return!0}zEk(Da,pb,oc){const Mc=Object(y.a)(Jb,Da);var $c=this.Zxb.MRa(pb.characterData,pb.pa);$c=this.Zxb.eBb($c,Mc.offset);if(!this.HAi(Va.a.createTextRange(pb,0,Fb.ParagraphReader.textLength(pb))))return!1;
var $d=Bd.GraphIterator.$a(pb);$d.zb(10);if(this.abc($d))return!1;let jc;$d=this.zka.Oc(3);try{$d.Cb(pb);const $e=pb.NY();try{const Wc=Bd.GraphIterator.$a(pb);Wc.zb(10);Wc.jd(11);let Ng=Wc.currentNode;Mc.H3b()&&(Wc.aDf?Ng=null:(Wc.nJ(),Ng=Wc.currentNode));Wc.sc();const Re=this.Mxc.ffb();Wc.LH(Re,Ng,89);Wc.Fi(Re);jc=pb.clone();const Ah=jc.NY();try{jc.setValue(ud.a.Lc,Mc.y3o);jc.setValue(ud.a.sj,Mc.Xxj);jc.isDirty=!1;Wc.Jf(jc,2);Wc.Fi(jc);this.X6k(pb,jc);const hi=Mc.H3b()?jc:pb,Sj=Mc.H3b()?pb:jc;hi.iO=
!0;Sj.iO=!0;this.Wja.y6f(this.HNa(hi,$c,Fb.ParagraphReader.textLength(hi)),"",!1,"");this.Wja.y6f(this.HNa(Sj,0,$c),"",!1,"");pb.Wma=Mc.yHo;jc.Wma=Mc.Xxj}finally{Ah&&Ah.dispose()}}finally{$e&&$e.dispose()}$d.RSa()}finally{$d&&$d.dispose()}pb=new An(Mc,pb.id,jc.id);Da.p7=pb;oc.OUf(pb);null!=this.gxb&&this.gxb.Bpe(pb);return!0}abc(Da){const pb=new Bd.GraphIterator;pb.Zc(Da);pb.jd(11);return fe.ListItemReader.Ig(pb)?(k.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}pCl(Da,
pb,oc){var Mc=pb.Ihb(Da.Lc);if(Mc.equals(cf.a.nil))return null;Mc=oc.Db(Mc);if(!Mc||!Fb.ParagraphReader.Vb(Mc)||!Mc.isConnected)return null;const $c=Bd.GraphIterator.$a(Mc);if(!$c.zb(23))return null;if(Da.fpg){Da=pb.Ihb(Da.fpg);if(Da.equals(cf.a.nil))return null;oc=oc.Db(Da);if(!oc||!Fb.ParagraphReader.Vb(oc)||!oc.isConnected)return null;oc=Bd.GraphIterator.$a(oc);if(!oc.zb(23))return null;oc.jd(11);oc.nJ();oc.Qd();if(oc.currentNode!==Mc)return null}return this.abc($c)?null:$c}LMo(Da,pb,oc,Mc){const $c=
pb.currentNode,$d=this.zka.Oc(3);try{$d.Cb($c);pb.jd(11);const jc=pb.currentNode;pb.sc();const $e=this.Mxc.ffb();pb.LH($e,jc,89);pb.Fi($e);const Wc=Ti.a.instance.createInstance(393230),Ng=Wc.NY();try{Wc.setValue(Ek.a.mo,""),Wc.pFa=!0,Mc.LMb(Wc),Mc=[0],Wc.setValue(ud.a.jq,Mc),Wc.setValue(ud.a.$s,Mc),Wc.pFa=!1,Wc.setValue(ud.a.Lc,Da.AQf),Wc.setValue(ud.a.sj,Da.zQf),Wc.isDirty=!1,pb.Jf(Wc,2),Wc.iO=!0,Wc.Wma=Da.zQf}finally{Ng&&Ng.dispose()}$d.RSa();Da.p7=new ll(Da,Wc.id);oc.OUf(Da.p7);null!=this.gxb&&
this.gxb.Bpe(Da.p7)}finally{$d&&$d.dispose()}return!0}HNa(Da,pb,oc){return pb===oc?Va.a.Rc(Da,pb):Va.a.createTextRange(Da,pb,oc)}B2n(Da,pb,oc,Mc,$c=null){const $d=Da.node;if(Da.cpBegin!==Da.cpEnd&&!this.HAi(Da))return $c&&$c.properties.Z(ac.uDj,"1"),!1;$c=this.zka.Oc(3);try{$c.Cb($d);const jc=$d.NY();try{$d.iO=!0,this.Wja.y6f(Da,pb,oc,Mc)}finally{jc&&jc.dispose()}$c.RSa()}finally{$c&&$c.dispose()}return!0}X6k(Da,pb){pb.pFa=!0;pb.jqa(Da.characterData);pb.Wma=Da.Wma;pb.pa.clear();for(var oc=0;oc<Da.pa.length;oc++){const Mc=
Da.pa.J(oc).mma(pb);pb.pa.add(Mc)}pb.Xl();if(pb.xe.length)for(Da=0;Da<pb.pa.length;Da++){if((oc=pb.pa.J(Da).formatting)&&-1!==oc.pe)for(;pb.xe.length<=oc.pe;)pb.xe.WX(pb.xe.length-1,256)}else k.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");pb.pFa=!1}bHf(Da){Da=Bd.GraphIterator.$a(Da);Da.zb(23);Da.sc();return{returnValue:89===Da.role,iterator:Da}}y5f(Da){const pb=new Bd.GraphIterator;pb.Zc(Da);pb.sc();const oc=this.zka.Oc(3);try{oc.Cb(pb.currentNode),
Da.Cg()}finally{oc&&oc.dispose()}}bYn(Da){if(Da.anchor)if(({iterator:pb}=this.bHf(Da)).returnValue)this.y5f(pb);else{var pb=Da.Jc.jm;var oc=this.zka.Oc(3);try{oc.Cb(Da),Da.load(pb.Db(Da.id)),Da.anchor.XX(4)}finally{oc&&oc.dispose()}}}X7f(Da,pb,oc){for(let $d=pb.count-1;0<=$d;$d--){var Mc=pb.J($d);switch(Mc.opType){case 4:Mc=Object(y.a)(An,Mc);if(!Da.id.equals(Mc.eje)){k.ULS.shipAssertTag(9204885,355,Da.id.equals(Mc.yIc));continue}Mc=oc.Db(Mc.yIc);if(!Mc)break;if(!Mc||!Fb.ParagraphReader.Vb(Mc)){k.ULS.shipAssertTag(9204886,
355,!1);break}if(!Mc.isConnected)continue;var $c=({iterator:Mc}=this.bHf(Mc)).returnValue;k.ULS.shipAssertTag(9204887,355,$c);$c&&this.y5f(Mc);break;case 2:(Mc=Object(y.a)(ll,Mc),Da.id.equals(Mc.paragraphId))?Da.isConnected&&($c=({iterator:Mc}=this.bHf(Da)).returnValue,k.ULS.shipAssertTag(16820002,355,$c),$c&&this.y5f(Mc)):k.ULS.shipAssertTag(16820001,355,!1)}}}a5k(Da,pb){const oc=this.Zxb.MRa(pb.characterData,pb.pa),Mc=this.Zxb.eBb(oc,Da.xR);Da=this.Zxb.eBb(oc,Da.C4);return Mc===Da?Va.a.Rc(pb,Mc):
Va.a.createTextRange(pb,Mc,Da)}HAi(Da){const pb=Da.node.pa,oc=Da.cpBegin;Da=Da.cpEnd;for(let Mc=0;Mc<pb.length;Mc++){const $c=pb.J(Mc);if($c.cp>=Da)break;if($c.cp>=oc){if($c.tf)return k.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if($c.blob)return k.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if($c.ed||$c.fkb||$c.gac)return k.ULS.sendTraceTag(8242649,355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}
ac.h_i="ParagraphAlreadyDirty";ac.uDj="UnsafeWetChange";Object(l.a)(ac,"RttEditor",null,[261]);var Ec=c(20),Lc=c(1447),kd=c(248);class Vd{constructor(){this.Fdd=new P.a}add(Da){this.Fdd.add(Da);return!0}FQd(Da){const pb=new P.a;for(const oc of this.Fdd)Da(oc)&&pb.add(oc);return pb}N4f(Da){Da.activity.PSf("dried");this.Fdd.remove(Da)}Q4f(Da){Da.activity.PSf("expired");this.Fdd.remove(Da)}}Object(l.a)(Vd,"RttAddParagraphDataStore",null,[]);class se extends lh{constructor(Da,pb,oc,Mc,$c,$d,jc,$e){super(2,
$e);this.Lc=Da;this.sj=pb;this.d1=oc;this.fpg=Mc;this.AQf=$c;this.zQf=$d;this.DH=jc}serialize(){const Da=new Ie.a(2,this.Lc,this.sj,null,this.fpg,null,null,this.DH),pb=new Wb(this.d1,this.AQf,this.zQf);return new Mb(this.metadata.packetId,this.metadata.clientId,1,3,Da,null,void 0,void 0,pb,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){const pb=Da.iT,oc=Da.h0b;let Mc=null;null!=Da.iT.yGa&&(Mc=Da.iT.yGa);return new se(pb.KRa,pb.n7a,oc.Iig,Mc,oc.zXf,oc.d1,pb.DH,cb.create(Da))}static aam(Da,
pb){return 3!==Da.type?null:new se(Da.kpa.Lc,Da.kpa.sj,Da.vfn.sj,Da.rRa?Da.rRa.Lc:null,Da.kxa.Lc,Da.kxa.sj,Da.DH,pb)}}Object(l.a)(se,"RttAddParagraphOp",lh,[]);class He{constructor(Da){this.wV=Da}h7i(){this.wV&&this.wV.properties.Z(He.gYh,"1")}LPn(Da){this.wV&&(this.wV.properties.nb(He.SNf)||this.wV.properties.Z(He.SNf,(Da-this.wV.startTime).toString()))}PSf(Da){this.wV&&(this.wV.properties.Z(He.Qaj,Da),this.wV.end())}jRn(Da){this.wV&&this.wV.properties.Z(He.jZi,Da.toString())}iRn(Da){this.wV&&this.wV.properties.Z(He.FYi,
Da)}static qzf(Da){Da.d5(cg.a.vNb,He.gYh,Lc.a.gwj);Da.d5(cg.a.vNb,He.ezl,Lc.a.gwj);Da.d5(cg.a.vNb,He.SNf,Lc.a.qIk);Da.d5(cg.a.vNb,He.Qaj,Lc.a.vua);Da.d5(cg.a.vNb,He.jZi,Lc.a.vua);Da.d5(cg.a.vNb,He.FYi,Lc.a.vua)}static create(Da){if(!Da)return null;Da=Da.Ap(cg.a.vNb,He.p2o);return new He(Da)}}He.gYh="FailedToFindInitialParaID";He.ezl="FailedToFindInitialTextID";He.SNf="MsecUntilApplied";He.Qaj="RemovedBecause";He.jZi="PacketVersions";He.FYi="OperationType";He.p2o=48E4;Object(l.a)(He,"RttOpActivity",
null,[]);var wf;(function(Da){Da[Da.unknown=0]="unknown";Da[Da.jkp=1]="replaceTextRangeOp";Da[Da.ibp=2]="addParagraphOp";Da[Da.fdp=3]="deleteParagraphOp";Da[Da.imp=4]="splitParagraphOp";Da[Da.Qhp=5]="mergeParagraphOp";Da[Da.ikp=6]="replaceSymbolRangeOp"})(wf||(wf={}));Object(l.b)("RttOpType",wf);var fc=c(124);class hf extends qj{constructor(Da,pb,oc,Mc,$c,$d,jc,$e,Wc,Ng,Re){super(Mc,$c,$d,jc,$e,Wc,Ng,Re,6);this.font=Da;this.legacy=pb}Guf(){return"OffsetStart: "+this.xR+"OffsetEnd: "+this.C4}serialize(){const Da=
this.wMh();return new Mb(this.metadata.packetId,this.metadata.clientId,1,7,Da,null,this.d1,this.Fpb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){let pb,oc,Mc,$c;if(!({xR:pb,C4:oc,Lc:Mc,sj:$c}=qj.vBj(Da)).returnValue)return null;let $d,jc;if(1===Da.text.length)$d=!1,jc=fc.AParagraphNode.BC;else if(2===Da.text.length)if(Bb.a.exi(Da.text,0)&&Bb.a.pz(Da.text,1))$d=!0,jc=Da.text;else return k.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",
Da.Gt),null;else return k.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",Da.Gt),null;const $e=Da.D9c,Wc=cb.create(Da);return new hf($e.hhg,$e.ihg,$d,Mc,$c,pb,oc,Da.QPb,jc,Da.iT.DH,Wc)}}Object(l.a)(hf,"RttReplaceSymbolRangeOp",qj,[224,225]);class Fk extends qj{constructor(Da,pb,oc,Mc,$c,$d,jc,$e){super(Da,pb,oc,Mc,$c,$d,jc,$e,1)}Guf(){return"OffsetStart: "+this.xR+"OffsetEnd: "+this.C4+"TextAddedLength: "+this.Fpb.length}serialize(){const Da=
this.wMh();return new Mb(this.metadata.packetId,this.metadata.clientId,1,2,Da,null,this.d1,this.Fpb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){let pb,oc,Mc,$c;if(!({xR:pb,C4:oc,Lc:Mc,sj:$c}=qj.vBj(Da)).returnValue)return null;let $d="";Da.text&&($d=Da.text);const jc=cb.create(Da);return new Fk(Mc,$c,pb,oc,Da.QPb,$d,Da.iT.DH,jc)}static c$l(Da,pb,oc){if(Da.type)return null;const Mc=oc.MRa(Da.D4.characterData,Da.D4.pa);return new Fk(Da.D4.Lc,Da.D4.sj,oc.mnc(Mc,
Da.cpBegin),oc.mnc(Mc,Da.cpEnd),Da.kxa.sj,Da.d9,Da.DH,pb)}}Object(l.a)(Fk,"RttReplaceTextRangeOp",qj,[224,225]);class Mh{constructor(Da,pb,oc,Mc,$c,$d,jc,$e,Wc,Ng,Re,Ah,hi,Sj,al,fj,yk,dn,Ji){this.Cl=null;this.iGe=this.Vkh=!1;this.Fhd=!0;this.c8g=0;this.zeh=this.hRe=this.Beh=this.yeh=this.Aeh=!1;this.xVf=()=>{k.ULS.sendTraceTag(7685328,355,50,"All prerequisite ready for RttManager");this.Cl=this.GZ.result;k.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.Cl.c3(this.x0)};this.x0=
(nm,Lg)=>{if(3===Lg.type||10===Lg.type)if(10===Lg.type)this.c8g="boolean"===typeof Lg.wL?Lg.wL?1:0:Lg.wL;else if(this.RWb.value&&!this.RWb.value.HUd)k.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");else if(Lg.wL){if(this.wRn(),(nm=this.kkl(Lg.wL))&&1!==nm.metadata.clientType){this.vRn();if(!(!this.Vo||this.Vo.ica||Ec.a.TPa||Ec.a.hca||(n.AFrameworkApplication.te("1i00j689;ba0dg262"),Ec.a.TPa||Ec.a.hca)))return;if(2!==this.c8g)switch(this.Fhd&&(this.zYb.p7i(),
this.Fhd=!1),this.Vkh||this.ixm(),nm.opType){case 1:case 6:case 4:if(!({yg:nm}=this.Bqk(nm)).returnValue)break;this.kih?this.Dgj(nm):this.ACj(nm);break;case 2:this.voc.add(nm),this.Xpi(nm),this.kih?this.Dgj(cf.a.nil):this.zCj(nm)}}}else k.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty")};this.Pxl=()=>{const nm=this.oi.value;if(nm){var Lg=this.rD()-Mh.nYn,sf=this.usb.FQd(ke=>ke.metadata.Zig<Lg);0<sf.count&&this.MPn();var ne=new kd.a;for(const ke of sf)if(this.usb.Q4f(ke),ke.p7)switch(ke.p7.opType){case 1:ne.add(ke.p7.paragraphId.toString());
break;case 6:ne.add(ke.p7.paragraphId.toString());break;case 4:ne.add(ke.p7.eje.toString()),ne.add(ke.p7.yIc.toString())}sf=this.voc.FQd(ke=>ke.metadata.Zig<Lg);for(const ke of sf)this.voc.Q4f(ke),ke.p7&&ne.add(ke.p7.paragraphId.toString());for(const ke of ne)(ne=nm.Db(cf.a.Ff(ke)))?ne.iO?(this.fxb.bYn(ne),ne.iO||this.Awc.value.eaj(ne)):k.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):k.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.oi.sxf&&
k.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")};this.fxb=Da;this.usb=pb;this.Awc=oc;this.RWb=Mc;this.CI=$c;this.GZ=$d;this.oi=jc;this.Hb=$e;this.rD=Wc;this.Zxb=Ng;this.rd=Re;this.PNe=hi;this.Gc=Sj;this.kih=al;this.zYb=fj;this.trb=yk;this.qXe=dn;this.Dyc=new L.a(I.a.ai());this.voc=new Vd;Ah.execute(Mh.qzf);this.Vo=Ji}ixm(){const Da=new ha.a(3,2,Mh.p_n,this.Pxl);this.Hb.Wb(Da);this.Vkh=!0}init(){return this.GZ?this.GZ.continueWith(this.xVf):F.Task.M3(!1)}kkl(Da){Da=
Gc(Da);if(!Da)return null;switch(Da.Gt){case 2:return Fk.create(Da);case 7:return hf.create(Da);case 4:return Jb.create(Da);case 3:return se.create(Da);default:return k.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",Da.Gt),null}}Bqk(Da){let pb=cf.a.nil;if(!this.usb.Aqk(Da))return{returnValue:!1,yg:pb};this.Xpi(Da);if(!this.CI)return{returnValue:!1,yg:pb};const oc=this.CI.Ihb(Da.Lc);if(oc.equals(cf.a.nil)||!this.oi.value.Db(oc))return Da.activity.h7i(),{returnValue:!1,
yg:pb};this.r7i();return{returnValue:!0,yg:oc}}Dgj(Da){Da.equals(cf.a.nil)||this.Dyc.add(Da.toString());this.iGe||(Da=new ha.a(0,1,200,()=>{this.BOo();this.iGe=!1},71),this.Hb.Wb(Da),this.iGe=!0)}R$n(Da){Da=new ha.a(0,1,0,Da,71);this.Hb.Wb(Da)}Xpi(Da){Da.activity=He.create(this.rd);Da.activity.jRn(Da.metadata.packetVersion);Da.activity.iRn(wf[Da.opType])}BOo(){var Da=this.voc.FQd(oc=>!oc.p7);for(const oc of Da)this.zCj(oc);if(this.Dyc.count){Da=null;for(var pb of this.Dyc){pb=cf.a.Ff(pb);Da=this.oi.value.Db(pb);
break}pb=this.Gc.Oc(3);try{pb.Cb(Da);for(const oc of this.Dyc)this.ACj(cf.a.Ff(oc))}finally{pb&&pb.dispose()}this.Dyc.clear()}}ACj(Da){Da=this.oi.value.Db(Da);let pb;const oc=this.Gc.Oc(3);try{oc.Cb(Da);pb=this.rd.Ap(cg.a.Ath);const Mc=this.Fth(Da,pb);pb.end();Mc&&this.ytk(Mc)}finally{oc&&oc.dispose(),this.zYb.f3f(1),this.Fhd=!0}}zCj(Da){var pb=this.fxb.pCl(Da,this.CI,this.oi.value);pb&&(this.r7i(),this.fxb.LMo(Da,pb,this.trb,Ka.a.instance.resolve("Box4.IParagraphEditor"))&&(pb=this.oi.value.Db(Da.p7.paragraphId),
this.Yth(pb,Da),this.zYb.f3f(1),this.Fhd=!0))}ytk(Da){this.PNe.continueWith(()=>{if(1===Da.opType){var pb=this.f8l(Da);pb&&(this.PNe.result.ZYe(pb),this.PNe.result.lde(!0))}})}f8l(Da){const pb=Da.serialize();if(2!==pb.Gt||pb.iT.yGa&&pb.iT.KRa!==pb.iT.yGa)return null;const oc=Da.xR.clone();0<Da.Fpb.length&&(oc.YDh(),oc.cp+=Da.Fpb.length);pb.Gt=0;pb.text=null;pb.iT.dce=0;pb.iT.xR=oc;pb.iT.n7a=pb.QPb;pb.iT.yGa=null;pb.iT.alc=null;pb.iT.C4=null;pb.QPb=null;return uc.iaf(pb,this.CI,this.Zxb,()=>this.oi.value,
this.qXe.instance)}Yth(Da,pb){return this.Awc.value?this.Awc.value.qpk(Da,pb.metadata.clientId).returnValue?!0:(k.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(k.ULS.shipAssertTag(7866378,355,!!this.Awc.value,"Unable to apply wet changes as LockManager unavailable"),!1)}Eth(Da,pb){this.Fth(Da,pb)}Fth(Da,pb){if(!Da)return null;if(!Da.anchor)return pb&&pb.properties.Z(Mh.zQi,"1"),null;if(!Da.hasProperty(ud.a.Lc))return k.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),
null;if(!Da.hasProperty(ud.a.sj))return k.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),null;if(Da.hasProperty(ud.a.FRh)&&Da.getValue(ud.a.FRh))return k.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const oc=Da.getValue(ud.a.Lc);var Mc=Da.Wma;pb&&(pb.properties.Z(Mh.sgn,Mc.toString()),pb.properties.Z(Mh.ugn,oc.toString()));Mc=this.usb.Rrf(oc,Mc);if(!Mc)return pb&&pb.properties.Z(Mh.lQi,"1"),null;if(!this.Yth(Da,Mc))return pb&&pb.properties.Z(Mh.vJh,
"1"),null;let $c=0,$d=null;for(;Mc;){if(!this.fxb.AEk(Mc,Da,this.trb,pb)){pb&&pb.properties.Z(Mh.WJj,"1");break}$c++;Mc.activity.LPn(this.rD());$d=Mc;Mc=Da.Wma;Mc=this.usb.Rrf(oc,Mc)}0<$c&&this.M6i();pb&&pb.properties.add(Mh.XJj,$c.toString());return $d}Sce(Da){if(Da.hasProperty(ud.a.Lc)&&Da.hasProperty(ud.a.sj)){var pb=Da.getValue(ud.a.Lc),oc=Da.ia(ud.a.sj,0),Mc=this.rd.Ap(cg.a.i9i),$c=this.trb.Tnn(Da.id);0<$c.count&&(this.fxb.X7f(Da,$c,this.oi.value),this.KYn(Da,$c,oc));var $d=this.trb.BKl(pb);
if($d&&!Da.id.equals($d.paragraphId)){const jc=this.oi.value;this.R$n(()=>{const $e=this.trb.Ylb($d.paragraphId),Wc=jc.Db($d.paragraphId);k.ULS.shipAssertTag(16820032,355,!!Wc,"Could not find added graph node");Wc&&(this.fxb.X7f(Wc,$e,jc),this.voc.N4f($d.$Ye))})}this.usb.Rrf(pb,oc)||this.Awc.value.eaj(Da);this.Eth(Da,Mc);Mc.end()}}KYn(Da,pb,oc){let Mc=!1;for(let $d=pb.count-1;0<=$d;$d--){var $c=pb.J($d);switch($c.opType){case 1:case 6:case 4:$c=Object(y.a)(224,$c.operation);break;default:continue}$c.d1===
oc&&(Mc=!0,$c.d8a&&!$c.d8a.X_o(Da)&&k.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",$c.opType,$c.Guf(),Da.id,$c.d8a.id,$c.d8a.cpBegin,$c.d8a.cpEnd));Mc&&this.usb.N4f($c)}Mc&&this.M6i()}I_c(Da){const pb=this.trb.Ylb(Da.id);0<pb.count&&(2===pb.J(0).opType&&pb.removeAt(0),this.fxb.X7f(Da,pb,this.oi.value))}Bhe(Da){var pb=this.trb.$4l(Da.id);for(const oc of pb)if(4===oc.opType&&
(pb=Object(y.a)(An,oc),Da.id.equals(pb.Ook)))return!0;return!1}wRn(){this.Aeh||(k.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.Aeh=!0)}vRn(){this.yeh||(k.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),this.yeh=!0)}r7i(){this.Beh||(k.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.Beh=!0)}M6i(){this.hRe||(k.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.hRe=!0)}MPn(){this.hRe||this.zeh||(k.ULS.sendTraceTag(8185608,
355,15,"Failed to apply any wet changes so far"),this.zeh=!0)}static qzf(Da){const pb=[cg.a.Ath,cg.a.i9i];for(const oc of pb)Da.d5(oc,Mh.XJj,Lc.a.vua),Da.d5(oc,Mh.lQi,Lc.a.vua),Da.d5(oc,Mh.zQi,Lc.a.vua),Da.d5(oc,Mh.vJh,Lc.a.vua),Da.d5(oc,Mh.WJj,Lc.a.vua),Da.d5(oc,ac.h_i,Lc.a.vua),Da.d5(oc,ac.uDj,Lc.a.vua);He.qzf(Da)}}Mh.p_n=6E4;Mh.nYn=18E4;Mh.XJj="WetChangeCount";Mh.lQi="NoChangesToApply";Mh.zQi="NodeNotConnected";Mh.vJh="CouldNotGetLock";Mh.WJj="WetChangeBlocked";Mh.ugn="NodeWordId";Mh.sgn="NodeTextId";
Object(l.a)(Mh,"RttManager",null,[264]);class mm{constructor(Da,pb){this.mfj=0;this.ij=Da;this.O8n=pb}p7i(){this.mfj=this.ij()}f3f(Da){const pb=this.ij()-this.mfj;0<=pb&&this.O8n.track(Math.round(pb),0===Da?"CTB":"RTP")}}Object(l.a)(mm,"RttPerfCounter",null,[260]);var wj=c(1967);class Yd{constructor(){this.gAc=new wj.a}cuk(Da,pb){this.gAc.back()&&pb&&this.gAc.back().Ceb(Da)||this.gAc.enqueue(Da)}D3l(){return this.gAc.isEmpty?null:this.gAc.dequeue()}}Object(l.a)(Yd,"RttSendDataStore",null,[259]);class $g extends lh{constructor(Da,
pb,oc,Mc){super(3,Mc);this.Lc=Da;this.sj=pb;this.DH=oc}get d1(){return 0}serialize(){const Da=new Ie.a(4,this.Lc,this.sj,null,null,null,null,this.DH);return new Mb(this.metadata.packetId,this.metadata.clientId,1,5,Da,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){const pb=Da.iT;return new $g(pb.KRa,pb.n7a,pb.DH,cb.create(Da))}static bam(Da,pb){return 4!==Da.type?null:new $g(Da.v4b.Lc,Da.v4b.sj,Da.DH,pb)}}Object(l.a)($g,"RttDeleteParagraphOp",
lh,[224,225]);class fg extends lh{constructor(Da,pb,oc,Mc,$c,$d,jc,$e){super(5,$e);this.epg=Da;this.Wxj=pb;this.x3o=oc;this.zHo=Mc;this.DH=$c;this.LKj=$d;this.blc=jc}get Lc(){return this.epg}get sj(){return this.Wxj}get d1(){return this.epg===this.LKj?this.blc:0}serialize(){const Da=new Ie.a(5,this.epg,this.Wxj,null,this.x3o,this.zHo,null,this.DH),pb=new kc(this.LKj,this.blc);return new Mb(this.metadata.packetId,this.metadata.clientId,1,6,Da,null,void 0,void 0,void 0,pb,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){const pb=
Da.iT,oc=Da.UYc;return new fg(pb.KRa,pb.n7a,pb.yGa,pb.alc,pb.DH,oc.yXf,oc.blc,cb.create(Da))}static cam(Da,pb){return 2!==Da.type?null:new fg(Da.kpa.Lc,Da.kpa.sj,Da.rRa.Lc,Da.rRa.sj,Da.DH,Da.W3d.Lc,Da.W3d.sj,pb)}}Object(l.a)(fg,"RttMergeParagraphOp",lh,[224,225]);class Eo{constructor(Da,pb,oc,Mc,$c,$d){this.LAc=this.fj=null;this.sea=!1;this.hVe=this.Hih=0;this.ivd=this.Tjh=!1;this.lQe=0;this.xVf=()=>{k.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.fj=this.GZ.result;
this.fj.Cce(this)};this.GVi=(jc,$e)=>{if(this.fj&&2===this.fj.connectionState&&(jc=$e.hF,jc.length))if($e.w7)100>this.hVe&&(this.hVe++,k.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",$e.YJk,this.Hih,this.hVe));else{for($e=0;$e<jc.length;$e++)if(!this.UTm(jc[$e]))return;for($e=0;$e<jc.length;$e++){const Wc=jc[$e];this.Bdh.cuk(Wc,!Wc.type&&!$e)}this.LAc||this.jVi(this.LAc,this.fj)}};this.GZ=Da;this.Bdh=pb;this.Sab=oc;this.St=Mc;this.uta=$c;this.zYb=
$d}get wn(){return this.Sab.value}init(){return this.GZ?this.GZ.continueWith(this.xVf):F.Task.M3(!1)}start(){this.sea||(this.St.Uc?(this.St.Uc.hF.ayk(this.GVi),this.sea=!0):k.ULS.sendTraceTag(522740420,355,10,"No activePage, RttSendManager not started"))}stop(){this.sea&&(this.sea=!1,this.St.Uc.hF.J0n(this.GVi))}UTm(Da){return Da&&-1!==Da.DH?Da.type&&3!==Da.type&&1!==Da.type?!1:!0:!1}d6m(){this.ivd||(this.Tjh||(k.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.Tjh=!0),!this.ivd&&
5>=this.lQe&&this.lQe++)}s6m(){!this.ivd&&5>=this.lQe&&(k.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.ivd=!0)}jVi(Da,pb){this.d6m();Da&&(Da.Ci||Da.zo)&&k.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",Da.exception);this.zYb.p7i();(Da=this.dam(this.Bdh.D3l()))?(this.Hih++,this.LAc=pb.aN(3,ie(Da.serialize())),this.s6m(),this.zYb.f3f(0),this.LAc.continueWith(oc=>{this.jVi(oc,pb)})):this.LAc=null}dam(Da){if(!Da)return null;if(!this.wn)return k.ULS.sendTraceTag(8245957,
355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const pb=new cb(Tg.instance.ybi(),this.wn.kj,1,0,0,gf.instance.U3l());let oc=null;switch(Da.type){case 0:oc=Fk.c$l(Da,pb,this.uta);break;case 4:oc=$g.bam(Da,pb);break;case 3:oc=se.aam(Da,pb);break;case 2:oc=fg.cam(Da,pb);break;case 1:oc=Jb.eam(Da,pb,this.uta)}return oc}}Object(l.a)(Eo,"RttSendManager",null,[218]);class Fo{constructor(){this.W=null;this.B1l=()=>Ga.App.qd&&Ga.App.qd.Qp?Ga.App.qd.Qp:(k.ULS.sendTraceTag(7866377,
304,15,"Unable to get the lock manager"),null)}get name(){return"WordEditor.RealTimeTyping"}xc(Da){const pb=Na.a.Bp(Da.Sa("Box4.IOutlineElementEditor")),oc=Na.a.Bp(Da.Sa("Box4.IFeatureHelper")),Mc=Na.a.Bp(Da.Sa("Common.IActivityAggregationInfo")),$c=Na.a.Bp(Da.Sa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator")),$d=Na.a.Bp(Da.Sa("Box4.CompositionStateManager"));this.W=Da;const jc=new vf.a;F.Task.WAA.call(null,pb,oc,Mc,$c,$d).continueWith(()=>{Da.ha("WordEditor.RealTimeTyping.IRttEditor",
()=>new ac(Da.resolve("Box4.ICharacterPropertiesEditor"),Da.resolve("Box4.IOutlineElementEditor"),jc,Da.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).singleInstance();Da.register(mm,"WordEditor.RttPerfCounter").as("WordEditor.IRttPerfCounter").singleInstance().Rd(()=>new mm(xb.a.Ze,ej.a.cF(17,1,new vj.a(new Xh.a(.25)))));Da.ha("WordEditor.RealTimeTyping.RttManager",()=>new Mh(Da.resolve("WordEditor.RealTimeTyping.IRttEditor"),new Of(dg.a.instance),new X.a(this.B1l),new X.a(()=>
Ga.App.lV),Da.resolve("WordEditor.ParagraphWordIdMapping"),Da.resolve("Box4.Presence.IRtcProxyProvider").OD(),new X.a(()=>Ga.App.xa.hb&&Ga.App.xa.hb.Uc?Ga.App.xa.hb.Uc.od:(k.ULS.sendTraceTag(522740419,304,10,"No activePage or workspace."),null)),cc.a.instance,()=>Date.now(),Da.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),dg.a.instance,Da.Sa("Common.IActivityAggregationInfo"),og.OD(),jc,n.AFrameworkApplication.K.$("WordEditorThrottleAndBatchRTTRendering"),Da.resolve("WordEditor.IRttPerfCounter"),
new qg,Da.Sa("WordEditor.Presence.IWordPresenceCpFactory"),Da.resolve("Box4.CompositionStateManager"))).as("WordEditor.RealTimeTyping.IRttManager").singleInstance();Da.ha("WordEditor.RealTimeTyping.RttSendManager",()=>new Eo(Da.resolve("Box4.Presence.IRtcProxyProvider").OD(),new Yd,new X.a(()=>Ga.App.qd),Ga.App.xa.hb,Da.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Da.resolve("WordEditor.IRttPerfCounter"))).singleInstance();this.rzf()})}rzf(){this.W.resolve("WordEditor.RealTimeTyping.RttManager").init();
this.W.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){La.a.instance.Fc(new Fo)}}Object(l.a)(Fo,"WordEditorRealTimeTypingPackage",null,[1,2]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");Type.registerNamespace("WordEditor.Presence");Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");
sa.main();Type.registerNamespace("Common.App.CollabControls");fb.prototype.toString=za.a.prototype.toString;lb.prototype.toString=za.a.prototype.toString;La.a.instance.Fc(new Hf);Fo.main();Type.registerNamespace("RealtimePresenceUI");La.a.instance.Fc(new Dd);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");oa.main()}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/19660862/wdjs/WordEditorDSVersionHistoryRemoved.collab.js.map