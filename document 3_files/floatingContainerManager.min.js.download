(window.wordOnlineExpChunks=window.wordOnlineExpChunks||[]).push([[20],{1733:function(t,n,e){var o={"./af-ZA/canvas-contextual.json":[1074,25],"./am-ET/canvas-contextual.json":[1075,27],"./ar-SA/canvas-contextual.json":[1076,29],"./as-IN/canvas-contextual.json":[1077,31],"./az-Latn-AZ/canvas-contextual.json":[1078,33],"./be-BY/canvas-contextual.json":[1079,34],"./bg-BG/canvas-contextual.json":[1080,36],"./bn-BD/canvas-contextual.json":[1081,37],"./bn-IN/canvas-contextual.json":[1082,39],"./bs-Latn-BA/canvas-contextual.json":[1083,41],"./ca-ES/canvas-contextual.json":[1084,43],"./ca-Es-VALENCIA/canvas-contextual.json":[1085,45],"./chr-Cher-US/canvas-contextual.json":[1086,46],"./cs-CZ/canvas-contextual.json":[1087,48],"./cy-GB/canvas-contextual.json":[1088,50],"./da-DK/canvas-contextual.json":[1089,52],"./de-DE/canvas-contextual.json":[1090,54],"./el-GR/canvas-contextual.json":[1091,56],"./en-GB/canvas-contextual.json":[1092,58],"./en-US/canvas-contextual.json":[1093,59],"./es-ES/canvas-contextual.json":[1094,61],"./es-MX/canvas-contextual.json":[1095,63],"./et-EE/canvas-contextual.json":[1096,65],"./eu-ES/canvas-contextual.json":[1097,67],"./fa-IR/canvas-contextual.json":[1098,69],"./fi-FI/canvas-contextual.json":[1099,71],"./fil-PH/canvas-contextual.json":[1100,73],"./fr-CA/canvas-contextual.json":[1101,75],"./fr-FR/canvas-contextual.json":[1102,77],"./ga-IE/canvas-contextual.json":[1103,79],"./gd-gb/canvas-contextual.json":[1104,81],"./gl-ES/canvas-contextual.json":[1105,83],"./gu-IN/canvas-contextual.json":[1106,85],"./ha-Latn-NG/canvas-contextual.json":[1107,86],"./he-IL/canvas-contextual.json":[1108,88],"./hi-IN/canvas-contextual.json":[1109,90],"./hr-HR/canvas-contextual.json":[1110,92],"./hu-HU/canvas-contextual.json":[1111,94],"./hy-AM/canvas-contextual.json":[1112,96],"./id-ID/canvas-contextual.json":[1113,98],"./is-IS/canvas-contextual.json":[1114,100],"./it-IT/canvas-contextual.json":[1115,102],"./ja-JP/canvas-contextual.json":[1116,104],"./ka-GE/canvas-contextual.json":[1117,106],"./kk-KZ/canvas-contextual.json":[1118,108],"./km-KH/canvas-contextual.json":[1119,110],"./kn-IN/canvas-contextual.json":[1120,112],"./ko-KR/canvas-contextual.json":[1121,114],"./kok-IN/canvas-contextual.json":[1122,116],"./ky-KG/canvas-contextual.json":[1123,117],"./lb-LU/canvas-contextual.json":[1124,119],"./lo-LA/canvas-contextual.json":[1125,121],"./lt-LT/canvas-contextual.json":[1126,123],"./lv-LV/canvas-contextual.json":[1127,125],"./mi-NZ/canvas-contextual.json":[1128,127],"./mk-MK/canvas-contextual.json":[1129,129],"./ml-IN/canvas-contextual.json":[1130,131],"./mn-MN/canvas-contextual.json":[1131,132],"./mr-IN/canvas-contextual.json":[1132,134],"./ms-MY/canvas-contextual.json":[1133,136],"./mt-MT/canvas-contextual.json":[1134,138],"./nb-NO/canvas-contextual.json":[1135,140],"./ne-NP/canvas-contextual.json":[1136,142],"./nl-NL/canvas-contextual.json":[1137,144],"./nn-NO/canvas-contextual.json":[1138,146],"./or-IN/canvas-contextual.json":[1139,148],"./pa-IN/canvas-contextual.json":[1140,150],"./pl-PL/canvas-contextual.json":[1141,152],"./prs-AF/canvas-contextual.json":[1142,153],"./pt-BR/canvas-contextual.json":[1143,155],"./pt-PT/canvas-contextual.json":[1144,157],"./qps-ploc/canvas-contextual.json":[1145,158],"./qps-ploca/canvas-contextual.json":[1146,159],"./qps-plocm/canvas-contextual.json":[1147,160],"./quz-PE/canvas-contextual.json":[1148,162],"./ro-RO/canvas-contextual.json":[1149,164],"./ru-RU/canvas-contextual.json":[1150,166],"./sd-Arab-PK/canvas-contextual.json":[1151,167],"./si-LK/canvas-contextual.json":[1152,168],"./sk-SK/canvas-contextual.json":[1153,170],"./sl-SI/canvas-contextual.json":[1154,172],"./sq-AL/canvas-contextual.json":[1155,174],"./sr-Cyrl-BA/canvas-contextual.json":[1156,176],"./sr-Cyrl-RS/canvas-contextual.json":[1157,178],"./sr-Latn-RS/canvas-contextual.json":[1158,180],"./sv-SE/canvas-contextual.json":[1159,182],"./sw-KE/canvas-contextual.json":[1160,183],"./ta-IN/canvas-contextual.json":[1161,185],"./te-IN/canvas-contextual.json":[1162,187],"./th-TH/canvas-contextual.json":[1163,189],"./tk-TM/canvas-contextual.json":[1164,190],"./tr-TR/canvas-contextual.json":[1165,192],"./tt-RU/canvas-contextual.json":[1166,194],"./ug-CN/canvas-contextual.json":[1167,196],"./uk-UA/canvas-contextual.json":[1168,198],"./ur-PK/canvas-contextual.json":[1169,200],"./uz-Latn-UZ/canvas-contextual.json":[1170,202],"./vi-VN/canvas-contextual.json":[1171,204],"./zh-CN/canvas-contextual.json":[1172,206],"./zh-TW/canvas-contextual.json":[1173,208]};function i(t){if(!e.o(o,t))return Promise.resolve().then((function(){var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}));var n=o[t],i=n[0];return e.e(n[1]).then((function(){return e.t(i,3)}))}i.keys=function(){return Object.keys(o)},i.id=1733,t.exports=i},2786:function(t,n,e){"use strict";e.r(n);var o,i=e(73),a=e(5);!function(t){t[t.CommentThread=0]="CommentThread",t[t.TrackedChange=1]="TrackedChange"}(o||(o={}));var r,s,c;function d(t){switch(t){case o.CommentThread:return i.b.CommentThread;case o.TrackedChange:return i.b.TrackedChange;default:return i.b.CommentThread}}!function(t){t[t.msoulscat_Wac_Telemetry=383]="msoulscat_Wac_Telemetry"}(r||(r={})),function(t){t[t.Error=10]="Error",t[t.Warning=15]="Warning",t[t.Info=50]="Info",t[t.Verbose=100]="Verbose",t[t.Spam=200]="Spam"}(s||(s={})),function(t){t[t.containerVirtualizationEnabled=0]="containerVirtualizationEnabled"}(c||(c={}));var l,u=function(){function t(t,n,e){void 0===e&&(e=0),this.disableRepositioningAnimation=!1,this.positionFixed=!1,this.anchorLeft=0,this.shouldUpdatePositions=!1,this.aggregateHeight=0,this.possibleTopForNextContainer=0,this.renderMode=i.e.Integrated,this.constructContainerId=t,this.ulsLogger=n,this.activeContainerAnchorLeft=e}return t.prototype.getAggregateHeight=function(){return this.aggregateHeight},t.prototype.calculateNewPositions=function(t,n,e){this.disableRepositioningAnimation=!!e&&!!e.disableRepositioningAnimation,this.positionFixed=!!e&&!!e.positionFixed,this.shouldUpdatePositions=!e||!1!==e.shouldUpdatePositions;var o=t[0];if(this.anchorLeft=o&&o.anchorLeft?o.anchorLeft:0,e&&e.activeContainerInfo){var i=e.activeContainerInfo;this.updateContainerPositionsAroundActiveContainer(t,n,i)}else{var a=e?e.topOfFirstContainer:void 0;this.setRestPositionOfContainers(t,n,a)}},t.prototype.updateContainersPositions=function(t,n,e){this.calculateNewPositions(t,n,e)},t.prototype.updateContainerPositionsAroundActiveContainer=function(t,n,e){var o=n[e.containerId];if(o){var i=o.floatingContainerRef,c=this.shouldUpdatePositions&&i?i.height():o.position.height;this.shouldUpdatePositions&&i&&(i.anchorPoint().y!==o.anchorTop||i.anchorPoint().x!==this.activeContainerAnchorLeft)&&i.updateContainerPosition({anchorPoint:{x:this.activeContainerAnchorLeft,y:o.anchorTop},disableRepositioningAnimation:this.disableRepositioningAnimation,positionFixed:this.positionFixed}),this.updateFloatingContainerPositionInCache(n,e.containerId,Object(a.__assign)(Object(a.__assign)({},o.position),{x:this.activeContainerAnchorLeft,y:o.anchorTop})),this.updateContainerPositionsAboveActiveContainer(t,n,o.anchorTop,e.containerPositionIndex-1),this.possibleTopForNextContainer=this.getBottomPositionOfContainer(o,o.anchorTop,c),this.updateContainerPositionsDownwards(t,n,e.containerPositionIndex+1),this.aggregateHeight=e.containerPositionIndex===t.length-1?c+o.anchorTop:this.aggregateHeight}else this.ulsLogger.sendTraceTag(595358743,r.msoulscat_Wac_Telemetry,s.Error,"Floating container info does not exist for the active container Id: ".concat(e.containerId))},t.prototype.updateContainerPositionsDownwards=function(t,n,e,o){void 0===e&&(e=0),void 0===o&&(o=!1);for(var i={},a=e;a<t.length;a+=1){if((r=t[a])&&r.contentId){if(!(s=this.getFloatingContainerInfo(r,n)))continue;i[r.contentId]=this.shouldUpdatePositions&&s.floatingContainerRef?s.floatingContainerRef.height():s.position.height}}for(a=e;a<t.length;a+=1){var r,s=this.getFloatingContainerInfo(t[a],n),c=(r=t[a])&&r.contentId;if(void 0===s||!c)return;var d=this.updateFloatingContainerPosition(t[a],n,i[c]);if(a===t.length-1&&s&&(this.aggregateHeight=i[c]+s.position.y),o&&d)return}},t.prototype.updateContainerPositionsAboveActiveContainer=function(t,n,e,o){var i=t[0]?t[0].anchorTop:void 0;this.setRestPositionOfContainers(t.slice(0,o+1),n,i);for(var r=e,s=o;s>=0;s-=1){var c=this.getFloatingContainerInfo(t[s],n);if(void 0===c||this.getBottomPositionOfContainer(c)<=r)return;var d=c.floatingContainerRef,l=r-(this.shouldUpdatePositions&&d?d.height():c.position.height)-10;this.shouldUpdatePositions&&d&&d.updateContainerPosition({anchorPoint:{x:this.anchorLeft,y:l},disableRepositioningAnimation:this.disableRepositioningAnimation,positionFixed:this.positionFixed}),this.updateFloatingContainerPositionInCache(n,this.getContainerId(t[s]),Object(a.__assign)(Object(a.__assign)({},c.position),{x:this.anchorLeft,y:l})),r=l}},t.prototype.setRestPositionOfContainers=function(t,n,e){var o;if(t.length>0){var i=this.getFloatingContainerInfo(t[0],n);if(void 0===i)return;var a=null===(o=i.floatingContainerRef)||void 0===o?void 0:o.anchorPoint().y,r=this.shouldUpdatePositions&&void 0!==a&&!this.positionFixed?a:i.position.y;this.possibleTopForNextContainer=null!=e?e:Math.max(i.anchorTop,r),this.updateContainerPositionsDownwards(t,n,0)}},t.prototype.getFloatingContainerInfo=function(t,n){return n[this.getContainerId(t)]},t.prototype.getContainerId=function(t){var n=t.contentId;return this.constructContainerId({contentId:n,contentType:d(t.containerContentType),renderMode:this.renderMode})},t.prototype.updateFloatingContainerPosition=function(t,n,e){var o=this.getFloatingContainerInfo(t,n);if(void 0===o)return!1;var i=this.shouldUpdatePositions&&o.floatingContainerRef?o.floatingContainerRef.anchorPoint().y:o.position.y,r=Math.max(this.possibleTopForNextContainer,o.anchorTop);return r!==i&&(this.shouldUpdatePositions&&o.floatingContainerRef&&o.floatingContainerRef.updateContainerPosition({anchorPoint:{x:this.anchorLeft,y:r},disableRepositioningAnimation:this.disableRepositioningAnimation,positionFixed:this.positionFixed}),this.updateFloatingContainerPositionInCache(n,this.getContainerId(t),Object(a.__assign)(Object(a.__assign)({},o.position),{x:this.anchorLeft,y:r}))),this.possibleTopForNextContainer=this.getBottomPositionOfContainer(o,r,e),r===i},t.prototype.getBottomPositionOfContainer=function(t,n,e){void 0===n&&(n=void 0),void 0===e&&(e=void 0);var o,i,a=t.floatingContainerRef,r=null==a?void 0:a.anchorPoint().y;return this.shouldUpdatePositions&&a&&void 0!==r?(o=r,i=a.height()):(o=t.position.y,i=t.position.height),(null!=n?n:o)+(null!=e?e:i)+10},t.prototype.updateFloatingContainerPositionInCache=function(t,n,e){t[n].position=e},t}(),p=e(2422),h=e(197);function C(){return l||(l=Object(h.a)())}var f,v=function(){function t(t){this.eventSink=t}return t.prototype.unsubscribe=function(){this.eventSink.unsubscribe(this)},t}(),g=function(){function t(){this.handlers=[]}return t.prototype.subscribe=function(t){var n=new v(this);return this.handlers.push({subscription:n,handler:t}),n},t.prototype.unsubscribe=function(t){this.handlers=this.handlers.filter((function(n){return n.subscription!==t}))},t.prototype.trigger=function(t){this.handlers.forEach((function(n){return n.handler(t,n.subscription)}))},t}(),I=function(){function t(t){this.onContainerShouldBeCreated=new g,this.motionDuration=p.b.duration4,this.posUpdateAnimationsInProgress=!1,this.containerVirtualizationEnabled=!1,this.enhancedContainerSelectorEnabled=!1,this.containerVisibilityUpdateRefactorisEnabled=!1,t&&(this.containerVirtualizationEnabled=!!t.containerVirtualizationEnabled),this.enhancedContainerSelectorEnabled=C().isChangeGateEnabled("EnhancedFloatingContainerSelector",Object(h.d)(6873658)),this.containerVisibilityUpdateRefactorisEnabled=C().isChangeGateEnabled("ContainerVisibilityUpdateRefactor",Object(h.d)(7050779))}return t.prototype.updateContainersVisibility=function(t,n,e,o,i){var a=this;if(void 0===e&&(e=!1),void 0===i&&(i=!1),n.height>0){var r={viewportTop:n.y-n.height/2,viewportBottom:n.y+1.5*n.height,containerIdToInfoMap:t,activeContainerId:o};if(!i&&!this.posUpdateAnimationsInProgress)return void this.handleContainerVirtualization(e,r);this.posUpdateAnimationsInProgress=!0,this.showContainersComingIntoViewport(r),setTimeout((function(){a.updatePositions(r,e),window.clearTimeout(a.hideContainersTimeout),a.hideContainersTimeout=window.setTimeout((function(){a.hideContainersOutsideViewport(r),a.posUpdateAnimationsInProgress=!1}),parseInt(a.motionDuration,10))}),0)}},t.prototype.handleContainerVirtualization=function(t,n){var e=this;Object.keys(n.containerIdToInfoMap).forEach((function(o){var i=e.extractContainerInfo(o,n);e.updateContainerVisibility(i,n.activeContainerId===o),e.updateContainerPosition(i,t)}))},t.prototype.showContainersComingIntoViewport=function(t){var n=this;Object.keys(t.containerIdToInfoMap).forEach((function(e){var o=n.extractContainerInfo(e,t);n.updateContainerVisibility(o,t.activeContainerId===e)}))},t.prototype.hideContainersOutsideViewport=function(t){var n=this;Object.keys(t.containerIdToInfoMap).forEach((function(e){var o=n.extractContainerInfo(e,t);n.updateContainerVisibility(o,t.activeContainerId===e)}))},t.prototype.updatePositions=function(t,n){var e=this;Object.keys(t.containerIdToInfoMap).forEach((function(o){var i=e.extractContainerInfo(o,t);e.updateContainerPosition(i,n)}))},t.prototype.updateContainerVisibility=function(t,n){if(t.containerRef&&t.containerElement)if(this.containerVisibilityUpdateRefactorisEnabled){var e=t.isContainerInViewport||n;t.containerElement.style.display=e?"block":"none",this.containerVirtualizationEnabled&&t.containerRef.updateContainerVirtualization(!e)}else(t.isContainerInViewport||n)&&"block"!==t.containerElement.style.display?(t.containerElement.style.display="block",this.containerVirtualizationEnabled&&t.containerRef.updateContainerVirtualization(!1)):t.isContainerInViewport||"none"===t.containerElement.style.display||(t.containerElement.style.display="none",this.containerVirtualizationEnabled&&t.containerRef.updateContainerVirtualization(!0))},t.prototype.updateContainerPosition=function(t,n){var e=t.containerElement;e&&(e.style.top="".concat(t.containerPosition.y,"px"),e.style.left="".concat(t.containerPosition.x,"px"),e.style.transitionDuration=n?"0ms":this.motionDuration)},t.prototype.extractContainerInfo=function(t,n){var e,o,i=n.containerIdToInfoMap[t],a=i.floatingContainerRef,r=i.position,s={containerElement:void 0,isContainerInViewport:r.y+r.height>=n.viewportTop&&r.y<=n.viewportBottom,containerRef:void 0,containerPosition:r};return a&&(s.containerRef=a,s.containerElement=this.enhancedContainerSelectorEnabled?null===(e=document.getElementById(a.parentDivId()))||void 0===e?void 0:e.querySelector("[id ^= 'floatingContainerView']"):null===(o=document.getElementById(a.parentDivId()))||void 0===o?void 0:o.firstChild),s},t}(),m=e(15),y=e(2414),T=e(289),b=e(4),x=e(27),P=e(44);!function(t){t[t.Enablement=1]="Enablement",t[t.Focus=2]="Focus",t[t.Hover=3]="Hover",t[t.Resize=4]="Resize",t[t.Visibility=5]="Visibility"}(f||(f={}));var A,R=e(248);function E(t,n){return{type:t,payload:n}}!function(t){t.ChangeRenderedContentIdentifierType="CHANGE_RENDERED_CONTENT_IDENTIFIER",t.EmptyActionType="",t.RemoveVisibilityAnimationType="REMOVE_VISIBILITY_ANIMATION",t.RepositionType="REPOSITION_FLOATING_CONTAINER",t.SetContentType="SET_CONTENT",t.UpdateContainerVirtualizationType="UPDATE_FLOATING_CONTAINER_VIRTUALIZATION",t.UpdateContainerVisibilityType="UPDATE_FLOATING_CONTAINER_VISIBILITY",t.UpdateContentMaxDimensionsType="UPDATE_CONTENT_MAX_DIMENSIONS",t.UpdateContentSetItemDetailsType="UPDATE_CONTENT_SET_ITEM_DETAILS"}(A||(A={}));var S={anchorPoint:{x:0,y:0}};function F(t,n){var e;return void 0===n&&(n=S),{anchorPoint:n.anchorPoint,contentIdentifier:t,disableRepositioningAnimation:!1,isVisible:!1,isVirtualized:!1,maxDimensions:n.maxDimensions||{},positionFixed:!1,useVisibilityAnimation:!1,accessibilityMetadata:null!==(e=n.accessibilityMetadata)&&void 0!==e?e:{}}}var j={contentId:"",contentType:i.b.Empty};function O(t,n){switch(void 0===t&&(t=F(j)),void 0===n&&(n=E(A.EmptyActionType,{})),n.type){case A.ChangeRenderedContentIdentifierType:return function(t,n){if(t.contentIdentifier.contentId===n.payload.newContentIdentifier.contentId&&t.contentIdentifier.contentType===n.payload.newContentIdentifier.contentType)return t;return Object(a.__assign)(Object(a.__assign)({},t),{contentIdentifier:n.payload.newContentIdentifier})}(t,n);case A.RemoveVisibilityAnimationType:return function(t){return Object(a.__assign)(Object(a.__assign)({},t),{useVisibilityAnimation:!1})}(t);case A.RepositionType:return function(t,n){if(t.anchorPoint.x===n.payload.anchorPoint.x&&t.anchorPoint.y===n.payload.anchorPoint.y&&t.disableRepositioningAnimation===n.payload.disableRepositioningAnimation&&t.positionFixed===n.payload.positionFixed)return t;return Object(a.__assign)(Object(a.__assign)({},t),{anchorPoint:n.payload.anchorPoint,disableRepositioningAnimation:n.payload.disableRepositioningAnimation,positionFixed:n.payload.positionFixed})}(t,n);case A.SetContentType:return function(t,n){return Object(a.__assign)(Object(a.__assign)({},t),{content:n.payload.content,isVisible:!!n.payload.content&&t.isVisible})}(t,n);case A.UpdateContentMaxDimensionsType:return function(t,n){if(t.maxDimensions.height===n.payload.maxDimensions.height&&t.maxDimensions.width===n.payload.maxDimensions.width)return t;return Object(a.__assign)(Object(a.__assign)({},t),{maxDimensions:n.payload.maxDimensions})}(t,n);case A.UpdateContentSetItemDetailsType:return function(t,n){var e,o=null===(e=t.accessibilityMetadata)||void 0===e?void 0:e.setItem,i=n.payload.setItemDetails;if(o===i)return t;if(o&&i&&o.positionInSet===i.positionInSet&&o.setSize===i.setSize&&o.level===i.level)return t;return Object(a.__assign)(Object(a.__assign)({},t),{accessibilityMetadata:Object(a.__assign)(Object(a.__assign)({},t.accessibilityMetadata),{setItem:i})})}(t,n);case A.UpdateContainerVisibilityType:return function(t,n){return Object(a.__assign)(Object(a.__assign)({},t),{isVisible:n.payload.isVisible,useVisibilityAnimation:n.payload.useVisibilityAnimation})}(t,n);case A.UpdateContainerVirtualizationType:return function(t,n){return Object(a.__assign)(Object(a.__assign)({},t),{isVirtualized:n.payload.isVirtualized})}(t,n);default:return t}}function w(t){return E(A.SetContentType,{content:t})}var _=function(t){return t.isVirtualized},D=e(45),k=e(814),M=Object(D.bb)({from:{opacity:0,visibility:"visible"},to:{opacity:1}}),V=Object(D.bb)({from:{opacity:1,visibility:"visible"},to:{opacity:0,visibility:"hidden"}}),U=Object(k.c)((function(t,n,e,o){return{floatingContainerView:Object(D.eb)({animationName:n?t?M:V:void 0,animationDuration:"".concat(300,"ms"),animationTimingFunction:p.c.decelerate,background:"transparent",position:o?"fixed":"absolute",transitionDuration:t&&!e?p.b.duration4:"0s",transitionProperty:"top, left",transitionTimingFunction:p.c.decelerate,visibility:t?"visible":"hidden"})}}));var N=e(2704),L=e(648);function z(t){return"floatingContainerView".concat(t.contentId,"Type").concat(t.contentType)}var H=function(t){function n(n){var e=t.call(this,n)||this;return e.handleResizeUpdates=function(t){t.forEach((function(t){e.props.onContainerStateChanged.trigger({stateChangeType:f.Resize,contentIdentifier:e.props.contentIdentifier,contentRect:t.contentRect})}))},e.triggerVisibilityUpdateNotification=function(){e.props.onContainerStateChanged.trigger({stateChangeType:f.Visibility,contentIdentifier:e.props.contentIdentifier,isVisible:e.props.isVisible})},e.getHostedResource=function(t){return{id:t}},e.onFocusChange=function(t,n){var o=t.relatedTarget||document.activeElement;e.parentDivRef&&o instanceof HTMLElement&&e.parentDivRef.contains(o)||e.props.onContainerStateChanged.trigger({stateChangeType:f.Focus,contentIdentifier:e.props.contentIdentifier,isFocused:n})},e.onFocusOut=function(t){e.onFocusChange(t,!1)},e.onFocusIn=function(t){e.onFocusChange(t,!0)},e.onMouseEnter=function(){e.props.onContainerStateChanged.trigger({stateChangeType:f.Hover,contentIdentifier:e.props.contentIdentifier,isHovered:!0})},e.onMouseLeave=function(){e.props.onContainerStateChanged.trigger({stateChangeType:f.Hover,contentIdentifier:e.props.contentIdentifier,isHovered:!1})},e.setContentRef=function(t){e.contentRef=t},e.setParentDivRef=function(t){t!==e.parentDivRef&&(e.parentDivRef&&(e.resizeObserver.unobserve(e.parentDivRef),e.parentDivRef.removeEventListener("focusin",e.onFocusIn,!0),e.parentDivRef.removeEventListener("focusout",e.onFocusOut,!0)),t&&(e.resizeObserver.observe(t),t.addEventListener("focusin",e.onFocusIn,!0),t.addEventListener("focusout",e.onFocusOut,!0))),e.parentDivRef=t},e.contentRef=void 0,e.parentDivRef=void 0,e.resizeObserver=new L.a((function(t){window.requestAnimationFrame((function(){e.handleResizeUpdates(t)}))})),e.setContentRef=e.setContentRef.bind(e),e.setParentDivRef=e.setParentDivRef.bind(e),e.getHostedResource=Object(N.a)(e.getHostedResource.bind(e)),e}return Object(a.__extends)(n,t),n.prototype.componentDidMount=function(){this.triggerVisibilityUpdateNotification()},n.prototype.componentDidUpdate=function(t){var n=this,e=!1;t.isVisible!==this.props.isVisible&&(this.props.useVisibilityAnimation&&!this.props.isVisible?e=!0:this.triggerVisibilityUpdateNotification()),this.props.useVisibilityAnimation&&setTimeout((function(){e&&n.triggerVisibilityUpdateNotification(),n.props.removeVisibilityAnimation()}),300)},n.prototype.height=function(){return this.parentDivRef?this.parentDivRef.clientHeight:0},n.prototype.width=function(){return this.parentDivRef?this.parentDivRef.clientWidth:0},n.prototype.setFocus=function(){this.contentRef&&this.contentRef.focus()},n.prototype.render=function(){if(!this.props.anchorPoint||void 0===this.props.anchorPoint.x||void 0===this.props.anchorPoint.y||!this.props.content)return null;var t=U(this.props.isVisible,this.props.useVisibilityAnimation,this.props.disableRepositioningAnimation,this.props.positionFixed),n=this.props.content;return b.createElement("div",{key:z(this.props.contentIdentifier),id:z(this.props.contentIdentifier),ref:this.setParentDivRef,className:t.floatingContainerView,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,style:{left:this.props.anchorPoint.x,top:this.props.anchorPoint.y}},b.createElement(n,{componentRef:this.setContentRef,resource:this.getHostedResource(this.props.contentIdentifier.contentId),maximumDimensions:this.props.maxDimensions,isVirtualized:this.props.isVirtualized,accessibilityMetadata:this.props.accessibilityMetadata}))},n}(b.Component);var B,W=Object(P.connect)((function(t){return{accessibilityMetadata:t.accessibilityMetadata,anchorPoint:t.anchorPoint,content:t.content,contentIdentifier:t.contentIdentifier,disableRepositioningAnimation:t.disableRepositioningAnimation,isVisible:t.isVisible,isVirtualized:t.isVirtualized,maxDimensions:t.maxDimensions,positionFixed:t.positionFixed,useVisibilityAnimation:t.useVisibilityAnimation}}),(function(t,n){return{removeVisibilityAnimation:function(){t(E(A.RemoveVisibilityAnimationType,{}))}}}),void 0,{forwardRef:!0})(H),G=function(){function t(t,n,e,o){var i;this.onContainerStateChanged=new g,this.floatingContainerRef=void 0,this.extensionUpdatedEventSubscription=void 0,this.unsubscribeStoreListener=function(){},this.canShow=!1,!1===o.isDraftContainer&&(this.floatingContainerCreationActivity=Object(m.j)().createActivityObject("FloatingContainerCreation",Object(m.k)(m.g.GlobalAPI),Object(m.i)())),this.store=(i=F(e,o))?Object(R.createStore)(O,i):Object(R.createStore)(O),this.extensionProvider=n,this.setContentFromExtension(),this.parentDiv=document.createElement("div"),this.parentDiv.id=o.containerId||Object(y.a)(),t.appendChild(this.parentDiv),this.observeStore=this.observeStore.bind(this),this.onUpdatedEventHandler=this.onUpdatedEventHandler.bind(this),this.setFloatingContainerRef=this.setFloatingContainerRef.bind(this),this.observeStore(e),this.render()}return t.prototype.anchorPoint=function(){return this.store.getState().anchorPoint},t.prototype.contentIdentifier=function(){return this.store.getState().contentIdentifier},t.prototype.height=function(){return this.floatingContainerRef?this.floatingContainerRef.height():0},t.prototype.width=function(){return this.floatingContainerRef?this.floatingContainerRef.width():0},t.prototype.parentDivId=function(){return this.parentDiv.id},t.prototype.observeStore=function(t){var n=this;if(Object(i.h)(this.extensionProvider)){var e=t;this.unsubscribeStoreListener=this.store.subscribe((function(){var t=n.contentIdentifier();e.contentId===t.contentId&&e.contentType===t.contentType||(e=t,n.removeExtensionUpdatedEventSubscription(),n.setContentFromExtension())}))}},t.prototype.setContentFromExtension=function(){var t=this,n=void 0;if(Object(i.h)(this.extensionProvider)){if(n=this.extensionProvider.getExtension(this.contentIdentifier().contentId),this.extensionUpdatedEventSubscription||(this.extensionUpdatedEventSubscription=n.onUpdated.subscribe((function(n){t.onUpdatedEventHandler()}))),n.priority===i.d.Disabled)return this.canShow=!1,void this.store.dispatch(w(void 0))}else n=this.extensionProvider.getExtension();this.canShow=!0,Object(T.c)().getComponent(n.componentKey).then((function(n){t.store.dispatch(w(n.component)),t.floatingContainerCreationActivity&&(t.floatingContainerCreationActivity.successTag(593872975),t.floatingContainerCreationActivity=void 0)})).catch((function(t){Object(m.j)().assertConditionTag(!1,"Error when registering component in setContentFromExtension ".concat(t),595632583)}))},t.prototype.render=function(){var t={onContainerStateChanged:this.onContainerStateChanged};x.render(b.createElement(P.Provider,{store:this.store},b.createElement(W,Object(a.__assign)({ref:this.setFloatingContainerRef},t))),this.parentDiv)},t.prototype.updateContainerPosition=function(t){var n,e,o;this.store.dispatch((n=t.anchorPoint,e=!!t.disableRepositioningAnimation,o=!!t.positionFixed,E(A.RepositionType,{anchorPoint:n,disableRepositioningAnimation:e,positionFixed:o})))},t.prototype.updateMaximumDimensions=function(t){this.store.dispatch(function(t){return E(A.UpdateContentMaxDimensionsType,{maxDimensions:t})}(t))},t.prototype.updateSetItemDetails=function(t){this.store.dispatch(function(t){return E(A.UpdateContentSetItemDetailsType,{setItemDetails:t})}(t))},t.prototype.updateContainerVirtualization=function(t){t&&!_(this.store.getState())?this.store.dispatch(E(A.UpdateContainerVirtualizationType,{isVirtualized:!0})):_(this.store.getState())&&this.store.dispatch(E(A.UpdateContainerVirtualizationType,{isVirtualized:!1}))},t.prototype.showFloatingContainer=function(t){return!!this.canShow&&(this.store.dispatch(function(t){return E(A.UpdateContainerVisibilityType,{isVisible:!0,useVisibilityAnimation:t})}(!!t)),!0)},t.prototype.hideFloatingContainer=function(t){this.store.dispatch(function(t){return E(A.UpdateContainerVisibilityType,{isVisible:!1,useVisibilityAnimation:t})}(!!t))},t.prototype.destroyFloatingContainer=function(t){var n=this;this.unsubscribeStoreListener(),this.removeExtensionUpdatedEventSubscription(),this.hideFloatingContainer(t),t?setTimeout((function(){n.cleanupDomOnDestroy()}),300):this.cleanupDomOnDestroy()},t.prototype.cleanupDomOnDestroy=function(){x.unmountComponentAtNode(this.parentDiv),this.parentDiv.parentElement&&this.parentDiv.parentElement.removeChild(this.parentDiv)},t.prototype.isShowing=function(){return this.store.getState().isVisible},t.prototype.setFocus=function(){var t=this;this.floatingContainerRef?this.floatingContainerRef.setFocus():setTimeout((function(){var n;return null===(n=t.floatingContainerRef)||void 0===n?void 0:n.setFocus()}))},t.prototype.changeRenderedContentIdentifier=function(t){this.store.dispatch(function(t){return E(A.ChangeRenderedContentIdentifierType,{newContentIdentifier:t})}(t))},t.prototype.onUpdatedEventHandler=function(){var t=this.canShow;this.setContentFromExtension(),t!==this.canShow&&this.onContainerStateChanged.trigger({stateChangeType:f.Enablement,contentIdentifier:this.contentIdentifier(),isEnabled:this.canShow})},t.prototype.removeExtensionUpdatedEventSubscription=function(){this.extensionUpdatedEventSubscription&&(this.extensionUpdatedEventSubscription.unsubscribe(),this.extensionUpdatedEventSubscription=void 0)},t.prototype.setFloatingContainerRef=function(t){this.floatingContainerRef=null!=t?t:void 0},t}(),Q=new(function(){function t(){}return t.prototype.createFloatingContainer=function(t,n,e,o){return new G(t,n,e,o)},t}()),q=e(1202);!function(t){t[t.DeselectionEnabled=0]="DeselectionEnabled",t[t.FloatingContainerVirtualizationEnabled=1]="FloatingContainerVirtualizationEnabled",t[t.ImproveJumpingFixEnabled=2]="ImproveJumpingFixEnabled",t[t.ShouldInitialize=3]="ShouldInitialize",t[t.ScrollingPerfImprovementEnabled=4]="ScrollingPerfImprovementEnabled",t[t.SynchronousContainerPositioningEnabled=5]="SynchronousContainerPositioningEnabled",t[t.TrackChangesInSidetrackEnabled=6]="TrackChangesInSidetrackEnabled",t[t.ContentNavigationApiEnabled=7]="ContentNavigationApiEnabled",t[t.ReturnToDraftFixEnabled=8]="ReturnToDraftFixEnabled"}(B||(B={}));var K,Z=e(2386),J=e(1377),Y=e(290),X=e(2824);!function(t){t[t.Focus=0]="Focus"}(K||(K={}));var $=e(166);function tt(t){return"".concat(t.contentId,"_").concat(t.contentType,"_").concat(t.renderMode)}function nt(t){switch(t){case i.b.CommentThread:return o.CommentThread;case i.b.TrackedChange:return o.TrackedChange;default:return o.CommentThread}}var et=function(t){var n=t.id,e=t.containerContent,o=t.componentRef,r=b.useState(e),s=r[0],c=r[1],d=b.useCallback((function(t){var n;switch(t.type){case"content":c(t.data);break;case"behavior":t.data.action===K.Focus&&(null===(n=p.current)||void 0===n||n.focus())}}),[]),l=bt.getTrackChangesStore(),u=bt.getFCContentNavigationAPI(),p=b.useRef(null),h=b.useCallback((function(){var t;null===(t=p.current)||void 0===t||t.focus()}),[]),C=b.useCallback((function(){return n}),[n]);b.useEffect((function(){return l.registerOnStoreUpdate(n,d),o&&o({focus:h,getInstanceId:C}),function(){l.removeFromStore(n)}}),[n,o,d,l,h,C]);var f=b.useMemo((function(){var t,n;return{definitionType:"TrackChangeDefinition",authorName:null!==(t=s.authorName)&&void 0!==t?t:"",authorColor:null!==(n=s.authorColor)&&void 0!==n?n:"",changeDescriptor:s.changeDescriptor,acceptDisabled:!!s.acceptDisabled,rejectDisabled:!!s.rejectDisabled,theme:s.theme}}),[s]),v=b.useMemo((function(){return l.cardStrings}),[l.cardStrings]),g=b.useMemo((function(){return l.getCardActionCallbacks(n)}),[n,l]),I=b.useMemo((function(){return{definition:f,strings:v,onAcceptHoverIn:g.onAcceptHoverIn,onRejectHoverIn:g.onRejectHoverIn,onAcceptHoverOut:g.onAcceptHoverOut,onRejectHoverOut:g.onRejectHoverOut,onAcceptClick:g.onAcceptClick,onRejectClick:g.onRejectClick,style:l.cardStyles}}),[f,v,g.onAcceptHoverIn,g.onRejectHoverIn,g.onAcceptHoverOut,g.onRejectHoverOut,g.onAcceptClick,g.onRejectClick,l]),m=b.useCallback((function(){g.onCardClick(),h()}),[g,h]),y=b.useCallback((function(){g.onCardHoverIn()}),[g]),T=b.useCallback((function(){g.onCardHoverOut()}),[g]),x=b.useCallback((function(t){var e,o="ArrowDown"===(e=t.key)||"Down"===e?$.d.Next:"ArrowUp"===e||"Up"===e?$.d.Previous:$.d.None;o!==$.d.None&&(null==u||u.selectNextOrPreviousContent({selectDirection:o,preventLooping:!1,reason:$.c.Keyboarding,restrictToCurrentContext:!0,from:{contentId:n,contentType:i.b.TrackedChange}}),t.preventDefault())}),[u,n]),P=b.useMemo((function(){var t,n=(null===(t=s.theme)||void 0===t?void 0:t.borderColor)?"1px solid ".concat(s.theme.borderColor):void 0;return Object(D.eb)({outline:"none",boxShadow:"0 0 2px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0,0,0,0.14)",borderRadius:"4px",":hover":{boxShadow:"0 0 2px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0,0,0,0.14)"},border:n,":focus":{boxShadow:"0 0 2px rgba(0, 0, 0, 0.12), 0 8px 16px rgba(0,0,0,0.14)"}})}),[s]);return b.createElement("div",{onClick:m,onMouseEnter:y,onMouseLeave:T,onKeyDown:x,tabIndex:0,ref:p,className:P},b.createElement(X.a,Object(a.__assign)({},I)))},ot=function(t){var n,e,o=bt.getTrackChangesStore().getContainerContent(null===(n=t.resource)||void 0===n?void 0:n.id);return o?b.createElement(et,{id:null===(e=t.resource)||void 0===e?void 0:e.id,containerContent:o,componentRef:t.componentRef}):null};var it=e(893),at=e(1544),rt={width:0,height:0,x:0,y:0};function st(t){return void 0!==t.hasBeenRendered}var ct=function(){function t(t,n,e,o,a){var r=this;this.supportedContentTypes=[i.b.CommentThread,i.b.TrackedChange],this.getContentCardIndex=function(t,n){if(!r.containerIdToInfoMap[t])return r.ULS.sendTraceTag(595883362,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[getContentCardIndex]Container with id ".concat(t," does not exist.")),-1;var e=r.containerIdToInfoMap[t].anchorTop;e=n?Math.max(e,n):e;for(var o=r.getContentCardInsertionPoint(e),i=o;i<r.contentAnchorPositions.length;i+=1)if(r.checkIfContainerIdCorrespondsToGivenPosition(t,i))return i;for(i=0;i<o;i+=1)if(r.checkIfContainerIdCorrespondsToGivenPosition(t,i))return i;return-1},this.initializeExtensionProviderCollection=function(t){r.extensionProviderCollection=r.contentExtensionHostAPIGetter().getExtensions(r.supportedContentTypes,i.c),r.updateContentTypeToExtensionProviderMap(t),r.extensionProviderCollection.onUpdated.subscribe((function(){return r.updateContentTypeToExtensionProviderMap(t)}))},this.getContentCardInsertionPoint=function(t){for(var n,e=0,o=r.contentAnchorPositions.length;e<o;){n=e+Math.floor((o-e)/2),r.contentAnchorPositions[n].anchorTop<t-4?e=n+1:o=n}return e},this.getContainerStateChangedCallback=function(t,n){return function(e,o){switch(e.stateChangeType){case f.Resize:t(e,o);break;case f.Visibility:if(e.isVisible)if(!r.commentsTTVRReported)n===r.lastCommentVisibleID&&(Object(it.e)(it.d,{component:"canvas",subComponent:"floatingComments",state:at.c}),Object(it.e)(it.d,{component:"canvas",subComponent:"floatingComments",state:at.a}),r.commentsTTVRReported=!0)}}},this.renderFloatingContainerAtAnchorPosition=function(t){var n=r.containerIdToInfoMap[t];n&&n.floatingContainerRef&&n.floatingContainerRef.showFloatingContainer(!0)},this.updateContentTypeToExtensionProviderMap=function(t){r.contentTypeToExtensionProviderMap.clear(),void 0!==r.extensionProviderCollection?(r.areCommentExtensionProvidersDefinedOnce||(r.areCommentExtensionProvidersDefinedOnce=0!==r.extensionProviderCollection.providers.filter((function(t){return t.scope.contentType===i.b.CommentThread&&t.scope.renderMode===i.e.Integrated})).length),r.extensionProviderCollection.providers.forEach((function(t){t.scope.renderMode===i.e.Integrated&&r.contentTypeToExtensionProviderMap.set(t.scope.contentType,t)})),t()):r.ULS.sendTraceTag(595886287,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"extensionProviderCollection should not be null")},this.contentExtensionHostAPIGetter=t,this.dhcContainerPanel=n,this.isCommentPaneOpen=!1,this.areCommentExtensionProvidersDefinedOnce=!1,this.viewportInfo=a||rt,this.containerIdToInfoMap={},this.contentAnchorPositions=[],this.contentTypeToExtensionProviderMap=new Map,this.floatingContainerFactory=e,this.ULS=o,this.processedContainersVisibleAtBoot=!1,this.isFirstCommentRenderDone=!1,this.lastCommentVisibleID="",this.commentsTTVRReported=!1}return t.prototype.addContentAnchorPosition=function(t,n,e){void 0===n&&(n=0),void 0===e&&(e=-1);var o=e>-1?e:this.getContentCardInsertionPoint(t.anchorTop)+n;return this.contentAnchorPositions.splice(o,0,t),o},t.prototype.getContainerIdToInfoMap=function(){return this.containerIdToInfoMap},t.prototype.getContentAnchorPositions=function(){return this.contentAnchorPositions},t.prototype.getContentAnchorPosition=function(t){var n=this.getContentCardIndex(t);if(n>-1)return this.contentAnchorPositions[n]},t.prototype.initializeAndRenderFloatingContainer=function(t,n,e,o,i){void 0===o&&(o=!0),void 0===i&&(i=!1);var a;return a=this.initializeFloatingContainerState(t,e,o,i),i&&this.renderFloatingContainerAtAnchorPosition(n),a},t.prototype.isContainerInViewPort=function(t){return t>this.viewportInfo.y-.5*this.viewportInfo.height&&t<this.viewportInfo.y+1.5*this.viewportInfo.height},t.prototype.removeContentAnchorPosition=function(t){var n=this.getContentCardIndex(t);return-1===n?(this.ULS.sendTraceTag(595736577,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[RemoveContentAnchorPosition]Content anchor position for id ".concat(t," does not exist.")),-1):(this.contentAnchorPositions.splice(n,1),n)},t.prototype.checkIfContainerIdCorrespondsToGivenPosition=function(t,n){return t===this.getContainerIdUsingPositionalIndex(n)},t.prototype.getContainerIdUsingPositionalIndex=function(t){var n=this.contentAnchorPositions[t];return tt({contentId:n.contentId,contentType:d(n.containerContentType),renderMode:i.e.Integrated})},t.prototype.createFloatingContainer=function(t,n,e,o){if(this.dhcContainerPanel)return this.floatingContainerFactory.createFloatingContainer(this.dhcContainerPanel,t,{contentId:n.contentId,contentType:d(n.containerContentType)},{anchorPoint:{x:0,y:e},isDraftContainer:o});this.ULS.sendTraceTag(595883361,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[createFloatingContainer]dhcContainerPanel is not yet set.")},t.prototype.initializeFloatingContainerState=function(t,n,e,o){if(t){var r=this.contentTypeToExtensionProviderMap.get(d(t.containerContentType));if(void 0===r)return this.ULS.sendTraceTag(595883363,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[initializeFCState]ExtensionProvider not found for contentType ".concat(t.containerContentType)),!1;var s=t.contentId;if(!s)return this.ULS.sendTraceTag(595883407,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[initializeFCState]ContentId is null or empty."),!1;var c=tt({contentId:s,contentType:d(t.containerContentType),renderMode:i.e.Integrated}),l=void 0;if(e){if(!(l=this.createFloatingContainer(r,{contentId:s,containerContentType:t.containerContentType},t.anchorTop,o)))return this.ULS.sendTraceTag(595886286,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[createFloatingContainer] Could not create fc for content id ".concat(s)),!1;l.onContainerStateChanged.subscribe(this.getContainerStateChangedCallback(n,c))}if(this.containerIdToInfoMap[c])this.containerIdToInfoMap[c].floatingContainerRef=l;else{var u=Object(a.__assign)(Object(a.__assign)({position:{height:0,width:0,x:0,y:t.anchorTop}},this.containerIdToInfoMap[c]),{anchorTop:t.anchorTop,floatingContainerRef:l,hasBeenRendered:!1});this.containerIdToInfoMap[c]=u}return!0}return!1},t}(),dt=function(){function t(t,n,e,r,s,c,l,u){var p=this;this.floatingContainerPositioner=t,this.floatingContainerVirtualizer=n,this.store=e,this.featureSettings=c,this.trackChangesStore=u,this.isInitialActiveIdSet=!1,this.inFixedMode=!1,this.firstContainerBeingRendered=!0,this.fcManagerInitialized=!1,this.pauseContainerCreation=!1,this.containerDelayTimeMs=10,this.containerCreationQueue=[],this.isContainerQueueInProgress=!1,this.containerCreationTimers={},this.containerCreationEnqueueTimes={},this.stallDetectorTimeoutId=void 0,this.stallDetectorUsed=!1,this.queueStallDetectionTimeMs=1e3,this.draftContainerId="",this.emitEvent=function(t,n){if(p.store.isCommentPaneOpen||!p.store.dhcContainerPanel||!p.store.areCommentExtensionProvidersDefinedOnce)return p.store.ULS.sendTraceTag(538022540,Z.a.msoulscat_Wac_Telemetry,J.a.Warning,"FCM not handling the event. {\n          isCommentPaneOpen: ".concat(p.store.isCommentPaneOpen,",\n          dhcContainerPanelNotDefined: ").concat(!p.store.dhcContainerPanel,",\n          extensionProvidersNotDefined: ").concat(!p.store.areCommentExtensionProvidersDefinedOnce,"\n        }")),void(n&&n.viewportInfo&&(p.store.viewportInfo=n.viewportInfo));switch(t){case 0:if(n&&n.contentAnchorPosition){var e=n.contentAnchorPosition.contentId,a=n.noOfPrecedingThreadsOnSameLine?n.noOfPrecedingThreadsOnSameLine:0;if(!e)return void p.store.ULS.sendTraceTag(595903774,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[AddContainer]ContentId is null.");var r=tt({contentId:e,contentType:d(n.contentAnchorPosition.containerContentType),renderMode:i.e.Integrated}),s=p.store.getContainerIdToInfoMap()[r];if(void 0!==p.containerCreationTimers[r])return void p.store.ULS.sendTraceTag(509634193,Z.a.msoulscat_Wac_Telemetry,J.a.Warning,"[AddContainer]Container Creation in queue.");if(s&&s.floatingContainerRef)return void p.store.ULS.sendTraceTag(595097123,Z.a.msoulscat_Wac_Telemetry,J.a.Warning,"[AddContainer]Container already exists.");var c=p.store.initializeAndRenderFloatingContainer(n.contentAnchorPosition,r,p.onContainerResize,void 0,!0);if(p.draftContainerId=e,c){p.store.addContentAnchorPosition(n.contentAnchorPosition,a);var l={contentId:e,containerContentType:n.contentAnchorPosition.containerContentType};n.shouldSetFocus&&p.emitEvent(2,{containerContentDescriptor:l})}}break;case 1:if(n&&n.containerContentDescriptor){if(!n.containerContentDescriptor.contentId)return void p.store.ULS.sendTraceTag(595903775,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[DeleteContainer]ContentId is null.");r=tt({contentId:n.containerContentDescriptor.contentId,contentType:d(n.containerContentDescriptor.containerContentType),renderMode:i.e.Integrated});if(!(s=p.store.getContainerIdToInfoMap()[r]))return void p.store.ULS.sendTraceTag(595723333,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[DeleteContainer]Container info for id ".concat(r," does not exist."));var u=s.position.y,h=p.deleteContainer(r,!!n.animateOutOnDeletion);if(-1===h)return;p.store.activeContainerId&&p.store.activeContainerId!==r?p.positionFloatingContainers(p.store.getContentAnchorPositions(),void 0,p.store.activeContainerId):p.positionFloatingContainers(p.store.getContentAnchorPositions().slice(h),u)}break;case 2:if(n&&n.containerContentDescriptor){if(!n.containerContentDescriptor.contentId)return void p.store.ULS.sendTraceTag(595903777,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[FocusContainer]ContentId is null.");var C=tt({contentId:n.containerContentDescriptor.contentId,contentType:d(n.containerContentDescriptor.containerContentType),renderMode:i.e.Integrated});if(!p.store.getContainerIdToInfoMap()[C])return p.store.ULS.sendTraceTag(595903778,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[FocusContainer]Container with id ".concat(C," does not exist")),void p.setInitialActiveContainerIdV2(n.containerContentDescriptor,null);p.store.activeContainerId!==C&&(p.clearSelection(!0),p.positionFloatingContainers(p.store.getContentAnchorPositions(),void 0,C,void 0,!0));var f=p.store.getContainerIdToInfoMap()[C].floatingContainerRef;n.shouldSetFocus&&f&&f.setFocus(),p.store.activeContainerId=C}break;case 3:if(n&&n.contentAnchorPositions){if(n.containerContentByType&&n.containerContentByType[o.TrackedChange])for(var v=n.containerContentByType[o.TrackedChange],g=0,I=Object.entries(v);g<I.length;g++){var m=I[g],y=m[0],T=m[1];p.trackChangesStore.addOrUpdateStore(y,T)}p.processContentAnchorPositionsInView(n.contentAnchorPositions)}break;case 4:n&&n.viewportInfo&&(p.store.viewportInfo=n.viewportInfo,p.featureSettings.SynchronousContainerPositioningEnabled||p.positionFloatingContainers());break;case 5:if(n&&n.infoToReplaceContent){var b=n.infoToReplaceContent.currentContentId,x=n.infoToReplaceContent.newContentId;if(!b||!x)return void p.store.ULS.sendTraceTag(595855174,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[ReplaceContainerContent]".concat(b?"NewContentId":"CurrentContentId"," is null."));var P=tt({contentId:b,contentType:d(n.infoToReplaceContent.containerContentType),renderMode:i.e.Integrated});if(!(s=p.store.getContainerIdToInfoMap()[P]))return void p.store.ULS.sendTraceTag(595855175,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[ReplaceContainerContent]ContainerInfo for id ".concat(P," does not exist"));if(!s.floatingContainerRef)return void p.store.ULS.sendTraceTag(595855176,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[ReplaceContainerContent]FloatingContainerRef with id ".concat(P," does not exist"));s.floatingContainerRef.changeRenderedContentIdentifier({contentId:x,contentType:d(n.infoToReplaceContent.containerContentType)}),p.replacementContentId=x;var A=tt({contentId:x,contentType:d(n.infoToReplaceContent.containerContentType),renderMode:i.e.Integrated}),R=p.store.getContentCardIndex(P);if(-1===R)return void p.store.ULS.sendTraceTag(595855178,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[ReplaceContainerContent]Positional index for content id ".concat(b," should not be negative"));p.store.activeContainerId=p.store.activeContainerId===P?A:p.store.activeContainerId,p.store.getContainerIdToInfoMap()[A]=s,delete p.store.getContainerIdToInfoMap()[P],p.store.getContentAnchorPositions()[R].contentId=x}break;case 6:p.positionFloatingContainers()}},this.getAreContainersEnabled=function(){return!p.store.isCommentPaneOpen&&p.store.areCommentExtensionProvidersDefinedOnce},this.getContentAnchorPosition=function(t){if(!t)return null;var n=tt({contentId:t,contentType:i.b.CommentThread,renderMode:i.e.Integrated}),e=p.store.getContentCardIndex(n);return-1!==e?p.store.getContentAnchorPositions()[e]:null},this.containerShouldBeCreatedEventHandler=function(t){var n=p.store.getContentCardIndex(t.containerId);p.store.initializeAndRenderFloatingContainer(p.store.getContentAnchorPositions()[n],t.containerId,p.onContainerResize)},this.updateCommentPaneState=function(){p.store.isCommentPaneOpen=!0,p.store.extensionProviderCollection&&(p.store.isCommentPaneOpen=0===p.store.extensionProviderCollection.providers.filter((function(t){return t.scope.contentType===i.b.CommentThread&&t.scope.renderMode===i.e.Integrated})).length),p.onCommentPaneStateChange()},this.onContainerResize=function(t){if(!p.store.isCommentPaneOpen&&t.stateChangeType===f.Resize&&0!==t.contentRect.height){var n=t.contentIdentifier,e=tt({contentId:n.contentId,contentType:n.contentType,renderMode:i.e.Integrated}),o=p.store.getContainerIdToInfoMap()[e];if(o){var a=o.position.height!==t.contentRect.height;if(p.isInitialActiveIdSet&&p.store.activeContainerId===e&&o.floatingContainerRef&&(p.onInitialActiveContainerRender?(p.onInitialActiveContainerRender(),p.onInitialActiveContainerRender=void 0):o.floatingContainerRef.setFocus()),a){if(o.position.height=t.contentRect.height,o.position.width=t.contentRect.width,p.firstContainerBeingRendered){var r=window.performance&&window.performance.now?window.performance.now():Date.now();p.store.ULS.sendTraceTag(595718473,Z.a.msoulscat_Wac_Telemetry,J.a.Info,r.toString()),wacBoot.WacSkeletalBoot.isSkeletalDeepLink()&&(Box4.FastViewExtensions.setDeepLinkComplete(),document.body.classList.remove("Deeplink"),Box4.FastViewExtensions.dismiss(),wacBoot.WacSkeletalBoot.setComponentReady("SkeletalPage")),p.firstContainerBeingRendered=!1}var s=void 0!==p.containerCreationTimers[e];if(p.featureSettings.DeselectionEnabled?p.positionContainersOnResize(e,o,s):p.positionFloatingContainers(p.store.getContentAnchorPositions(),void 0,p.store.activeContainerId,s),n.contentId&&n.contentId===p.draftContainerId){var c=p.store.isContainerInViewPort(o.anchorTop);p.store.ULS.sendTraceTag(553747984,Z.a.msoulscat_Wac_Telemetry,J.a.Info,"[ContainerResize] Draft Container created with id: ".concat(n.contentId," created and in viewport ").concat(c))}p.isInitialActiveIdSet&&p.store.activeContainerId===e&&o.floatingContainerRef&&(p.isInitialActiveIdSet=!1),o.floatingContainerRef&&o.floatingContainerRef.showFloatingContainer(s),t.contentIdentifier.contentId===p.replacementContentId&&(p.replacementContentId=void 0),s&&(delete p.containerCreationTimers[e],void 0!==p.stallDetectorUsed&&(window.clearTimeout(p.stallDetectorTimeoutId),p.stallDetectorTimeoutId=void 0,p.processContainerQueue()))}}else p.store.ULS.sendTraceTag(595646153,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[ContainerResize] ContainerInfo does not exist, id: ".concat(e,", size: ").concat(t.contentRect.height))}},this.paneClosedCallback=r,this.paneOpenedCallback=s,this.destroyAllContainersCallback=l,c.ShouldInitialize&&this.initialize(),c.TrackChangesInSidetrackEnabled&&(Object(T.c)().registerComponent("TrackedChange",ot),function(){return Object(a.__awaiter)(this,void 0,void 0,(function(){var t;return Object(a.__generator)(this,(function(n){return t={priority:i.d.Primary,renderMode:i.e.Integrated,instanceId:Y.a,componentDimensions:void 0},[2,Object(i.f)().registerExtension(i.b.TrackedChange,"TrackedChange",t)]}))}))}().catch((function(t){p.store.ULS.sendTraceTag(538022360,Z.a.msoulscat_Wac_Telemetry,J.a.Warning,"Failed to register TrackChange extension: ".concat(t))})))}return t.prototype.initialize=function(){this.fcManagerInitialized||(this.store.initializeExtensionProviderCollection(this.updateCommentPaneState),this.floatingContainerVirtualizer.onContainerShouldBeCreated.subscribe(this.containerShouldBeCreatedEventHandler),this.fcManagerInitialized=!0)},t.prototype.enterFixedPositionMode=function(){this.inFixedMode=!0},t.prototype.exitFixedPositionMode=function(){this.inFixedMode=!1},t.prototype.setFirstCommentRenderDone=function(){this.store.isFirstCommentRenderDone=!0},t.prototype.setContainerCreationPauseState=function(t){this.pauseContainerCreation=t,t&&(this.containerCreationEnqueueTimes={},this.isContainerQueueInProgress=!1)},t.prototype.clearSelection=function(t){if(void 0===t&&(t=!1),this.store.activeContainerId){var n=this.store.getContainerIdToInfoMap()[this.store.activeContainerId];if(this.store.activeContainerId=void 0,!n)return;if(n.position.x=0,t)return;this.positionFloatingContainers()}},t.prototype.setInitialActiveContainerId=function(t){this.isInitialActiveIdSet=!0,this.clearSelection(),t&&t.contentId&&(this.store.activeContainerId=tt({contentId:t.contentId,contentType:d(t.containerContentType),renderMode:i.e.Integrated}))},t.prototype.setInitialActiveContainerIdV2=function(t,n){this.isInitialActiveIdSet=!0,this.clearSelection(),t&&t.contentId&&(this.store.activeContainerId=tt({contentId:t.contentId,contentType:d(t.containerContentType),renderMode:i.e.Integrated}),n&&(this.onInitialActiveContainerRender=n))},t.prototype.insertContentAnchorPosition=function(t,n,e){var o=e&&Math.abs(t.anchorTop-n)<=4?this.store.getContentCardIndex(e)+1:-1;this.store.addContentAnchorPosition(t,0,o)},t.prototype.processContentAnchorPositionsInView=function(t){var n=this,e=!1,o=void 0,a=void 0,r=0;if(t.forEach((function(s,c){if(s){var l=s.contentId;if(!l)return void n.store.ULS.sendTraceTag(595903808,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[processContentAnchorPosition]ContentId is null.");var u=tt({contentId:l,contentType:d(s.containerContentType),renderMode:i.e.Integrated}),p=t.length;n.trackLastCommentRenderedInViewport(s,c,u,p);var h=n.store.getContainerIdToInfoMap()[u];if(!h){var C=n.store.initializeAndRenderFloatingContainer(s,u,n.onContainerResize,!1);return C&&!n.containerCreationQueue.includes(u)&&(n.containerCreationQueue.push(u),n.containerCreationEnqueueTimes[u]=Date.now()),void(C&&(n.insertContentAnchorPosition(s,r,o),o=u,r=s.anchorTop))}var f=n.store.getContentCardIndex(u,s.anchorTop);if(-1===f)return void n.store.ULS.sendTraceTag(595883392,Z.a.msoulscat_Wac_Telemetry,J.a.Error,"[processContentAnchorPosition]Container was supposed to be found.");var v=n.store.getContentAnchorPositions()[f],g=void 0!==a&&h.position.y>=a.position.y&&h.position.y<=a.position.y+a.position.height,I=Math.abs(v.anchorTop-s.anchorTop)>4;if(e=e||I||g,I){var m=tt({contentId:l,contentType:d(s.containerContentType),renderMode:i.e.Integrated});n.store.removeContentAnchorPosition(m),n.insertContentAnchorPosition(s,r,o)}o=u,r=s.anchorTop,h.anchorTop=s.anchorTop,a=h}})),this.updateProcessedContainersVisibleAtBootState(),!this.featureSettings.TrackChangesInSidetrackEnabled&&this.isContainerQueueInProgress||this.processContainerQueue(),e||this.inFixedMode){var s=this.store.getContentAnchorPositions().length>0?this.store.getContentAnchorPositions()[0].anchorTop:void 0;this.positionFloatingContainers(this.store.getContentAnchorPositions(),s,this.store.activeContainerId)}},t.prototype.processContainerQueue=function(){var t=this;if(0===this.containerCreationQueue.length||this.pauseContainerCreation)this.isContainerQueueInProgress=!1;else{this.isContainerQueueInProgress=!0;var n=this.containerCreationQueue.shift(),e=this.store.getContentAnchorPosition(n);if(e)if(this.store.isContainerInViewPort(e.anchorTop)){if(!this.featureSettings.TrackChangesInSidetrackEnabled||!this.containerCreationTimers[n]){var o=window.setTimeout((function(){t.containerCreationTimers[n]&&(t.containerCreationTimers[n].creationStarted=!0),t.createContainer(e,n),t.setupStallDetector(n)}),this.containerDelayTimeMs);this.containerCreationTimers[n]={timer:o,creationStarted:!1}}}else this.deleteContainer(n),this.processContainerQueue();else this.featureSettings.TrackChangesInSidetrackEnabled&&this.processContainerQueue()}},t.prototype.trackLastCommentRenderedInViewport=function(t,n,e,o){this.store.processedContainersVisibleAtBoot||(this.store.isContainerInViewPort(t.anchorTop)?this.store.lastCommentVisibleID=e:0===n&&Object(it.e)(it.d,{component:"canvas",subComponent:"floatingComments",state:"unused"})),n!==o-1||this.store.processedContainersVisibleAtBoot||(this.store.processedContainersVisibleAtBoot=!0)},t.prototype.updateProcessedContainersVisibleAtBootState=function(){this.store.isFirstCommentRenderDone&&!this.store.processedContainersVisibleAtBoot&&(this.store.processedContainersVisibleAtBoot=!0,Object(it.e)(it.d,{component:"canvas",subComponent:"floatingComments",state:"unused"}))},t.prototype.setupStallDetector=function(t){var n=this;this.stallDetectorUsed=!1,!(this.featureSettings.TrackChangesInSidetrackEnabled&&void 0!==this.stallDetectorTimeoutId)&&(this.stallDetectorTimeoutId=window.setTimeout((function(){n.stallDetectorUsed=!0,n.processContainerQueue(),n.store.ULS.sendTraceTag(593281990,Z.a.msoulscat_Wac_Telemetry,J.a.Warning,"[CommentCreationQueueStallDetector]: Container ".concat(t," creation resize call not received or took too long"))}),this.queueStallDetectionTimeMs))},t.prototype.createContainer=function(t,n){if(this.store.initializeAndRenderFloatingContainer(t,n,this.onContainerResize,!0)){if(this.containerCreationEnqueueTimes[n]){var e=Date.now();this.store.ULS.sendTraceTag(593891910,Z.a.msoulscat_Wac_Telemetry,J.a.Info,"[DelayCreationPerfMetric]TimeToCreateCommentFromEnqueue:".concat(e-this.containerCreationEnqueueTimes[n])),delete this.containerCreationEnqueueTimes[n]}}else this.deleteContainer(n),this.processContainerQueue()},t.prototype.onCommentPaneStateChange=function(){this.store.isCommentPaneOpen?(this.store.areCommentExtensionProvidersDefinedOnce&&this.destroyAllContainers(),this.paneOpenedCallback&&this.paneOpenedCallback()):this.paneClosedCallback&&this.paneClosedCallback()},t.prototype.deleteContainer=function(t,n){var e;void 0===n&&(n=!1);var o=this.store.removeContentAnchorPosition(t);if(-1===o)return-1;var i=this.store.getContainerIdToInfoMap()[t].floatingContainerRef;return i&&(i.destroyFloatingContainer(n),this.featureSettings.TrackChangesInSidetrackEnabled||(clearTimeout(null===(e=this.containerCreationTimers[t])||void 0===e?void 0:e.timer),delete this.containerCreationTimers[t],this.removeFromCreationQueue(t))),this.featureSettings.TrackChangesInSidetrackEnabled&&(void 0!==this.containerCreationTimers[t]&&(this.containerCreationTimers[t].creationStarted?(clearTimeout(this.stallDetectorTimeoutId),this.stallDetectorTimeoutId=void 0):clearTimeout(this.containerCreationTimers[t].timer),delete this.containerCreationTimers[t]),this.removeFromCreationQueue(t)),delete this.store.getContainerIdToInfoMap()[t],delete this.containerCreationEnqueueTimes[t],o},t.prototype.destroyAllContainers=function(){var t=this,n=Object.keys(this.store.getContainerIdToInfoMap());n.length>0&&this.destroyAllContainersCallback&&this.destroyAllContainersCallback(),n.forEach((function(n){t.deleteContainer(n)})),this.isContainerQueueInProgress=!1,this.containerCreationEnqueueTimes={},this.containerCreationTimers={},this.containerCreationQueue=[]},t.prototype.positionFloatingContainers=function(t,n,e,o,i){if(void 0===o&&(o=!1),void 0===i&&(i=!1),t&&t.length>0){var a=e?{containerId:e,containerPositionIndex:this.store.getContentCardIndex(e)}:void 0;this.floatingContainerPositioner.calculateNewPositions(t,this.store.getContainerIdToInfoMap(),{activeContainerInfo:a,disableRepositioningAnimation:o||this.inFixedMode,topOfFirstContainer:n,shouldUpdatePositions:!1})}var r=e;r=null!=r?r:this.store.activeContainerId,this.floatingContainerVirtualizer.updateContainersVisibility(this.store.getContainerIdToInfoMap(),this.store.viewportInfo,o||this.inFixedMode||void 0!==this.replacementContentId,this.isInitialActiveIdSet?void 0:r,i)},t.prototype.positionContainersOnResize=function(t,n,e){var o=this.store.getContentCardIndex(t),i=this.store.activeContainerId?this.store.getContentCardIndex(this.store.activeContainerId):void 0;void 0!==i&&i>=o?this.positionFloatingContainers(this.store.getContentAnchorPositions(),void 0,this.store.activeContainerId,e):(o-=!(st(n)&&n.hasBeenRendered)&&o>0?1:0,this.positionFloatingContainers(this.store.getContentAnchorPositions().slice(o),void 0,void 0,e));st(n)&&(n.hasBeenRendered=!0)},t.prototype.removeFromCreationQueue=function(t){var n=this.containerCreationQueue.indexOf(t);n>-1&&this.containerCreationQueue.splice(n,1)},t}(),lt=e(647),ut=function(){function t(t){var n,e;this.wordContentNavigationApi=t,this.directionTranslation=((n={})[lt.a.None]=0,n[lt.a.Previous]=2,n[lt.a.Next]=1,n),this.navReasonTranslation=((e={})[$.c.HostAction]=2,e[$.c.Keyboarding]=1,e)}return t.prototype.bringContentIntoView=function(t){this.wordContentNavigationApi.bringContentIntoView({contentIdentifier:{contentId:t.contentIdentifier.contentId,containerContentType:nt(t.contentIdentifier.contentType)}})},t.prototype.moveFocus=function(t){var n,e;this.wordContentNavigationApi.moveFocus({resource:{contentId:null===(n=t.resource)||void 0===n?void 0:n.contentId,containerContentType:nt(null===(e=t.resource)||void 0===e?void 0:e.contentType)}})},t.prototype.selectNextOrPreviousContent=function(t){this.wordContentNavigationApi.selectNextOrPreviousContent({selectDirection:this.directionTranslation[t.selectDirection],reason:this.navReasonTranslation[t.reason],preventLooping:t.preventLooping,restrictToCurrentContext:t.restrictToCurrentContext,from:t.from&&{contentId:t.from.contentId,containerContentType:nt(t.from.contentType)}})},t}(),pt=function(){function t(t){this.stringLoader=t,this.trackChangeInfoById=new Map,this.storeUpdateHandlers=new Map,this.updateVersion=0,this.styles={minWidth:238,maxWidth:238,borderRadius:4}}return Object.defineProperty(t.prototype,"cardStyles",{get:function(){return this.styles},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cardStrings",{get:function(){var t;return null!==(t=this.strings)&&void 0!==t?t:{regularHeading:"Accept or reject suggestion?",acceptHoveredHeading:"Accept Suggestion",rejectHoveredHeading:"Reject Suggestion"}},enumerable:!1,configurable:!0}),t.prototype.loadStrings=function(t){var n=this;void 0===t&&(t="en-US"),this.stringLoader.loadStrings(t).then((function(t){n.strings={regularHeading:t.TrackChangeCardAcceptOrRejectSuggestionLabel,acceptHoveredHeading:t.TrackChangeCardAcceptSuggestionLabel,rejectHoveredHeading:t.TrackChangeCardRejectSuggestionLabel}})).catch((function(t){}))},t.prototype.registerOnStoreUpdate=function(t,n){this.storeUpdateHandlers.set(t,n)},t.prototype.addOrUpdateStore=function(t,n){this.trackChangeInfoById.set(t,n);var e=this.storeUpdateHandlers.get(t);e&&e({type:"content",data:n})},t.prototype.removeFromStore=function(t){this.trackChangeInfoById.delete(t),this.storeUpdateHandlers.delete(t)},t.prototype.reloadStore=function(){this.updateVersion++},t.prototype.registerTrackChangeCardActionExecuter=function(t){this.trackChangeCardActionExecuter=t},t.prototype.getCardActionCallbacks=function(t){return{onAcceptClick:this.createActionCallback("AcceptClick",t),onRejectClick:this.createActionCallback("RejectClick",t),onAcceptHoverIn:this.createActionCallback("AcceptMouseOver",t),onAcceptHoverOut:this.createActionCallback("AcceptMouseOut",t),onRejectHoverIn:this.createActionCallback("RejectMouseOver",t),onRejectHoverOut:this.createActionCallback("RejectMouseOut",t),onCardHoverIn:this.createActionCallback("CardMouseOver",t),onCardHoverOut:this.createActionCallback("CardMouseOut",t),onCardClick:this.createActionCallback("CardClick",t)}},t.prototype.getContainerContent=function(t){return this.trackChangeInfoById.get(t)},t.prototype.clearStore=function(){this.trackChangeInfoById.clear(),this.storeUpdateHandlers.clear()},t.prototype.focusTrackChangeCard=function(t){var n=this.storeUpdateHandlers.get(t);n&&n({type:"behavior",data:{action:K.Focus}})},t.prototype.createActionCallback=function(t,n){var e=this;return function(){e.trackChangeCardActionExecuter&&e.trackChangeCardActionExecuter(t,e.updateVersion,n)}},t}(),ht=e(467),Ct=e(471),ft=e(963),vt=function(){function t(){}return t.prototype.loadStrings=function(t){return Object(a.__awaiter)(this,void 0,void 0,(function(){var n=this;return Object(a.__generator)(this,(function(o){return[2,e(1733)("./".concat(t,"/canvas-contextual.json")).then((function(t){return Object(a.__awaiter)(n,void 0,void 0,(function(){return Object(a.__generator)(this,(function(n){return[2,t]}))}))})).catch((function(t){return ft.CanvasContextual}))]}))}))},t}(),gt=e(195),It=e(2703),mt=e(162),yt=function(t,n,e,o){return e?function(t,n,e,o){var i=0,a=0,r=0,s=new Set,c=[];for(;i<t.length&&a<n.length;)t[i].contentId===n[a].contentId?(i++,a++,r++):e.has(t[i].contentId)?o.has(n[a].contentId)?s.has(n[a].contentId)?(s.delete(n[a].contentId),c.push({type:"Insert",index:r,content:n[a]}),r++,a++):(s.add(t[i].contentId),c.push({type:"Remove",index:r}),i++):(c.push({type:"Insert",index:r,content:n[a]}),a++,r++):(c.push({type:"Remove",index:r}),i++);for(;a<n.length;)c.push({type:"Insert",content:n[a],index:r}),r++,a++;for(;i<t.length;)c.push({type:"Remove",index:r}),i++;return c}(t,n,o,e):[{type:"Reload",fullContent:n,reason:gt.d.DivergentChange}]};var Tt=function(){function t(t){this.wordFilterAPI=t,this.activeFilteredRange=void 0,this.filteredContentMap=new Map,this.filterMap=new Map,this.idsInFilter=new Map,this.onFilteredRangeUpdated=new mt.EventImpl((function(){})),this.onActiveFilterUpdated=new mt.EventImpl((function(){})),this.onUserFilterManagerEvent=new mt.EventImpl((function(){})),t.registerOnContentChangeCallback(this.onContentChanged.bind(this))}return t.prototype.updateFilterForFilteredRangeId=function(t,n){if(this.filterMap.has(t)){var e=this.updateOrder(t,n);e.length>0&&this.onFilteredRangeUpdated.trigger({filterId:t,payload:{changes:e}})}},t.prototype.getExistingFilteredRange=function(t){return Object(a.__awaiter)(this,void 0,void 0,(function(){var n,e;return Object(a.__generator)(this,(function(o){return n=this.filterMap.get(t),e=this.filteredContentMap.get(t),n&&e?[2,{content:e,filter:n.filter,filterId:t,supportsFilterUpdates:n.supportsFilterUpdates}]:[2]}))}))},t.prototype.setActiveFilteredRange=function(t){var n,e;this.activeFilteredRange=t,t&&(null===(e=(n=this.wordFilterAPI).updateCurrentFilteredContent)||void 0===e||e.call(n,this.idsInFilter.get(t)))},t.prototype.getActiveFilteredRangeId=function(){return Object(a.__awaiter)(this,void 0,void 0,(function(){return Object(a.__generator)(this,(function(t){return[2,this.activeFilteredRange]}))}))},t.prototype.getFilteredRange=function(t){var n;return Object(a.__awaiter)(this,void 0,void 0,(function(){var e;return Object(a.__generator)(this,(function(o){return e=Object(It.a)(),this.updateOrder(e,t.hostFilter),[2,{filterId:e,content:null!==(n=this.filteredContentMap.get(e))&&void 0!==n?n:[],supportsFilterUpdates:t.supportsFilterUpdates,filter:t.hostFilter}]}))}))},t.prototype.teardownFilteredRange=function(t){this.filteredContentMap.delete(t),this.filterMap.delete(t)},t.prototype.getCapabilities=function(){return Promise.resolve({supportedContentTypes:i.b.CommentThread,supportsMentionToMeFilter:!0})},t.prototype.getHostSpecificLabels=function(){return Object(a.__awaiter)(this,void 0,void 0,(function(){return Object(a.__generator)(this,(function(t){return[2,{}]}))}))},t.prototype.getFilterUsers=function(){return Object(a.__awaiter)(this,void 0,void 0,(function(){return Object(a.__generator)(this,(function(t){return[2,[]]}))}))},t.prototype.updateOrder=function(t,n){var e,i,a,r,s,c=this,l=new Set,u=null!==(e=this.filteredContentMap.get(t))&&void 0!==e?e:[],p=null!==(a=null===(i=this.wordFilterAPI)||void 0===i?void 0:i.getAllContent().filter((function(t){if((null==t?void 0:t.contentId)&&(null==t?void 0:t.containerContentType)===o.CommentThread){var e=t.contentId;return!!c.includeCommentInOrder(n,t)&&(!l.has(e)&&(l.add(e),!0))}return!1})).map((function(t){var n;return{contentId:null!==(n=t.contentId)&&void 0!==n?n:"",contentType:d(t.containerContentType)}})))&&void 0!==a?a:[];this.filteredContentMap.set(t,p),this.filterMap.set(t,{filter:n,supportsFilterUpdates:!0});var h=this.idsInFilter.get(t);return this.idsInFilter.set(t,l),this.activeFilteredRange===t&&(null===(s=(r=this.wordFilterAPI).updateCurrentFilteredContent)||void 0===s||s.call(r,l)),yt(u,p,h,l)},t.prototype.onContentChanged=function(){var t=this;this.filterMap.forEach((function(n,e){t.updateFilterForFilteredRangeId(e,n.filter)}))},t.prototype.includeCommentInOrder=function(t,n){var e,o;if(t.CommentThread){if(n.contentId&&(null===(o=(e=this.wordFilterAPI).isDraftContent)||void 0===o?void 0:o.call(e,n.contentId)))return!0;if(t.CommentThread.resolutionStatus===gt.a.ResolvedOnly&&this.wordFilterAPI.isContentActive(n))return!1;if(t.CommentThread.resolutionStatus===gt.a.ActiveOnly&&!this.wordFilterAPI.isContentActive(n))return!1}return!(t.mentionsToCurrentUser&&!this.wordFilterAPI.isCurrentUserMentioned(n))},t}(),bt=new(function(){function t(){var t=new vt;this.trackChangesStore=new pt(t)}return t.prototype.getFCManagerInstance=function(t){if(void 0===this.floatingContainerManagerInstance){if(!t)throw new Error("Floating Container Manager creation arguments are missing!");t.ulsLogger&&q.a.setLogger(t.ulsLogger);var n={DeselectionEnabled:!!(c=t.featureGates).deselectionEnabled,FloatingContainerVirtualizationEnabled:!!c.floatingContainerVirtualizationEnabled,ImproveJumpingFixEnabled:!!c.improveJumpingFixEnabled,ShouldInitialize:!1!==c.shouldInitialize,ScrollingPerfImprovementEnabled:!!c.scrollingPerfImprovementEnabled,SynchronousContainerPositioningEnabled:!!c.synchronousContainerPositioningEnabled,TrackChangesInSidetrackEnabled:!!c.trackChangeInSidetrackEnabled,ContentNavigationApiEnabled:!!c.contentNavigationApiEnabled,ReturnToDraftFixEnabled:!!c.returnToDraftFixEnabled};t.featureGateApiSettings&&Object(h.b)({appSettings:t.featureGateApiSettings,mapping:ht.a});var e=t.isRtl?1:-1,o=t.canvasAndFcHostOffset?e*(t.canvasAndFcHostOffset-1):0,a=new u(tt,q.a,o),r=new I({containerVirtualizationEnabled:n.FloatingContainerVirtualizationEnabled}),s=new ct(i.f,t.containerPanel,Q,q.a,t.viewportInfo);t.telemetryDetails&&Object(m.l)(Ct.a,t.telemetryDetails),this.trackChangesStore.loadStrings(t.uiCulture),this.floatingContainerManagerInstance=new dt(a,r,s,t.paneClosedCallback,t.paneOpenedCallback,n,t.destroyAllContainersCallback,this.trackChangesStore),n.ContentNavigationApiEnabled&&t.sidetrackContentNavigationApi&&this.registerContentNavigationApi(t.sidetrackContentNavigationApi),n.ContentNavigationApiEnabled&&t.contentFilterAPI&&this.registerContentFilteredRangeHostApi(t.contentFilterAPI)}var c;return this.floatingContainerManagerInstance},t.prototype.getTrackChangesStoreApi=function(){return this.trackChangesStore},t.prototype.getFCContentNavigationAPI=function(){return this.floatingContainerContentNavigationAPI},t.prototype.getTrackChangesStore=function(){return this.trackChangesStore},t.prototype.registerContentNavigationApi=function(t){Object($.h)(this.initializeAndGetContentNavigationAPI(t),Y.a)},t.prototype.initializeAndGetContentNavigationAPI=function(t){return this.floatingContainerContentNavigationAPI||(this.floatingContainerContentNavigationAPI=new ut(t)),this.floatingContainerContentNavigationAPI},t.prototype.registerContentFilteredRangeHostApi=function(t){Object(gt.g)(Y.a,this.initializeAndGetContentFilteredRangeHostApi(t))},t.prototype.initializeAndGetContentFilteredRangeHostApi=function(t){return this.contentFilteredRangeHostAPI||(this.contentFilteredRangeHostAPI=new Tt(t)),this.contentFilteredRangeHostAPI},t}()),xt=bt;e.d(n,"FactoryGlobal",(function(){return xt}))}}]);
//# sourceMappingURL=floatingContainerManager.min.js.map